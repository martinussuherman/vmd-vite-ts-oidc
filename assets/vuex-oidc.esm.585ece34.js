const Pr=function(){const st=document.createElement("link").relList;if(st&&st.supports&&st.supports("modulepreload"))return;for(const F of document.querySelectorAll('link[rel="modulepreload"]'))v(F);new MutationObserver(F=>{for(const T of F)if(T.type==="childList")for(const l of T.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&v(l)}).observe(document,{childList:!0,subtree:!0});function et(F){const T={};return F.integrity&&(T.integrity=F.integrity),F.referrerpolicy&&(T.referrerPolicy=F.referrerpolicy),F.crossorigin==="use-credentials"?T.credentials="include":F.crossorigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function v(F){if(F.ep)return;F.ep=!0;const T=et(F);fetch(F.href,T)}};Pr();var Cr=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Tr(mt){return mt&&mt.__esModule&&Object.prototype.hasOwnProperty.call(mt,"default")?mt.default:mt}var fr={exports:{}};(function(mt,st){(function(v,F){mt.exports=F()})(Cr,function(){return function(et){var v={};function F(T){if(v[T])return v[T].exports;var l=v[T]={i:T,l:!1,exports:{}};return et[T].call(l.exports,l,l.exports,F),l.l=!0,l.exports}return F.m=et,F.c=v,F.d=function(T,l,U){F.o(T,l)||Object.defineProperty(T,l,{enumerable:!0,get:U})},F.r=function(T){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},F.t=function(T,l){if(1&l&&(T=F(T)),8&l||4&l&&typeof T=="object"&&T&&T.__esModule)return T;var U=Object.create(null);if(F.r(U),Object.defineProperty(U,"default",{enumerable:!0,value:T}),2&l&&typeof T!="string")for(var _ in T)F.d(U,_,function(a){return T[a]}.bind(null,_));return U},F.n=function(T){var l=T&&T.__esModule?function(){return T.default}:function(){return T};return F.d(l,"a",l),l},F.o=function(T,l){return Object.prototype.hasOwnProperty.call(T,l)},F.p="",F(F.s=22)}([function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0});var T=function(){function a(u,o){for(var p=0;p<o.length;p++){var I=o[p];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(u,I.key,I)}}return function(u,o,p){return o&&a(u.prototype,o),p&&a(u,p),u}}(),l={debug:function(){},info:function(){},warn:function(){},error:function(){}},U=void 0,_=void 0;(v.Log=function(){function a(){(function(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")})(this,a)}return a.reset=function(){_=3,U=l},a.debug=function(){if(_>=4){for(var o=arguments.length,p=Array(o),I=0;I<o;I++)p[I]=arguments[I];U.debug.apply(U,Array.from(p))}},a.info=function(){if(_>=3){for(var o=arguments.length,p=Array(o),I=0;I<o;I++)p[I]=arguments[I];U.info.apply(U,Array.from(p))}},a.warn=function(){if(_>=2){for(var o=arguments.length,p=Array(o),I=0;I<o;I++)p[I]=arguments[I];U.warn.apply(U,Array.from(p))}},a.error=function(){if(_>=1){for(var o=arguments.length,p=Array(o),I=0;I<o;I++)p[I]=arguments[I];U.error.apply(U,Array.from(p))}},T(a,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return _},set:function(o){if(!(0<=o&&o<=4))throw new Error("Invalid log level");_=o}},{key:"logger",get:function(){return U},set:function(o){if(!o.debug&&o.info&&(o.debug=o.info),!(o.debug&&o.info&&o.warn&&o.error))throw new Error("Invalid logger");U=o}}]),a}()).reset()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0});var T=function(){function a(u,o){for(var p=0;p<o.length;p++){var I=o[p];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(u,I.key,I)}}return function(u,o,p){return o&&a(u.prototype,o),p&&a(u,p),u}}(),l={setInterval:function(a){function u(o,p){return a.apply(this,arguments)}return u.toString=function(){return a.toString()},u}(function(a,u){return setInterval(a,u)}),clearInterval:function(a){function u(o){return a.apply(this,arguments)}return u.toString=function(){return a.toString()},u}(function(a){return clearInterval(a)})},U=!1,_=null;v.Global=function(){function a(){(function(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")})(this,a)}return a._testing=function(){U=!0},a.setXMLHttpRequest=function(o){_=o},T(a,null,[{key:"location",get:function(){if(!U)return location}},{key:"localStorage",get:function(){if(!U&&typeof window!="undefined")return localStorage}},{key:"sessionStorage",get:function(){if(!U&&typeof window!="undefined")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!U&&typeof window!="undefined")return _||XMLHttpRequest}},{key:"timer",get:function(){if(!U)return l}}]),a}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.MetadataService=void 0;var T=function(){function u(o,p){for(var I=0;I<p.length;I++){var x=p[I];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(o,x.key,x)}}return function(o,p,I){return p&&u(o.prototype,p),I&&u(o,I),o}}(),l=F(0),U=F(7);function _(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")}var a=".well-known/openid-configuration";v.MetadataService=function(){function u(o){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.JsonService;if(_(this,u),!o)throw l.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=o,this._jsonService=new p(["application/jwk-set+json"])}return u.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},u.prototype.getMetadata=function(){var p=this;return this._settings.metadata?(l.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(l.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(I){l.Log.debug("MetadataService.getMetadata: json received");var x=p._settings.metadataSeed||{};return p._settings.metadata=Object.assign({},x,I),p._settings.metadata})):(l.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},u.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},u.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},u.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},u.prototype.getTokenEndpoint=function(){var p=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",p)},u.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},u.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},u.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},u.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},u.prototype._getMetadataProperty=function(p){var I=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return l.Log.debug("MetadataService.getMetadataProperty for: "+p),this.getMetadata().then(function(x){if(l.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),x[p]===void 0){if(I===!0)return void l.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+p);throw l.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+p),new Error("Metadata does not contain property "+p)}return x[p]})},u.prototype.getSigningKeys=function(){var p=this;return this._settings.signingKeys?(l.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(I){return l.Log.debug("MetadataService.getSigningKeys: jwks_uri received",I),p._jsonService.getJson(I).then(function(x){if(l.Log.debug("MetadataService.getSigningKeys: key set received",x),!x.keys)throw l.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return p._settings.signingKeys=x.keys,p._settings.signingKeys})})},T(u,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(a)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=a))),this._metadataUrl}}]),u}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.UrlUtility=void 0;var T=F(0),l=F(1);v.UrlUtility=function(){function U(){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,U)}return U.addQueryParam=function(a,u,o){return a.indexOf("?")<0&&(a+="?"),a[a.length-1]!=="?"&&(a+="&"),a+=encodeURIComponent(u),a+="=",a+=encodeURIComponent(o)},U.parseUrlFragment=function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.Global;typeof a!="string"&&(a=o.location.href);var p=a.lastIndexOf(u);p>=0&&(a=a.substr(p+1)),u==="?"&&(p=a.indexOf("#"))>=0&&(a=a.substr(0,p));for(var I,x={},V=/([^&=]+)=([^&]*)/g,O=0;I=V.exec(a);)if(x[decodeURIComponent(I[1])]=decodeURIComponent(I[2].replace(/\+/g," ")),O++>50)return T.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",a),{error:"Response exceeded expected number of parameters"};for(var A in x)return x;return{}},U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.JoseUtil=void 0;var T=F(26),l=function(_){return _&&_.__esModule?_:{default:_}}(F(33));v.JoseUtil=(0,l.default)({jws:T.jws,KeyUtil:T.KeyUtil,X509:T.X509,crypto:T.crypto,hextob64u:T.hextob64u,b64tohex:T.b64tohex,AllowedSigningAlgs:T.AllowedSigningAlgs})},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.OidcClientSettings=void 0;var T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},l=function(){function A(k,M){for(var q=0;q<M.length;q++){var d=M[q];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(k,d.key,d)}}return function(k,M,q){return M&&A(k.prototype,M),q&&A(k,q),k}}(),U=F(0),_=F(23),a=F(6),u=F(24),o=F(2);function p(A,k){if(!(A instanceof k))throw new TypeError("Cannot call a class as a function")}var I=".well-known/openid-configuration",x="id_token",V="openid",O="client_secret_post";v.OidcClientSettings=function(){function A(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=k.authority,q=k.metadataUrl,d=k.metadata,b=k.signingKeys,R=k.metadataSeed,Z=k.client_id,tt=k.client_secret,nt=k.response_type,H=nt===void 0?x:nt,at=k.scope,_t=at===void 0?V:at,bt=k.redirect_uri,Ht=k.post_logout_redirect_uri,At=k.client_authentication,te=At===void 0?O:At,It=k.prompt,dt=k.display,pt=k.max_age,Pt=k.ui_locales,Yt=k.acr_values,qt=k.resource,Gt=k.response_mode,ee=k.filterProtocolClaims,le=ee===void 0||ee,ne=k.loadUserInfo,Bt=ne===void 0||ne,Xt=k.staleStateAge,Jt=Xt===void 0?900:Xt,j=k.clockSkew,c=j===void 0?300:j,h=k.clockService,B=h===void 0?new _.ClockService:h,J=k.userInfoJwtIssuer,W=J===void 0?"OP":J,$=k.mergeClaims,ut=$!==void 0&&$,ft=k.stateStore,St=ft===void 0?new a.WebStorageStateStore:ft,vt=k.ResponseValidatorCtor,Tt=vt===void 0?u.ResponseValidator:vt,Vt=k.MetadataServiceCtor,Qt=Vt===void 0?o.MetadataService:Vt,oe=k.extraQueryParams,lt=oe===void 0?{}:oe,Ct=k.extraTokenParams,yt=Ct===void 0?{}:Ct;p(this,A),this._authority=M,this._metadataUrl=q,this._metadata=d,this._metadataSeed=R,this._signingKeys=b,this._client_id=Z,this._client_secret=tt,this._response_type=H,this._scope=_t,this._redirect_uri=bt,this._post_logout_redirect_uri=Ht,this._client_authentication=te,this._prompt=It,this._display=dt,this._max_age=pt,this._ui_locales=Pt,this._acr_values=Yt,this._resource=qt,this._response_mode=Gt,this._filterProtocolClaims=!!le,this._loadUserInfo=!!Bt,this._staleStateAge=Jt,this._clockSkew=c,this._clockService=B,this._userInfoJwtIssuer=W,this._mergeClaims=!!ut,this._stateStore=St,this._validator=new Tt(this),this._metadataService=new Qt(this),this._extraQueryParams=(lt===void 0?"undefined":T(lt))==="object"?lt:{},this._extraTokenParams=(yt===void 0?"undefined":T(yt))==="object"?yt:{}}return A.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},l(A,[{key:"client_id",get:function(){return this._client_id},set:function(M){if(this._client_id)throw U.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=M}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(M){if(this._authority)throw U.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=M}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(I)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=I)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(M){this._metadata=M}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(M){this._metadataSeed=M}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(M){this._signingKeys=M}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(M){(M===void 0?"undefined":T(M))==="object"?this._extraQueryParams=M:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(M){(M===void 0?"undefined":T(M))==="object"?this._extraTokenParams=M:this._extraTokenParams={}}}]),A}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.WebStorageStateStore=void 0;var T=F(0),l=F(1);function U(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")}v.WebStorageStateStore=function(){function _(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=a.prefix,o=u===void 0?"oidc.":u,p=a.store,I=p===void 0?l.Global.localStorage:p;U(this,_),this._store=I,this._prefix=o}return _.prototype.set=function(u,o){return T.Log.debug("WebStorageStateStore.set",u),u=this._prefix+u,this._store.setItem(u,o),Promise.resolve()},_.prototype.get=function(u){T.Log.debug("WebStorageStateStore.get",u),u=this._prefix+u;var o=this._store.getItem(u);return Promise.resolve(o)},_.prototype.remove=function(u){T.Log.debug("WebStorageStateStore.remove",u),u=this._prefix+u;var o=this._store.getItem(u);return this._store.removeItem(u),Promise.resolve(o)},_.prototype.getAllKeys=function(){T.Log.debug("WebStorageStateStore.getAllKeys");for(var u=[],o=0;o<this._store.length;o++){var p=this._store.key(o);p.indexOf(this._prefix)===0&&u.push(p.substr(this._prefix.length))}return Promise.resolve(u)},_}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.JsonService=void 0;var T=F(0),l=F(1);function U(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")}v.JsonService=function(){function _(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.XMLHttpRequest,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;U(this,_),a&&Array.isArray(a)?this._contentTypes=a.slice():this._contentTypes=[],this._contentTypes.push("application/json"),o&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=u,this._jwtHandler=o}return _.prototype.getJson=function(u,o){var p=this;if(!u)throw T.Log.error("JsonService.getJson: No url passed"),new Error("url");return T.Log.debug("JsonService.getJson, url: ",u),new Promise(function(I,x){var V=new p._XMLHttpRequest;V.open("GET",u);var O=p._contentTypes,A=p._jwtHandler;V.onload=function(){if(T.Log.debug("JsonService.getJson: HTTP response received, status",V.status),V.status===200){var k=V.getResponseHeader("Content-Type");if(k){var M=O.find(function(q){if(k.startsWith(q))return!0});if(M=="application/jwt")return void A(V).then(I,x);if(M)try{return void I(JSON.parse(V.responseText))}catch(q){return T.Log.error("JsonService.getJson: Error parsing JSON response",q.message),void x(q)}}x(Error("Invalid response Content-Type: "+k+", from URL: "+u))}else x(Error(V.statusText+" ("+V.status+")"))},V.onerror=function(){T.Log.error("JsonService.getJson: network error"),x(Error("Network Error"))},o&&(T.Log.debug("JsonService.getJson: token passed, setting Authorization header"),V.setRequestHeader("Authorization","Bearer "+o)),V.send()})},_.prototype.postForm=function(u,o,p){var I=this;if(!u)throw T.Log.error("JsonService.postForm: No url passed"),new Error("url");return T.Log.debug("JsonService.postForm, url: ",u),new Promise(function(x,V){var O=new I._XMLHttpRequest;O.open("POST",u);var A=I._contentTypes;O.onload=function(){if(T.Log.debug("JsonService.postForm: HTTP response received, status",O.status),O.status!==200){if(O.status===400&&(b=O.getResponseHeader("Content-Type"))&&A.find(function(R){if(b.startsWith(R))return!0}))try{var d=JSON.parse(O.responseText);if(d&&d.error)return T.Log.error("JsonService.postForm: Error from server: ",d.error),void V(new Error(d.error))}catch(R){return T.Log.error("JsonService.postForm: Error parsing JSON response",R.message),void V(R)}V(Error(O.statusText+" ("+O.status+")"))}else{var b;if((b=O.getResponseHeader("Content-Type"))&&A.find(function(R){if(b.startsWith(R))return!0}))try{return void x(JSON.parse(O.responseText))}catch(R){return T.Log.error("JsonService.postForm: Error parsing JSON response",R.message),void V(R)}V(Error("Invalid response Content-Type: "+b+", from URL: "+u))}},O.onerror=function(){T.Log.error("JsonService.postForm: network error"),V(Error("Network Error"))};var k="";for(var M in o){var q=o[M];q&&(k.length>0&&(k+="&"),k+=encodeURIComponent(M),k+="=",k+=encodeURIComponent(q))}O.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p!==void 0&&O.setRequestHeader("Authorization","Basic "+btoa(p)),O.send(k)})},_}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SigninRequest=void 0;var T=F(0),l=F(3),U=F(13);v.SigninRequest=function(){function _(a){var u=a.url,o=a.client_id,p=a.redirect_uri,I=a.response_type,x=a.scope,V=a.authority,O=a.data,A=a.prompt,k=a.display,M=a.max_age,q=a.ui_locales,d=a.id_token_hint,b=a.login_hint,R=a.acr_values,Z=a.resource,tt=a.response_mode,nt=a.request,H=a.request_uri,at=a.extraQueryParams,_t=a.request_type,bt=a.client_secret,Ht=a.extraTokenParams,At=a.skipUserInfo;if(function(qt,Gt){if(!(qt instanceof Gt))throw new TypeError("Cannot call a class as a function")}(this,_),!u)throw T.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!o)throw T.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!p)throw T.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!I)throw T.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!x)throw T.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!V)throw T.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var te=_.isOidc(I),It=_.isCode(I);tt||(tt=_.isCode(I)?"query":null),this.state=new U.SigninState({nonce:te,data:O,client_id:o,authority:V,redirect_uri:p,code_verifier:It,request_type:_t,response_mode:tt,client_secret:bt,scope:x,extraTokenParams:Ht,skipUserInfo:At}),u=l.UrlUtility.addQueryParam(u,"client_id",o),u=l.UrlUtility.addQueryParam(u,"redirect_uri",p),u=l.UrlUtility.addQueryParam(u,"response_type",I),u=l.UrlUtility.addQueryParam(u,"scope",x),u=l.UrlUtility.addQueryParam(u,"state",this.state.id),te&&(u=l.UrlUtility.addQueryParam(u,"nonce",this.state.nonce)),It&&(u=l.UrlUtility.addQueryParam(u,"code_challenge",this.state.code_challenge),u=l.UrlUtility.addQueryParam(u,"code_challenge_method","S256"));var dt={prompt:A,display:k,max_age:M,ui_locales:q,id_token_hint:d,login_hint:b,acr_values:R,resource:Z,request:nt,request_uri:H,response_mode:tt};for(var pt in dt)dt[pt]&&(u=l.UrlUtility.addQueryParam(u,pt,dt[pt]));for(var Pt in at)u=l.UrlUtility.addQueryParam(u,Pt,at[Pt]);this.url=u}return _.isOidc=function(u){return!!u.split(/\s+/g).filter(function(o){return o==="id_token"})[0]},_.isOAuth=function(u){return!!u.split(/\s+/g).filter(function(o){return o==="token"})[0]},_.isCode=function(u){return!!u.split(/\s+/g).filter(function(o){return o==="code"})[0]},_}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.State=void 0;var T=function(){function a(u,o){for(var p=0;p<o.length;p++){var I=o[p];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(u,I.key,I)}}return function(u,o,p){return o&&a(u.prototype,o),p&&a(u,p),u}}(),l=F(0),U=function(u){return u&&u.__esModule?u:{default:u}}(F(14));function _(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}v.State=function(){function a(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=u.id,p=u.data,I=u.created,x=u.request_type;_(this,a),this._id=o||(0,U.default)(),this._data=p,this._created=typeof I=="number"&&I>0?I:parseInt(Date.now()/1e3),this._request_type=x}return a.prototype.toStorageString=function(){return l.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},a.fromStorageString=function(o){return l.Log.debug("State.fromStorageString"),new a(JSON.parse(o))},a.clearStaleState=function(o,p){var I=Date.now()/1e3-p;return o.getAllKeys().then(function(x){l.Log.debug("State.clearStaleState: got keys",x);for(var V=[],O=function(q){var d=x[q];k=o.get(d).then(function(b){var R=!1;if(b)try{var Z=a.fromStorageString(b);l.Log.debug("State.clearStaleState: got item from key: ",d,Z.created),Z.created<=I&&(R=!0)}catch(tt){l.Log.error("State.clearStaleState: Error parsing state for key",d,tt.message),R=!0}else l.Log.debug("State.clearStaleState: no item in storage for key: ",d),R=!0;if(R)return l.Log.debug("State.clearStaleState: removed item for key: ",d),o.remove(d)}),V.push(k)},A=0;A<x.length;A++){var k;O(A)}return l.Log.debug("State.clearStaleState: waiting on promise count:",V.length),Promise.all(V)})},T(a,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),a}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.OidcClient=void 0;var T=function(){function O(A,k){for(var M=0;M<k.length;M++){var q=k[M];q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(A,q.key,q)}}return function(A,k,M){return k&&O(A.prototype,k),M&&O(A,M),A}}(),l=F(0),U=F(5),_=F(12),a=F(8),u=F(34),o=F(35),p=F(36),I=F(13),x=F(9);function V(O,A){if(!(O instanceof A))throw new TypeError("Cannot call a class as a function")}v.OidcClient=function(){function O(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V(this,O),A instanceof U.OidcClientSettings?this._settings=A:this._settings=new U.OidcClientSettings(A)}return O.prototype.createSigninRequest=function(){var k=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},q=M.response_type,d=M.scope,b=M.redirect_uri,R=M.data,Z=M.state,tt=M.prompt,nt=M.display,H=M.max_age,at=M.ui_locales,_t=M.id_token_hint,bt=M.login_hint,Ht=M.acr_values,At=M.resource,te=M.request,It=M.request_uri,dt=M.response_mode,pt=M.extraQueryParams,Pt=M.extraTokenParams,Yt=M.request_type,qt=M.skipUserInfo,Gt=arguments[1];l.Log.debug("OidcClient.createSigninRequest");var ee=this._settings.client_id;q=q||this._settings.response_type,d=d||this._settings.scope,b=b||this._settings.redirect_uri,tt=tt||this._settings.prompt,nt=nt||this._settings.display,H=H||this._settings.max_age,at=at||this._settings.ui_locales,Ht=Ht||this._settings.acr_values,At=At||this._settings.resource,dt=dt||this._settings.response_mode,pt=pt||this._settings.extraQueryParams,Pt=Pt||this._settings.extraTokenParams;var le=this._settings.authority;return a.SigninRequest.isCode(q)&&q!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(ne){l.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",ne);var Bt=new a.SigninRequest({url:ne,client_id:ee,redirect_uri:b,response_type:q,scope:d,data:R||Z,authority:le,prompt:tt,display:nt,max_age:H,ui_locales:at,id_token_hint:_t,login_hint:bt,acr_values:Ht,resource:At,request:te,request_uri:It,extraQueryParams:pt,extraTokenParams:Pt,request_type:Yt,response_mode:dt,client_secret:k._settings.client_secret,skipUserInfo:qt}),Xt=Bt.state;return(Gt=Gt||k._stateStore).set(Xt.id,Xt.toStorageString()).then(function(){return Bt})})},O.prototype.readSigninResponseState=function(k,M){var q=arguments.length>2&&arguments[2]!==void 0&&arguments[2];l.Log.debug("OidcClient.readSigninResponseState");var d=this._settings.response_mode==="query"||!this._settings.response_mode&&a.SigninRequest.isCode(this._settings.response_type),b=d?"?":"#",R=new u.SigninResponse(k,b);if(!R.state)return l.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));M=M||this._stateStore;var Z=q?M.remove.bind(M):M.get.bind(M);return Z(R.state).then(function(tt){if(!tt)throw l.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:I.SigninState.fromStorageString(tt),response:R}})},O.prototype.processSigninResponse=function(k,M){var q=this;return l.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(k,M,!0).then(function(d){var b=d.state,R=d.response;return l.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),q._validator.validateSigninResponse(b,R)})},O.prototype.createSignoutRequest=function(){var k=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},q=M.id_token_hint,d=M.data,b=M.state,R=M.post_logout_redirect_uri,Z=M.extraQueryParams,tt=M.request_type,nt=arguments[1];return l.Log.debug("OidcClient.createSignoutRequest"),R=R||this._settings.post_logout_redirect_uri,Z=Z||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(H){if(!H)throw l.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");l.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",H);var at=new o.SignoutRequest({url:H,id_token_hint:q,post_logout_redirect_uri:R,data:d||b,extraQueryParams:Z,request_type:tt}),_t=at.state;return _t&&(l.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(nt=nt||k._stateStore).set(_t.id,_t.toStorageString())),at})},O.prototype.readSignoutResponseState=function(k,M){var q=arguments.length>2&&arguments[2]!==void 0&&arguments[2];l.Log.debug("OidcClient.readSignoutResponseState");var d=new p.SignoutResponse(k);if(!d.state)return l.Log.debug("OidcClient.readSignoutResponseState: No state in response"),d.error?(l.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",d.error),Promise.reject(new _.ErrorResponse(d))):Promise.resolve({state:void 0,response:d});var b=d.state;M=M||this._stateStore;var R=q?M.remove.bind(M):M.get.bind(M);return R(b).then(function(Z){if(!Z)throw l.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:x.State.fromStorageString(Z),response:d}})},O.prototype.processSignoutResponse=function(k,M){var q=this;return l.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(k,M,!0).then(function(d){var b=d.state,R=d.response;return b?(l.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),q._validator.validateSignoutResponse(b,R)):(l.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),R)})},O.prototype.clearStaleState=function(k){return l.Log.debug("OidcClient.clearStaleState"),k=k||this._stateStore,x.State.clearStaleState(k,this.settings.staleStateAge)},T(O,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),O}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.TokenClient=void 0;var T=F(7),l=F(2),U=F(0);function _(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}v.TokenClient=function(){function a(u){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T.JsonService,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService;if(_(this,a),!u)throw U.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=u,this._jsonService=new o,this._metadataService=new p(this._settings)}return a.prototype.exchangeCode=function(){var o=this,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(p=Object.assign({},p)).grant_type=p.grant_type||"authorization_code",p.client_id=p.client_id||this._settings.client_id,p.client_secret=p.client_secret||this._settings.client_secret,p.redirect_uri=p.redirect_uri||this._settings.redirect_uri;var I=void 0,x=p._client_authentication||this._settings._client_authentication;return delete p._client_authentication,p.code?p.redirect_uri?p.code_verifier?p.client_id?p.client_secret||x!="client_secret_basic"?(x=="client_secret_basic"&&(I=p.client_id+":"+p.client_secret,delete p.client_id,delete p.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(V){return U.Log.debug("TokenClient.exchangeCode: Received token endpoint"),o._jsonService.postForm(V,p,I).then(function(O){return U.Log.debug("TokenClient.exchangeCode: response received"),O})})):(U.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(U.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(U.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(U.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(U.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},a.prototype.exchangeRefreshToken=function(){var o=this,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(p=Object.assign({},p)).grant_type=p.grant_type||"refresh_token",p.client_id=p.client_id||this._settings.client_id,p.client_secret=p.client_secret||this._settings.client_secret;var I=void 0,x=p._client_authentication||this._settings._client_authentication;return delete p._client_authentication,p.refresh_token?p.client_id?(x=="client_secret_basic"&&(I=p.client_id+":"+p.client_secret,delete p.client_id,delete p.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(V){return U.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),o._jsonService.postForm(V,p,I).then(function(O){return U.Log.debug("TokenClient.exchangeRefreshToken: response received"),O})})):(U.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(U.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},a}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.ErrorResponse=void 0;var T=F(0);function l(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")}function U(_,a){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||typeof a!="object"&&typeof a!="function"?_:a}v.ErrorResponse=function(_){function a(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=u.error,p=u.error_description,I=u.error_uri,x=u.state,V=u.session_state;if(l(this,a),!o)throw T.Log.error("No error passed to ErrorResponse"),new Error("error");var O=U(this,_.call(this,p||o));return O.name="ErrorResponse",O.error=o,O.error_description=p,O.error_uri=I,O.state=x,O.session_state=V,O}return function(o,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);o.prototype=Object.create(p&&p.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(o,p):o.__proto__=p)}(a,_),a}(Error)},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SigninState=void 0;var T=function(){function p(I,x){for(var V=0;V<x.length;V++){var O=x[V];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(I,O.key,O)}}return function(I,x,V){return x&&p(I.prototype,x),V&&p(I,V),I}}(),l=F(0),U=F(9),_=F(4),a=function(I){return I&&I.__esModule?I:{default:I}}(F(14));function u(p,I){if(!(p instanceof I))throw new TypeError("Cannot call a class as a function")}function o(p,I){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!I||typeof I!="object"&&typeof I!="function"?p:I}v.SigninState=function(p){function I(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},V=x.nonce,O=x.authority,A=x.client_id,k=x.redirect_uri,M=x.code_verifier,q=x.response_mode,d=x.client_secret,b=x.scope,R=x.extraTokenParams,Z=x.skipUserInfo;u(this,I);var tt=o(this,p.call(this,arguments[0]));if(V===!0?tt._nonce=(0,a.default)():V&&(tt._nonce=V),M===!0?tt._code_verifier=(0,a.default)()+(0,a.default)()+(0,a.default)():M&&(tt._code_verifier=M),tt.code_verifier){var nt=_.JoseUtil.hashString(tt.code_verifier,"SHA256");tt._code_challenge=_.JoseUtil.hexToBase64Url(nt)}return tt._redirect_uri=k,tt._authority=O,tt._client_id=A,tt._response_mode=q,tt._client_secret=d,tt._scope=b,tt._extraTokenParams=R,tt._skipUserInfo=Z,tt}return function(V,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof O);V.prototype=Object.create(O&&O.prototype,{constructor:{value:V,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(V,O):V.__proto__=O)}(I,p),I.prototype.toStorageString=function(){return l.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},I.fromStorageString=function(V){return l.Log.debug("SigninState.fromStorageString"),new I(JSON.parse(V))},T(I,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),I}(U.State)},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.default=function(){return(T!="undefined"&&T!==null&&T.getRandomValues!==void 0?l:U)().replace(/-/g,"")};var T=typeof window!="undefined"?window.crypto||window.msCrypto:null;function l(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(_){return(_^T.getRandomValues(new Uint8Array(1))[0]&15>>_/4).toString(16)})}function U(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(_){return(_^16*Math.random()>>_/4).toString(16)})}et.exports=v.default},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.User=void 0;var T=function(){function U(_,a){for(var u=0;u<a.length;u++){var o=a[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}return function(_,a,u){return a&&U(_.prototype,a),u&&U(_,u),_}}(),l=F(0);v.User=function(){function U(_){var a=_.id_token,u=_.session_state,o=_.access_token,p=_.refresh_token,I=_.token_type,x=_.scope,V=_.profile,O=_.expires_at,A=_.state;(function(M,q){if(!(M instanceof q))throw new TypeError("Cannot call a class as a function")})(this,U),this.id_token=a,this.session_state=u,this.access_token=o,this.refresh_token=p,this.token_type=I,this.scope=x,this.profile=V,this.expires_at=O,this.state=A}return U.prototype.toStorageString=function(){return l.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},U.fromStorageString=function(a){return l.Log.debug("User.fromStorageString"),new U(JSON.parse(a))},T(U,[{key:"expires_in",get:function(){if(this.expires_at){var a=parseInt(Date.now()/1e3);return this.expires_at-a}},set:function(a){var u=parseInt(a);if(typeof u=="number"&&u>0){var o=parseInt(Date.now()/1e3);this.expires_at=o+u}}},{key:"expired",get:function(){var a=this.expires_in;if(a!==void 0)return a<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.AccessTokenEvents=void 0;var T=F(0),l=F(46);function U(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")}v.AccessTokenEvents=function(){function _(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=a.accessTokenExpiringNotificationTime,o=u===void 0?60:u,p=a.accessTokenExpiringTimer,I=p===void 0?new l.Timer("Access token expiring"):p,x=a.accessTokenExpiredTimer,V=x===void 0?new l.Timer("Access token expired"):x;U(this,_),this._accessTokenExpiringNotificationTime=o,this._accessTokenExpiring=I,this._accessTokenExpired=V}return _.prototype.load=function(u){if(u.access_token&&u.expires_in!==void 0){var o=u.expires_in;if(T.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",o),o>0){var p=o-this._accessTokenExpiringNotificationTime;p<=0&&(p=1),T.Log.debug("AccessTokenEvents.load: registering expiring timer in:",p),this._accessTokenExpiring.init(p)}else T.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var I=o+1;T.Log.debug("AccessTokenEvents.load: registering expired timer in:",I),this._accessTokenExpired.init(I)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},_.prototype.unload=function(){T.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},_.prototype.addAccessTokenExpiring=function(u){this._accessTokenExpiring.addHandler(u)},_.prototype.removeAccessTokenExpiring=function(u){this._accessTokenExpiring.removeHandler(u)},_.prototype.addAccessTokenExpired=function(u){this._accessTokenExpired.addHandler(u)},_.prototype.removeAccessTokenExpired=function(u){this._accessTokenExpired.removeHandler(u)},_}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.Event=void 0;var T=F(0);v.Event=function(){function l(U){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,l),this._name=U,this._callbacks=[]}return l.prototype.addHandler=function(_){this._callbacks.push(_)},l.prototype.removeHandler=function(_){var a=this._callbacks.findIndex(function(u){return u===_});a>=0&&this._callbacks.splice(a,1)},l.prototype.raise=function(){T.Log.debug("Event: Raising event: "+this._name);for(var _=0;_<this._callbacks.length;_++){var a;(a=this._callbacks)[_].apply(a,arguments)}},l}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SessionMonitor=void 0;var T=function(){function u(o,p){for(var I=0;I<p.length;I++){var x=p[I];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(o,x.key,x)}}return function(o,p,I){return p&&u(o.prototype,p),I&&u(o,I),o}}(),l=F(0),U=F(19),_=F(1);function a(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")}v.SessionMonitor=function(){function u(o){var p=this,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.CheckSessionIFrame,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_.Global.timer;if(a(this,u),!o)throw l.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=o,this._CheckSessionIFrameCtor=I,this._timer=x,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(V){V?p._start(V):p._settings.monitorAnonymousSession&&p._userManager.querySessionStatus().then(function(O){var A={session_state:O.session_state};O.sub&&O.sid&&(A.profile={sub:O.sub,sid:O.sid}),p._start(A)}).catch(function(O){l.Log.error("SessionMonitor ctor: error from querySessionStatus:",O.message)})}).catch(function(V){l.Log.error("SessionMonitor ctor: error from getUser:",V.message)}))}return u.prototype._start=function(p){var I=this,x=p.session_state;x&&(p.profile?(this._sub=p.profile.sub,this._sid=p.profile.sid,l.Log.debug("SessionMonitor._start: session_state:",x,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,l.Log.debug("SessionMonitor._start: session_state:",x,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(x):this._metadataService.getCheckSessionIframe().then(function(V){if(V){l.Log.debug("SessionMonitor._start: Initializing check session iframe");var O=I._client_id,A=I._checkSessionInterval,k=I._stopCheckSessionOnError;I._checkSessionIFrame=new I._CheckSessionIFrameCtor(I._callback.bind(I),O,V,A,k),I._checkSessionIFrame.load().then(function(){I._checkSessionIFrame.start(x)})}else l.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(V){l.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",V.message)}))},u.prototype._stop=function(){var p=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(l.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var I=this._timer.setInterval(function(){p._timer.clearInterval(I),p._userManager.querySessionStatus().then(function(x){var V={session_state:x.session_state};x.sub&&x.sid&&(V.profile={sub:x.sub,sid:x.sid}),p._start(V)}).catch(function(x){l.Log.error("SessionMonitor: error from querySessionStatus:",x.message)})},1e3)},u.prototype._callback=function(){var p=this;this._userManager.querySessionStatus().then(function(I){var x=!0;I?I.sub===p._sub?(x=!1,p._checkSessionIFrame.start(I.session_state),I.sid===p._sid?l.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",I.session_state):(l.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",I.session_state),p._userManager.events._raiseUserSessionChanged())):l.Log.debug("SessionMonitor._callback: Different subject signed into OP:",I.sub):l.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),x&&(p._sub?(l.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),p._userManager.events._raiseUserSignedOut()):(l.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),p._userManager.events._raiseUserSignedIn()))}).catch(function(I){p._sub&&(l.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",I.message),p._userManager.events._raiseUserSignedOut())})},T(u,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),u}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.CheckSessionIFrame=void 0;var T=F(0);function l(U,_){if(!(U instanceof _))throw new TypeError("Cannot call a class as a function")}v.CheckSessionIFrame=function(){function U(_,a,u,o){var p=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];l(this,U),this._callback=_,this._client_id=a,this._url=u,this._interval=o||2e3,this._stopOnError=p;var I=u.indexOf("/",u.indexOf("//")+2);this._frame_origin=u.substr(0,I),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=u}return U.prototype.load=function(){var a=this;return new Promise(function(u){a._frame.onload=function(){u()},window.document.body.appendChild(a._frame),a._boundMessageEvent=a._message.bind(a),window.addEventListener("message",a._boundMessageEvent,!1)})},U.prototype._message=function(a){a.origin===this._frame_origin&&a.source===this._frame.contentWindow&&(a.data==="error"?(T.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):a.data==="changed"?(T.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):T.Log.debug("CheckSessionIFrame: "+a.data+" message from check session op iframe"))},U.prototype.start=function(a){var u=this;if(this._session_state!==a){T.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=a;var o=function(){u._frame.contentWindow.postMessage(u._client_id+" "+u._session_state,u._frame_origin)};o(),this._timer=window.setInterval(o,this._interval)}},U.prototype.stop=function(){this._session_state=null,this._timer&&(T.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.TokenRevocationClient=void 0;var T=F(0),l=F(2),U=F(1);function _(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")}var a="access_token",u="refresh_token";v.TokenRevocationClient=function(){function o(p){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.Global.XMLHttpRequest,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService;if(_(this,o),!p)throw T.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=p,this._XMLHttpRequestCtor=I,this._metadataService=new x(this._settings)}return o.prototype.revoke=function(I,x){var V=this,O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!I)throw T.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(O!==a&&O!=u)throw T.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(A){if(A){T.Log.debug("TokenRevocationClient.revoke: Revoking "+O);var k=V._settings.client_id,M=V._settings.client_secret;return V._revoke(A,k,M,I,O)}if(x)throw T.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},o.prototype._revoke=function(I,x,V,O,A){var k=this;return new Promise(function(M,q){var d=new k._XMLHttpRequestCtor;d.open("POST",I),d.onload=function(){T.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",d.status),d.status===200?M():q(Error(d.statusText+" ("+d.status+")"))},d.onerror=function(){T.Log.debug("TokenRevocationClient.revoke: Network Error."),q("Network Error")};var b="client_id="+encodeURIComponent(x);V&&(b+="&client_secret="+encodeURIComponent(V)),b+="&token_type_hint="+encodeURIComponent(A),b+="&token="+encodeURIComponent(O),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(b)})},o}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.CordovaPopupWindow=void 0;var T=function(){function U(_,a){for(var u=0;u<a.length;u++){var o=a[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}return function(_,a,u){return a&&U(_.prototype,a),u&&U(_,u),_}}(),l=F(0);v.CordovaPopupWindow=function(){function U(_){var a=this;(function(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")})(this,U),this._promise=new Promise(function(u,o){a._resolve=u,a._reject=o}),this.features=_.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=_.popupWindowTarget||"_blank",this.redirect_uri=_.startUrl,l.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return U.prototype._isInAppBrowserInstalled=function(a){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(u){return a.hasOwnProperty(u)})},U.prototype.navigate=function(a){if(a&&a.url){if(!window.cordova)return this._error("cordova is undefined");var u=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(u)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(a.url,this.target,this.features),this._popup?(l.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},U.prototype._loadStartCallback=function(a){a.url.indexOf(this.redirect_uri)===0&&this._success({url:a.url})},U.prototype._exitCallback=function(a){this._error(a)},U.prototype._success=function(a){this._cleanup(),l.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(a)},U.prototype._error=function(a){this._cleanup(),l.Log.error(a),this._reject(new Error(a))},U.prototype.close=function(){this._cleanup()},U.prototype._cleanup=function(){this._popup&&(l.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},T(U,[{key:"promise",get:function(){return this._promise}}]),U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0});var T=F(0),l=F(10),U=F(5),_=F(6),a=F(37),u=F(38),o=F(16),p=F(2),I=F(48),x=F(49),V=F(19),O=F(20),A=F(18),k=F(1),M=F(15),q=F(50);v.default={Version:q.Version,Log:T.Log,OidcClient:l.OidcClient,OidcClientSettings:U.OidcClientSettings,WebStorageStateStore:_.WebStorageStateStore,InMemoryWebStorage:a.InMemoryWebStorage,UserManager:u.UserManager,AccessTokenEvents:o.AccessTokenEvents,MetadataService:p.MetadataService,CordovaPopupNavigator:I.CordovaPopupNavigator,CordovaIFrameNavigator:x.CordovaIFrameNavigator,CheckSessionIFrame:V.CheckSessionIFrame,TokenRevocationClient:O.TokenRevocationClient,SessionMonitor:A.SessionMonitor,Global:k.Global,User:M.User},et.exports=v.default},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.ClockService=function(){function T(){(function(U,_){if(!(U instanceof _))throw new TypeError("Cannot call a class as a function")})(this,T)}return T.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},T}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.ResponseValidator=void 0;var T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},l=F(0),U=F(2),_=F(25),a=F(11),u=F(12),o=F(4);function p(x,V){if(!(x instanceof V))throw new TypeError("Cannot call a class as a function")}var I=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];v.ResponseValidator=function(){function x(V){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.MetadataService,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_.UserInfoService,k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.JoseUtil,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:a.TokenClient;if(p(this,x),!V)throw l.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=V,this._metadataService=new O(this._settings),this._userInfoService=new A(this._settings),this._joseUtil=k,this._tokenClient=new M(this._settings)}return x.prototype.validateSigninResponse=function(O,A){var k=this;return l.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(O,A).then(function(M){return l.Log.debug("ResponseValidator.validateSigninResponse: state processed"),k._validateTokens(O,M).then(function(q){return l.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),k._processClaims(O,q).then(function(d){return l.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),d})})})},x.prototype.validateSignoutResponse=function(O,A){return O.id!==A.state?(l.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(l.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),A.state=O.data,A.error?(l.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",A.error),Promise.reject(new u.ErrorResponse(A))):Promise.resolve(A))},x.prototype._processSigninParams=function(O,A){if(O.id!==A.state)return l.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!O.client_id)return l.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!O.authority)return l.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==O.authority)return l.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=O.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==O.client_id)return l.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=O.client_id;return l.Log.debug("ResponseValidator._processSigninParams: state validated"),A.state=O.data,A.error?(l.Log.warn("ResponseValidator._processSigninParams: Response was error",A.error),Promise.reject(new u.ErrorResponse(A))):O.nonce&&!A.id_token?(l.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!O.nonce&&A.id_token?(l.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):O.code_verifier&&!A.code?(l.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!O.code_verifier&&A.code?(l.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(A.scope||(A.scope=O.scope),Promise.resolve(A))},x.prototype._processClaims=function(O,A){var k=this;if(A.isOpenIdConnect){if(l.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),A.profile=this._filterProtocolClaims(A.profile),O.skipUserInfo!==!0&&this._settings.loadUserInfo&&A.access_token)return l.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(A.access_token).then(function(M){return l.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),M.sub!==A.profile.sub?(l.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(A.profile=k._mergeClaims(A.profile,M),l.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",A.profile),A)});l.Log.debug("ResponseValidator._processClaims: not loading user info")}else l.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(A)},x.prototype._mergeClaims=function(O,A){var k=Object.assign({},O);for(var M in A){var q=A[M];Array.isArray(q)||(q=[q]);for(var d=0;d<q.length;d++){var b=q[d];k[M]?Array.isArray(k[M])?k[M].indexOf(b)<0&&k[M].push(b):k[M]!==b&&((b===void 0?"undefined":T(b))==="object"&&this._settings.mergeClaims?k[M]=this._mergeClaims(k[M],b):k[M]=[k[M],b]):k[M]=b}}return k},x.prototype._filterProtocolClaims=function(O){l.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",O);var A=Object.assign({},O);return this._settings._filterProtocolClaims?(I.forEach(function(k){delete A[k]}),l.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",A)):l.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),A},x.prototype._validateTokens=function(O,A){return A.code?(l.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(O,A)):A.id_token?A.access_token?(l.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(O,A)):(l.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(O,A)):(l.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(A))},x.prototype._processCode=function(O,A){var k=this,M={client_id:O.client_id,client_secret:O.client_secret,code:A.code,redirect_uri:O.redirect_uri,code_verifier:O.code_verifier};return O.extraTokenParams&&T(O.extraTokenParams)==="object"&&Object.assign(M,O.extraTokenParams),this._tokenClient.exchangeCode(M).then(function(q){for(var d in q)A[d]=q[d];return A.id_token?(l.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),k._validateIdTokenAttributes(O,A)):(l.Log.debug("ResponseValidator._processCode: token response successful, returning response"),A)})},x.prototype._validateIdTokenAttributes=function(O,A){var k=this;return this._metadataService.getIssuer().then(function(M){var q=O.client_id,d=k._settings.clockSkew;return l.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",d),k._settings.getEpochTime().then(function(b){return k._joseUtil.validateJwtAttributes(A.id_token,M,q,d,b).then(function(R){return O.nonce&&O.nonce!==R.nonce?(l.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):R.sub?(A.profile=R,A):(l.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},x.prototype._validateIdTokenAndAccessToken=function(O,A){var k=this;return this._validateIdToken(O,A).then(function(M){return k._validateAccessToken(M)})},x.prototype._getSigningKeyForJwt=function(O){var A=this;return this._metadataService.getSigningKeys().then(function(k){var M=O.header.kid;if(!k)return l.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));l.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var q=void 0;if(M)q=k.filter(function(d){return d.kid===M})[0];else{if((k=A._filterByAlg(k,O.header.alg)).length>1)return l.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));q=k[0]}return Promise.resolve(q)})},x.prototype._getSigningKeyForJwtWithSingleRetry=function(O){var A=this;return this._getSigningKeyForJwt(O).then(function(k){return k?Promise.resolve(k):(A._metadataService.resetSigningKeys(),A._getSigningKeyForJwt(O))})},x.prototype._validateIdToken=function(O,A){var k=this;if(!O.nonce)return l.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var M=this._joseUtil.parseJwt(A.id_token);return M&&M.header&&M.payload?O.nonce!==M.payload.nonce?(l.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(q){return l.Log.debug("ResponseValidator._validateIdToken: Received issuer"),k._getSigningKeyForJwtWithSingleRetry(M).then(function(d){if(!d)return l.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var b=O.client_id,R=k._settings.clockSkew;return l.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",R),k._joseUtil.validateJwt(A.id_token,d,q,b,R).then(function(){return l.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),M.payload.sub?(A.profile=M.payload,A):(l.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(l.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",M),Promise.reject(new Error("Failed to parse id_token")))},x.prototype._filterByAlg=function(O,A){var k=null;if(A.startsWith("RS"))k="RSA";else if(A.startsWith("PS"))k="PS";else{if(!A.startsWith("ES"))return l.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",A),[];k="EC"}return l.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",k),O=O.filter(function(M){return M.kty===k}),l.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",k,O.length),O},x.prototype._validateAccessToken=function(O){if(!O.profile)return l.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!O.profile.at_hash)return l.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!O.id_token)return l.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var A=this._joseUtil.parseJwt(O.id_token);if(!A||!A.header)return l.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",A),Promise.reject(new Error("Failed to parse id_token"));var k=A.header.alg;if(!k||k.length!==5)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",k),Promise.reject(new Error("Unsupported alg: "+k));var M=k.substr(2,3);if(!M)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",k,M),Promise.reject(new Error("Unsupported alg: "+k));if((M=parseInt(M))!==256&&M!==384&&M!==512)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",k,M),Promise.reject(new Error("Unsupported alg: "+k));var q="sha"+M,d=this._joseUtil.hashString(O.access_token,q);if(!d)return l.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",q),Promise.reject(new Error("Failed to validate at_hash"));var b=d.substr(0,d.length/2),R=this._joseUtil.hexToBase64Url(b);return R!==O.profile.at_hash?(l.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",R,O.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(l.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(O))},x}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.UserInfoService=void 0;var T=F(7),l=F(2),U=F(0),_=F(4);function a(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")}v.UserInfoService=function(){function u(o){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T.JsonService,I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService,x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:_.JoseUtil;if(a(this,u),!o)throw U.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=o,this._jsonService=new p(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new I(this._settings),this._joseUtil=x}return u.prototype.getClaims=function(p){var I=this;return p?this._metadataService.getUserInfoEndpoint().then(function(x){return U.Log.debug("UserInfoService.getClaims: received userinfo url",x),I._jsonService.getJson(x,p).then(function(V){return U.Log.debug("UserInfoService.getClaims: claims received",V),V})}):(U.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},u.prototype._getClaimsFromJwt=function(p){var I=this;try{var x=this._joseUtil.parseJwt(p.responseText);if(!x||!x.header||!x.payload)return U.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",x),Promise.reject(new Error("Failed to parse id_token"));var V=x.header.kid,O=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":O=this._metadataService.getIssuer();break;case"ANY":O=Promise.resolve(x.payload.iss);break;default:O=Promise.resolve(this._settings.userInfoJwtIssuer)}return O.then(function(A){return U.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+A),I._metadataService.getSigningKeys().then(function(k){if(!k)return U.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));U.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var M=void 0;if(V)M=k.filter(function(b){return b.kid===V})[0];else{if((k=I._filterByAlg(k,x.header.alg)).length>1)return U.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));M=k[0]}if(!M)return U.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var q=I._settings.client_id,d=I._settings.clockSkew;return U.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",d),I._joseUtil.validateJwt(p.responseText,M,A,q,d,void 0,!0).then(function(){return U.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),x.payload})})})}catch(A){return U.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",A.message),void reject(A)}},u.prototype._filterByAlg=function(p,I){var x=null;if(I.startsWith("RS"))x="RSA";else if(I.startsWith("PS"))x="PS";else{if(!I.startsWith("ES"))return U.Log.debug("UserInfoService._filterByAlg: alg not supported: ",I),[];x="EC"}return U.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",x),p=p.filter(function(V){return V.kty===x}),U.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",x,p.length),p},u}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.AllowedSigningAlgs=v.b64tohex=v.hextob64u=v.crypto=v.X509=v.KeyUtil=v.jws=void 0;var T=F(27);v.jws=T.jws,v.KeyUtil=T.KEYUTIL,v.X509=T.X509,v.crypto=T.crypto,v.hextob64u=T.hextob64u,v.b64tohex=T.b64tohex,v.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(et,v,F){(function(T){Object.defineProperty(v,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U={userAgent:!1},_={};/*!
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/if(a===void 0)var a={};a.lang={extend:function(t,r,n){if(!r||!t)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var i=function(){};if(i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=r.prototype,r.prototype.constructor==Object.prototype.constructor&&(r.prototype.constructor=r),n){var s;for(s in n)t.prototype[s]=n[s];var f=function(){},w=["toString","valueOf"];try{/MSIE/.test(U.userAgent)&&(f=function(S,E){for(s=0;s<w.length;s+=1){var C=w[s],L=E[C];typeof L=="function"&&L!=Object.prototype[C]&&(S[C]=L)}})}catch{}f(t.prototype,n)}}};/*! CryptoJS v3.1.2 core-fix.js
 * code.google.com/p/crypto-js
 * (c) 2009-2013 by Jeff Mott. All rights reserved.
 * code.google.com/p/crypto-js/wiki/License
 * THIS IS FIX of 'core.js' to fix Hmac issue.
 * https://code.google.com/p/crypto-js/issues/detail?id=84
 * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
 */var u,o,p,I,x,V,O,A,k,M,q,d=d||(u=Math,p=(o={}).lib={},I=p.Base=function(){function e(){}return{extend:function(r){e.prototype=this;var n=new e;return r&&n.mixIn(r),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),x=p.WordArray=I.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=null?r:4*t.length},toString:function(t){return(t||O).stringify(this)},concat:function(t){var r=this.words,n=t.words,i=this.sigBytes,s=t.sigBytes;if(this.clamp(),i%4)for(var f=0;f<s;f++){var w=n[f>>>2]>>>24-f%4*8&255;r[i+f>>>2]|=w<<24-(i+f)%4*8}else for(f=0;f<s;f+=4)r[i+f>>>2]=n[f>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=u.ceil(r/4)},clone:function(){var t=I.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*u.random()|0);return new x.init(r,t)}}),V=o.enc={},O=V.Hex={stringify:function(t){for(var r=t.words,n=t.sigBytes,i=[],s=0;s<n;s++){var f=r[s>>>2]>>>24-s%4*8&255;i.push((f>>>4).toString(16)),i.push((15&f).toString(16))}return i.join("")},parse:function(t){for(var r=t.length,n=[],i=0;i<r;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new x.init(n,r/2)}},A=V.Latin1={stringify:function(t){for(var r=t.words,n=t.sigBytes,i=[],s=0;s<n;s++){var f=r[s>>>2]>>>24-s%4*8&255;i.push(String.fromCharCode(f))}return i.join("")},parse:function(t){for(var r=t.length,n=[],i=0;i<r;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new x.init(n,r)}},k=V.Utf8={stringify:function(t){try{return decodeURIComponent(escape(A.stringify(t)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(t){return A.parse(unescape(encodeURIComponent(t)))}},M=p.BufferedBlockAlgorithm=I.extend({reset:function(){this._data=new x.init,this._nDataBytes=0},_append:function(t){typeof t=="string"&&(t=k.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,s=this.blockSize,f=i/(4*s),w=(f=t?u.ceil(f):u.max((0|f)-this._minBufferSize,0))*s,m=u.min(4*w,i);if(w){for(var S=0;S<w;S+=s)this._doProcessBlock(n,S);var E=n.splice(0,w);r.sigBytes-=m}return new x.init(E,m)},clone:function(){var t=I.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),p.Hasher=M.extend({cfg:I.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){M.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(r,n){return new t.init(n).finalize(r)}},_createHmacHelper:function(t){return function(r,n){return new q.HMAC.init(t,n).finalize(r)}}}),q=o.algo={},o);(function(e){var t,r=(t=d).lib,n=r.Base,i=r.WordArray;(t=t.x64={}).Word=n.extend({init:function(f,w){this.high=f,this.low=w}}),t.WordArray=n.extend({init:function(f,w){f=this.words=f||[],this.sigBytes=w!=null?w:8*f.length},toX32:function(){for(var f=this.words,w=f.length,m=[],S=0;S<w;S++){var E=f[S];m.push(E.high),m.push(E.low)}return i.create(m,this.sigBytes)},clone:function(){for(var f=n.clone.call(this),w=f.words=this.words.slice(0),m=w.length,S=0;S<m;S++)w[S]=w[S].clone();return f}})})(),function(){var e=d,t=e.lib.WordArray;e.enc.Base64={stringify:function(n){var i=n.words,s=n.sigBytes,f=this._map;n.clamp(),n=[];for(var w=0;w<s;w+=3)for(var m=(i[w>>>2]>>>24-w%4*8&255)<<16|(i[w+1>>>2]>>>24-(w+1)%4*8&255)<<8|i[w+2>>>2]>>>24-(w+2)%4*8&255,S=0;4>S&&w+.75*S<s;S++)n.push(f.charAt(m>>>6*(3-S)&63));if(i=f.charAt(64))for(;n.length%4;)n.push(i);return n.join("")},parse:function(n){var i=n.length,s=this._map;(f=s.charAt(64))&&(f=n.indexOf(f))!=-1&&(i=f);for(var f=[],w=0,m=0;m<i;m++)if(m%4){var S=s.indexOf(n.charAt(m-1))<<m%4*2,E=s.indexOf(n.charAt(m))>>>6-m%4*2;f[w>>>2]|=(S|E)<<24-w%4*8,w++}return t.create(f,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){for(var t=d,r=(i=t.lib).WordArray,n=i.Hasher,i=t.algo,s=[],f=[],w=function(G){return 4294967296*(G-(0|G))|0},m=2,S=0;64>S;){var E;t:{E=m;for(var C=e.sqrt(E),L=2;L<=C;L++)if(!(E%L)){E=!1;break t}E=!0}E&&(8>S&&(s[S]=w(e.pow(m,.5))),f[S]=w(e.pow(m,1/3)),S++),m++}var K=[];i=i.SHA256=n.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(G,X){for(var g=this._hash.words,P=g[0],D=g[1],N=g[2],Y=g[3],Q=g[4],ct=g[5],rt=g[6],gt=g[7],ot=0;64>ot;ot++){if(16>ot)K[ot]=0|G[X+ot];else{var ht=K[ot-15],wt=K[ot-2];K[ot]=((ht<<25|ht>>>7)^(ht<<14|ht>>>18)^ht>>>3)+K[ot-7]+((wt<<15|wt>>>17)^(wt<<13|wt>>>19)^wt>>>10)+K[ot-16]}ht=gt+((Q<<26|Q>>>6)^(Q<<21|Q>>>11)^(Q<<7|Q>>>25))+(Q&ct^~Q&rt)+f[ot]+K[ot],wt=((P<<30|P>>>2)^(P<<19|P>>>13)^(P<<10|P>>>22))+(P&D^P&N^D&N),gt=rt,rt=ct,ct=Q,Q=Y+ht|0,Y=N,N=D,D=P,P=ht+wt|0}g[0]=g[0]+P|0,g[1]=g[1]+D|0,g[2]=g[2]+N|0,g[3]=g[3]+Y|0,g[4]=g[4]+Q|0,g[5]=g[5]+ct|0,g[6]=g[6]+rt|0,g[7]=g[7]+gt|0},_doFinalize:function(){var G=this._data,X=G.words,g=8*this._nDataBytes,P=8*G.sigBytes;return X[P>>>5]|=128<<24-P%32,X[14+(P+64>>>9<<4)]=e.floor(g/4294967296),X[15+(P+64>>>9<<4)]=g,G.sigBytes=4*X.length,this._process(),this._hash},clone:function(){var G=n.clone.call(this);return G._hash=this._hash.clone(),G}}),t.SHA256=n._createHelper(i),t.HmacSHA256=n._createHmacHelper(i)}(Math),function(){function e(){return n.create.apply(n,arguments)}for(var t=d,r=t.lib.Hasher,n=(s=t.x64).Word,i=s.WordArray,s=t.algo,f=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],w=[],m=0;80>m;m++)w[m]=e();s=s.SHA512=r.extend({_doReset:function(){this._hash=new i.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(E,C){for(var L=(D=this._hash.words)[0],K=D[1],z=D[2],G=D[3],X=D[4],g=D[5],P=D[6],D=D[7],N=L.high,Y=L.low,Q=K.high,ct=K.low,rt=z.high,gt=z.low,ot=G.high,ht=G.low,wt=X.high,xt=X.low,Et=g.high,$t=g.low,Kt=P.high,Wt=P.low,Rt=D.high,Lt=D.low,Mt=N,zt=Y,xe=Q,Se=ct,ke=rt,be=gt,Ve=ot,Ae=ht,ae=wt,ie=xt,Le=Et,Pe=$t,Ne=Kt,Ce=Wt,Ke=Rt,Te=Lt,ue=0;80>ue;ue++){var ve=w[ue];if(16>ue)var ge=ve.high=0|E[C+2*ue],kt=ve.low=0|E[C+2*ue+1];else{ge=((kt=(ge=w[ue-15]).high)>>>1|(de=ge.low)<<31)^(kt>>>8|de<<24)^kt>>>7;var de=(de>>>1|kt<<31)^(de>>>8|kt<<24)^(de>>>7|kt<<25),we=((kt=(we=w[ue-2]).high)>>>19|(Nt=we.low)<<13)^(kt<<3|Nt>>>29)^kt>>>6,Nt=(Nt>>>19|kt<<13)^(Nt<<3|kt>>>29)^(Nt>>>6|kt<<26),qe=(kt=w[ue-7]).high,ye=(me=w[ue-16]).high,me=me.low;ge=(ge=(ge=ge+qe+((kt=de+kt.low)>>>0<de>>>0?1:0))+we+((kt=kt+Nt)>>>0<Nt>>>0?1:0))+ye+((kt=kt+me)>>>0<me>>>0?1:0),ve.high=ge,ve.low=kt}qe=ae&Le^~ae&Ne,me=ie&Pe^~ie&Ce,ve=Mt&xe^Mt&ke^xe&ke;var kr=zt&Se^zt&be^Se&be,Ar=(de=(Mt>>>28|zt<<4)^(Mt<<30|zt>>>2)^(Mt<<25|zt>>>7),we=(zt>>>28|Mt<<4)^(zt<<30|Mt>>>2)^(zt<<25|Mt>>>7),(Nt=f[ue]).high),hr=Nt.low;ye=Ke+((ae>>>14|ie<<18)^(ae>>>18|ie<<14)^(ae<<23|ie>>>9))+((Nt=Te+((ie>>>14|ae<<18)^(ie>>>18|ae<<14)^(ie<<23|ae>>>9)))>>>0<Te>>>0?1:0),Ke=Ne,Te=Ce,Ne=Le,Ce=Pe,Le=ae,Pe=ie,ae=Ve+(ye=(ye=(ye=ye+qe+((Nt=Nt+me)>>>0<me>>>0?1:0))+Ar+((Nt=Nt+hr)>>>0<hr>>>0?1:0))+ge+((Nt=Nt+kt)>>>0<kt>>>0?1:0))+((ie=Ae+Nt|0)>>>0<Ae>>>0?1:0)|0,Ve=ke,Ae=be,ke=xe,be=Se,xe=Mt,Se=zt,Mt=ye+(ve=de+ve+((kt=we+kr)>>>0<we>>>0?1:0))+((zt=Nt+kt|0)>>>0<Nt>>>0?1:0)|0}Y=L.low=Y+zt,L.high=N+Mt+(Y>>>0<zt>>>0?1:0),ct=K.low=ct+Se,K.high=Q+xe+(ct>>>0<Se>>>0?1:0),gt=z.low=gt+be,z.high=rt+ke+(gt>>>0<be>>>0?1:0),ht=G.low=ht+Ae,G.high=ot+Ve+(ht>>>0<Ae>>>0?1:0),xt=X.low=xt+ie,X.high=wt+ae+(xt>>>0<ie>>>0?1:0),$t=g.low=$t+Pe,g.high=Et+Le+($t>>>0<Pe>>>0?1:0),Wt=P.low=Wt+Ce,P.high=Kt+Ne+(Wt>>>0<Ce>>>0?1:0),Lt=D.low=Lt+Te,D.high=Rt+Ke+(Lt>>>0<Te>>>0?1:0)},_doFinalize:function(){var E=this._data,C=E.words,L=8*this._nDataBytes,K=8*E.sigBytes;return C[K>>>5]|=128<<24-K%32,C[30+(K+128>>>10<<5)]=Math.floor(L/4294967296),C[31+(K+128>>>10<<5)]=L,E.sigBytes=4*C.length,this._process(),this._hash.toX32()},clone:function(){var E=r.clone.call(this);return E._hash=this._hash.clone(),E},blockSize:32}),t.SHA512=r._createHelper(s),t.HmacSHA512=r._createHmacHelper(s)}(),function(){var e=d,t=(i=e.x64).Word,r=i.WordArray,n=(i=e.algo).SHA512,i=i.SHA384=n.extend({_doReset:function(){this._hash=new r.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var f=n._doFinalize.call(this);return f.sigBytes-=16,f}});e.SHA384=n._createHelper(i),e.HmacSHA384=n._createHmacHelper(i)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var b,R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function Z(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=R.charAt(r>>6)+R.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=R.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=R.charAt(r>>2)+R.charAt((3&r)<<4)),"=";(3&n.length)>0;)n+="=";return n}function tt(e){var t,r,n,i="",s=0;for(t=0;t<e.length&&e.charAt(t)!="=";++t)(n=R.indexOf(e.charAt(t)))<0||(s==0?(i+=At(n>>2),r=3&n,s=1):s==1?(i+=At(r<<2|n>>4),r=15&n,s=2):s==2?(i+=At(r),i+=At(n>>2),r=3&n,s=3):(i+=At(r<<2|n>>4),i+=At(15&n),s=0));return s==1&&(i+=At(r<<2)),i}function nt(e){var t,r=tt(e),n=new Array;for(t=0;2*t<r.length;++t)n[t]=parseInt(r.substring(2*t,2*t+2),16);return n}function H(e,t,r){e!=null&&(typeof e=="number"?this.fromNumber(e,t,r):t==null&&typeof e!="string"?this.fromString(e,256):this.fromString(e,t))}function at(){return new H(null)}U.appName=="Microsoft Internet Explorer"?(H.prototype.am=function(t,r,n,i,s,f){for(var w=32767&r,m=r>>15;--f>=0;){var S=32767&this[t],E=this[t++]>>15,C=m*S+E*w;s=((S=w*S+((32767&C)<<15)+n[i]+(1073741823&s))>>>30)+(C>>>15)+m*E+(s>>>30),n[i++]=1073741823&S}return s},b=30):U.appName!="Netscape"?(H.prototype.am=function(t,r,n,i,s,f){for(;--f>=0;){var w=r*this[t++]+n[i]+s;s=Math.floor(w/67108864),n[i++]=67108863&w}return s},b=26):(H.prototype.am=function(t,r,n,i,s,f){for(var w=16383&r,m=r>>14;--f>=0;){var S=16383&this[t],E=this[t++]>>14,C=m*S+E*w;s=((S=w*S+((16383&C)<<14)+n[i]+s)>>28)+(C>>14)+m*E,n[i++]=268435455&S}return s},b=28),H.prototype.DB=b,H.prototype.DM=(1<<b)-1,H.prototype.DV=1<<b,H.prototype.FV=Math.pow(2,52),H.prototype.F1=52-b,H.prototype.F2=2*b-52;var _t,bt,Ht=new Array;for(_t="0".charCodeAt(0),bt=0;bt<=9;++bt)Ht[_t++]=bt;for(_t="a".charCodeAt(0),bt=10;bt<36;++bt)Ht[_t++]=bt;for(_t="A".charCodeAt(0),bt=10;bt<36;++bt)Ht[_t++]=bt;function At(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function te(e,t){var r=Ht[e.charCodeAt(t)];return r==null?-1:r}function It(e){var t=at();return t.fromInt(e),t}function dt(e){var t,r=1;return(t=e>>>16)!=0&&(e=t,r+=16),(t=e>>8)!=0&&(e=t,r+=8),(t=e>>4)!=0&&(e=t,r+=4),(t=e>>2)!=0&&(e=t,r+=2),(t=e>>1)!=0&&(e=t,r+=1),r}function pt(e){this.m=e}function Pt(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Yt(e,t){return e&t}function qt(e,t){return e|t}function Gt(e,t){return e^t}function ee(e,t){return e&~t}function le(e){if(e==0)return-1;var t=0;return(65535&e)==0&&(e>>=16,t+=16),(255&e)==0&&(e>>=8,t+=8),(15&e)==0&&(e>>=4,t+=4),(3&e)==0&&(e>>=2,t+=2),(1&e)==0&&++t,t}function ne(e){for(var t=0;e!=0;)e&=e-1,++t;return t}function Bt(){}function Xt(e){return e}function Jt(e){this.r2=at(),this.q3=at(),H.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}pt.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},pt.prototype.revert=function(t){return t},pt.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},pt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n),this.reduce(n)},pt.prototype.sqrTo=function(t,r){t.squareTo(r),this.reduce(r)},Pt.prototype.convert=function(t){var r=at();return t.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),t.s<0&&r.compareTo(H.ZERO)>0&&this.m.subTo(r,r),r},Pt.prototype.revert=function(t){var r=at();return t.copyTo(r),this.reduce(r),r},Pt.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var r=0;r<this.m.t;++r){var n=32767&t[r],i=n*this.mpl+((n*this.mph+(t[r]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=r+this.m.t]+=this.m.am(0,i,t,r,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},Pt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n),this.reduce(n)},Pt.prototype.sqrTo=function(t,r){t.squareTo(r),this.reduce(r)},H.prototype.copyTo=function(t){for(var r=this.t-1;r>=0;--r)t[r]=this[r];t.t=this.t,t.s=this.s},H.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},H.prototype.fromString=function(t,r){var n;if(r==16)n=4;else if(r==8)n=3;else if(r==256)n=8;else if(r==2)n=1;else if(r==32)n=5;else{if(r!=4)return void this.fromRadix(t,r);n=2}this.t=0,this.s=0;for(var i=t.length,s=!1,f=0;--i>=0;){var w=n==8?255&t[i]:te(t,i);w<0?t.charAt(i)=="-"&&(s=!0):(s=!1,f==0?this[this.t++]=w:f+n>this.DB?(this[this.t-1]|=(w&(1<<this.DB-f)-1)<<f,this[this.t++]=w>>this.DB-f):this[this.t-1]|=w<<f,(f+=n)>=this.DB&&(f-=this.DB))}n==8&&(128&t[0])!=0&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),s&&H.ZERO.subTo(this,this)},H.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},H.prototype.dlShiftTo=function(t,r){var n;for(n=this.t-1;n>=0;--n)r[n+t]=this[n];for(n=t-1;n>=0;--n)r[n]=0;r.t=this.t+t,r.s=this.s},H.prototype.drShiftTo=function(t,r){for(var n=t;n<this.t;++n)r[n-t]=this[n];r.t=Math.max(this.t-t,0),r.s=this.s},H.prototype.lShiftTo=function(t,r){var n,i=t%this.DB,s=this.DB-i,f=(1<<s)-1,w=Math.floor(t/this.DB),m=this.s<<i&this.DM;for(n=this.t-1;n>=0;--n)r[n+w+1]=this[n]>>s|m,m=(this[n]&f)<<i;for(n=w-1;n>=0;--n)r[n]=0;r[w]=m,r.t=this.t+w+1,r.s=this.s,r.clamp()},H.prototype.rShiftTo=function(t,r){r.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)r.t=0;else{var i=t%this.DB,s=this.DB-i,f=(1<<i)-1;r[0]=this[n]>>i;for(var w=n+1;w<this.t;++w)r[w-n-1]|=(this[w]&f)<<s,r[w-n]=this[w]>>i;i>0&&(r[this.t-n-1]|=(this.s&f)<<s),r.t=this.t-n,r.clamp()}},H.prototype.subTo=function(t,r){for(var n=0,i=0,s=Math.min(t.t,this.t);n<s;)i+=this[n]-t[n],r[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],r[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],r[n++]=i&this.DM,i>>=this.DB;i-=t.s}r.s=i<0?-1:0,i<-1?r[n++]=this.DV+i:i>0&&(r[n++]=i),r.t=n,r.clamp()},H.prototype.multiplyTo=function(t,r){var n=this.abs(),i=t.abs(),s=n.t;for(r.t=s+i.t;--s>=0;)r[s]=0;for(s=0;s<i.t;++s)r[s+n.t]=n.am(0,i[s],r,s,0,n.t);r.s=0,r.clamp(),this.s!=t.s&&H.ZERO.subTo(r,r)},H.prototype.squareTo=function(t){for(var r=this.abs(),n=t.t=2*r.t;--n>=0;)t[n]=0;for(n=0;n<r.t-1;++n){var i=r.am(n,r[n],t,2*n,0,1);(t[n+r.t]+=r.am(n+1,2*r[n],t,2*n+1,i,r.t-n-1))>=r.DV&&(t[n+r.t]-=r.DV,t[n+r.t+1]=1)}t.t>0&&(t[t.t-1]+=r.am(n,r[n],t,2*n,0,1)),t.s=0,t.clamp()},H.prototype.divRemTo=function(t,r,n){var i=t.abs();if(!(i.t<=0)){var s=this.abs();if(s.t<i.t)return r!=null&&r.fromInt(0),void(n!=null&&this.copyTo(n));n==null&&(n=at());var f=at(),w=this.s,m=t.s,S=this.DB-dt(i[i.t-1]);S>0?(i.lShiftTo(S,f),s.lShiftTo(S,n)):(i.copyTo(f),s.copyTo(n));var E=f.t,C=f[E-1];if(C!=0){var L=C*(1<<this.F1)+(E>1?f[E-2]>>this.F2:0),K=this.FV/L,z=(1<<this.F1)/L,G=1<<this.F2,X=n.t,g=X-E,P=r==null?at():r;for(f.dlShiftTo(g,P),n.compareTo(P)>=0&&(n[n.t++]=1,n.subTo(P,n)),H.ONE.dlShiftTo(E,P),P.subTo(f,f);f.t<E;)f[f.t++]=0;for(;--g>=0;){var D=n[--X]==C?this.DM:Math.floor(n[X]*K+(n[X-1]+G)*z);if((n[X]+=f.am(0,D,n,g,0,E))<D)for(f.dlShiftTo(g,P),n.subTo(P,n);n[X]<--D;)n.subTo(P,n)}r!=null&&(n.drShiftTo(E,r),w!=m&&H.ZERO.subTo(r,r)),n.t=E,n.clamp(),S>0&&n.rShiftTo(S,n),w<0&&H.ZERO.subTo(n,n)}}},H.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if((1&t)==0)return 0;var r=3&t;return(r=(r=(r=(r=r*(2-(15&t)*r)&15)*(2-(255&t)*r)&255)*(2-((65535&t)*r&65535))&65535)*(2-t*r%this.DV)%this.DV)>0?this.DV-r:-r},H.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},H.prototype.exp=function(t,r){if(t>4294967295||t<1)return H.ONE;var n=at(),i=at(),s=r.convert(this),f=dt(t)-1;for(s.copyTo(n);--f>=0;)if(r.sqrTo(n,i),(t&1<<f)>0)r.mulTo(i,s,n);else{var w=n;n=i,i=w}return r.revert(n)},H.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var r;if(t==16)r=4;else if(t==8)r=3;else if(t==2)r=1;else if(t==32)r=5;else{if(t!=4)return this.toRadix(t);r=2}var n,i=(1<<r)-1,s=!1,f="",w=this.t,m=this.DB-w*this.DB%r;if(w-- >0)for(m<this.DB&&(n=this[w]>>m)>0&&(s=!0,f=At(n));w>=0;)m<r?(n=(this[w]&(1<<m)-1)<<r-m,n|=this[--w]>>(m+=this.DB-r)):(n=this[w]>>(m-=r)&i,m<=0&&(m+=this.DB,--w)),n>0&&(s=!0),s&&(f+=At(n));return s?f:"0"},H.prototype.negate=function(){var t=at();return H.ZERO.subTo(this,t),t},H.prototype.abs=function(){return this.s<0?this.negate():this},H.prototype.compareTo=function(t){var r=this.s-t.s;if(r!=0)return r;var n=this.t;if((r=n-t.t)!=0)return this.s<0?-r:r;for(;--n>=0;)if((r=this[n]-t[n])!=0)return r;return 0},H.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+dt(this[this.t-1]^this.s&this.DM)},H.prototype.mod=function(t){var r=at();return this.abs().divRemTo(t,null,r),this.s<0&&r.compareTo(H.ZERO)>0&&t.subTo(r,r),r},H.prototype.modPowInt=function(t,r){var n;return n=t<256||r.isEven()?new pt(r):new Pt(r),this.exp(t,n)},H.ZERO=It(0),H.ONE=It(1),Bt.prototype.convert=Xt,Bt.prototype.revert=Xt,Bt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n)},Bt.prototype.sqrTo=function(t,r){t.squareTo(r)},Jt.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var r=at();return t.copyTo(r),this.reduce(r),r},Jt.prototype.revert=function(t){return t},Jt.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},Jt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n),this.reduce(n)},Jt.prototype.sqrTo=function(t,r){t.squareTo(r),this.reduce(r)};var j=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],c=(1<<26)/j[j.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function h(){this.i=0,this.j=0,this.S=new Array}H.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},H.prototype.toRadix=function(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var r=this.chunkSize(t),n=Math.pow(t,r),i=It(n),s=at(),f=at(),w="";for(this.divRemTo(i,s,f);s.signum()>0;)w=(n+f.intValue()).toString(t).substr(1)+w,s.divRemTo(i,s,f);return f.intValue().toString(t)+w},H.prototype.fromRadix=function(t,r){this.fromInt(0),r==null&&(r=10);for(var n=this.chunkSize(r),i=Math.pow(r,n),s=!1,f=0,w=0,m=0;m<t.length;++m){var S=te(t,m);S<0?t.charAt(m)=="-"&&this.signum()==0&&(s=!0):(w=r*w+S,++f>=n&&(this.dMultiply(i),this.dAddOffset(w,0),f=0,w=0))}f>0&&(this.dMultiply(Math.pow(r,f)),this.dAddOffset(w,0)),s&&H.ZERO.subTo(this,this)},H.prototype.fromNumber=function(t,r,n){if(typeof r=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(H.ONE.shiftLeft(t-1),qt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(H.ONE.shiftLeft(t-1),this);else{var i=new Array,s=7&t;i.length=1+(t>>3),r.nextBytes(i),s>0?i[0]&=(1<<s)-1:i[0]=0,this.fromString(i,256)}},H.prototype.bitwiseTo=function(t,r,n){var i,s,f=Math.min(t.t,this.t);for(i=0;i<f;++i)n[i]=r(this[i],t[i]);if(t.t<this.t){for(s=t.s&this.DM,i=f;i<this.t;++i)n[i]=r(this[i],s);n.t=this.t}else{for(s=this.s&this.DM,i=f;i<t.t;++i)n[i]=r(s,t[i]);n.t=t.t}n.s=r(this.s,t.s),n.clamp()},H.prototype.changeBit=function(t,r){var n=H.ONE.shiftLeft(t);return this.bitwiseTo(n,r,n),n},H.prototype.addTo=function(t,r){for(var n=0,i=0,s=Math.min(t.t,this.t);n<s;)i+=this[n]+t[n],r[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],r[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],r[n++]=i&this.DM,i>>=this.DB;i+=t.s}r.s=i<0?-1:0,i>0?r[n++]=i:i<-1&&(r[n++]=this.DV+i),r.t=n,r.clamp()},H.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},H.prototype.dAddOffset=function(t,r){if(t!=0){for(;this.t<=r;)this[this.t++]=0;for(this[r]+=t;this[r]>=this.DV;)this[r]-=this.DV,++r>=this.t&&(this[this.t++]=0),++this[r]}},H.prototype.multiplyLowerTo=function(t,r,n){var i,s=Math.min(this.t+t.t,r);for(n.s=0,n.t=s;s>0;)n[--s]=0;for(i=n.t-this.t;s<i;++s)n[s+this.t]=this.am(0,t[s],n,s,0,this.t);for(i=Math.min(t.t,r);s<i;++s)this.am(0,t[s],n,s,0,r-s);n.clamp()},H.prototype.multiplyUpperTo=function(t,r,n){--r;var i=n.t=this.t+t.t-r;for(n.s=0;--i>=0;)n[i]=0;for(i=Math.max(r-this.t,0);i<t.t;++i)n[this.t+i-r]=this.am(r-i,t[i],n,0,0,this.t+i-r);n.clamp(),n.drShiftTo(1,n)},H.prototype.modInt=function(t){if(t<=0)return 0;var r=this.DV%t,n=this.s<0?t-1:0;if(this.t>0)if(r==0)n=this[0]%t;else for(var i=this.t-1;i>=0;--i)n=(r*n+this[i])%t;return n},H.prototype.millerRabin=function(t){var r=this.subtract(H.ONE),n=r.getLowestSetBit();if(n<=0)return!1;var i=r.shiftRight(n);(t=t+1>>1)>j.length&&(t=j.length);for(var s=at(),f=0;f<t;++f){s.fromInt(j[Math.floor(Math.random()*j.length)]);var w=s.modPow(i,this);if(w.compareTo(H.ONE)!=0&&w.compareTo(r)!=0){for(var m=1;m++<n&&w.compareTo(r)!=0;)if((w=w.modPowInt(2,this)).compareTo(H.ONE)==0)return!1;if(w.compareTo(r)!=0)return!1}}return!0},H.prototype.clone=function(){var t=at();return this.copyTo(t),t},H.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},H.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},H.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},H.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},H.prototype.toByteArray=function(){var t=this.t,r=new Array;r[0]=this.s;var n,i=this.DB-t*this.DB%8,s=0;if(t-- >0)for(i<this.DB&&(n=this[t]>>i)!=(this.s&this.DM)>>i&&(r[s++]=n|this.s<<this.DB-i);t>=0;)i<8?(n=(this[t]&(1<<i)-1)<<8-i,n|=this[--t]>>(i+=this.DB-8)):(n=this[t]>>(i-=8)&255,i<=0&&(i+=this.DB,--t)),(128&n)!=0&&(n|=-256),s==0&&(128&this.s)!=(128&n)&&++s,(s>0||n!=this.s)&&(r[s++]=n);return r},H.prototype.equals=function(t){return this.compareTo(t)==0},H.prototype.min=function(t){return this.compareTo(t)<0?this:t},H.prototype.max=function(t){return this.compareTo(t)>0?this:t},H.prototype.and=function(t){var r=at();return this.bitwiseTo(t,Yt,r),r},H.prototype.or=function(t){var r=at();return this.bitwiseTo(t,qt,r),r},H.prototype.xor=function(t){var r=at();return this.bitwiseTo(t,Gt,r),r},H.prototype.andNot=function(t){var r=at();return this.bitwiseTo(t,ee,r),r},H.prototype.not=function(){for(var t=at(),r=0;r<this.t;++r)t[r]=this.DM&~this[r];return t.t=this.t,t.s=~this.s,t},H.prototype.shiftLeft=function(t){var r=at();return t<0?this.rShiftTo(-t,r):this.lShiftTo(t,r),r},H.prototype.shiftRight=function(t){var r=at();return t<0?this.lShiftTo(-t,r):this.rShiftTo(t,r),r},H.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(this[t]!=0)return t*this.DB+le(this[t]);return this.s<0?this.t*this.DB:-1},H.prototype.bitCount=function(){for(var t=0,r=this.s&this.DM,n=0;n<this.t;++n)t+=ne(this[n]^r);return t},H.prototype.testBit=function(t){var r=Math.floor(t/this.DB);return r>=this.t?this.s!=0:(this[r]&1<<t%this.DB)!=0},H.prototype.setBit=function(t){return this.changeBit(t,qt)},H.prototype.clearBit=function(t){return this.changeBit(t,ee)},H.prototype.flipBit=function(t){return this.changeBit(t,Gt)},H.prototype.add=function(t){var r=at();return this.addTo(t,r),r},H.prototype.subtract=function(t){var r=at();return this.subTo(t,r),r},H.prototype.multiply=function(t){var r=at();return this.multiplyTo(t,r),r},H.prototype.divide=function(t){var r=at();return this.divRemTo(t,r,null),r},H.prototype.remainder=function(t){var r=at();return this.divRemTo(t,null,r),r},H.prototype.divideAndRemainder=function(t){var r=at(),n=at();return this.divRemTo(t,r,n),new Array(r,n)},H.prototype.modPow=function(t,r){var n,i,s=t.bitLength(),f=It(1);if(s<=0)return f;n=s<18?1:s<48?3:s<144?4:s<768?5:6,i=s<8?new pt(r):r.isEven()?new Jt(r):new Pt(r);var w=new Array,m=3,S=n-1,E=(1<<n)-1;if(w[1]=i.convert(this),n>1){var C=at();for(i.sqrTo(w[1],C);m<=E;)w[m]=at(),i.mulTo(C,w[m-2],w[m]),m+=2}var L,K,z=t.t-1,G=!0,X=at();for(s=dt(t[z])-1;z>=0;){for(s>=S?L=t[z]>>s-S&E:(L=(t[z]&(1<<s+1)-1)<<S-s,z>0&&(L|=t[z-1]>>this.DB+s-S)),m=n;(1&L)==0;)L>>=1,--m;if((s-=m)<0&&(s+=this.DB,--z),G)w[L].copyTo(f),G=!1;else{for(;m>1;)i.sqrTo(f,X),i.sqrTo(X,f),m-=2;m>0?i.sqrTo(f,X):(K=f,f=X,X=K),i.mulTo(X,w[L],f)}for(;z>=0&&(t[z]&1<<s)==0;)i.sqrTo(f,X),K=f,f=X,X=K,--s<0&&(s=this.DB-1,--z)}return i.revert(f)},H.prototype.modInverse=function(t){var r=t.isEven();if(this.isEven()&&r||t.signum()==0)return H.ZERO;for(var n=t.clone(),i=this.clone(),s=It(1),f=It(0),w=It(0),m=It(1);n.signum()!=0;){for(;n.isEven();)n.rShiftTo(1,n),r?(s.isEven()&&f.isEven()||(s.addTo(this,s),f.subTo(t,f)),s.rShiftTo(1,s)):f.isEven()||f.subTo(t,f),f.rShiftTo(1,f);for(;i.isEven();)i.rShiftTo(1,i),r?(w.isEven()&&m.isEven()||(w.addTo(this,w),m.subTo(t,m)),w.rShiftTo(1,w)):m.isEven()||m.subTo(t,m),m.rShiftTo(1,m);n.compareTo(i)>=0?(n.subTo(i,n),r&&s.subTo(w,s),f.subTo(m,f)):(i.subTo(n,i),r&&w.subTo(s,w),m.subTo(f,m))}return i.compareTo(H.ONE)!=0?H.ZERO:m.compareTo(t)>=0?m.subtract(t):m.signum()<0?(m.addTo(t,m),m.signum()<0?m.add(t):m):m},H.prototype.pow=function(t){return this.exp(t,new Bt)},H.prototype.gcd=function(t){var r=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();if(r.compareTo(n)<0){var i=r;r=n,n=i}var s=r.getLowestSetBit(),f=n.getLowestSetBit();if(f<0)return r;for(s<f&&(f=s),f>0&&(r.rShiftTo(f,r),n.rShiftTo(f,n));r.signum()>0;)(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),(s=n.getLowestSetBit())>0&&n.rShiftTo(s,n),r.compareTo(n)>=0?(r.subTo(n,r),r.rShiftTo(1,r)):(n.subTo(r,n),n.rShiftTo(1,n));return f>0&&n.lShiftTo(f,n),n},H.prototype.isProbablePrime=function(t){var r,n=this.abs();if(n.t==1&&n[0]<=j[j.length-1]){for(r=0;r<j.length;++r)if(n[0]==j[r])return!0;return!1}if(n.isEven())return!1;for(r=1;r<j.length;){for(var i=j[r],s=r+1;s<j.length&&i<c;)i*=j[s++];for(i=n.modInt(i);r<s;)if(i%j[r++]==0)return!1}return n.millerRabin(t)},H.prototype.square=function(){var t=at();return this.squareTo(t),t},h.prototype.init=function(t){var r,n,i;for(r=0;r<256;++r)this.S[r]=r;for(n=0,r=0;r<256;++r)n=n+this.S[r]+t[r%t.length]&255,i=this.S[r],this.S[r]=this.S[n],this.S[n]=i;this.i=0,this.j=0},h.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var B,J,W;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function $(){(function(t){J[W++]^=255&t,J[W++]^=t>>8&255,J[W++]^=t>>16&255,J[W++]^=t>>24&255,W>=256&&(W-=256)})(new Date().getTime())}if(J==null){var ut;if(J=new Array,W=0,_!==void 0&&(_.crypto!==void 0||_.msCrypto!==void 0)){var ft=_.crypto||_.msCrypto;if(ft.getRandomValues){var St=new Uint8Array(32);for(ft.getRandomValues(St),ut=0;ut<32;++ut)J[W++]=St[ut]}else if(U.appName=="Netscape"&&U.appVersion<"5"){var vt=_.crypto.random(32);for(ut=0;ut<vt.length;++ut)J[W++]=255&vt.charCodeAt(ut)}}for(;W<256;)ut=Math.floor(65536*Math.random()),J[W++]=ut>>>8,J[W++]=255&ut;W=0,$()}function Tt(){if(B==null){for($(),(B=function(){return new h}()).init(J),W=0;W<J.length;++W)J[W]=0;W=0}return B.next()}function Vt(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Qt(e,t){return new H(e,t)}function oe(e,t,r){for(var n="",i=0;n.length<t;)n+=r(String.fromCharCode.apply(String,e.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return n}function lt(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Ct(e,t){this.x=t,this.q=e}function yt(e,t,r,n){this.curve=e,this.x=t,this.y=r,this.z=n==null?H.ONE:n,this.zinv=null}function pe(e,t,r){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(r),this.infinity=new yt(this,null,null)}Vt.prototype.nextBytes=function(t){var r;for(r=0;r<t.length;++r)t[r]=Tt()},lt.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},lt.prototype.setPublic=function(t,r){if(this.isPublic=!0,this.isPrivate=!1,typeof t!="string")this.n=t,this.e=r;else{if(!(t!=null&&r!=null&&t.length>0&&r.length>0))throw"Invalid RSA public key";this.n=Qt(t,16),this.e=parseInt(r,16)}},lt.prototype.encrypt=function(t){var r=function(f,w){if(w<f.length+11)throw"Message too long for RSA";for(var m=new Array,S=f.length-1;S>=0&&w>0;){var E=f.charCodeAt(S--);E<128?m[--w]=E:E>127&&E<2048?(m[--w]=63&E|128,m[--w]=E>>6|192):(m[--w]=63&E|128,m[--w]=E>>6&63|128,m[--w]=E>>12|224)}m[--w]=0;for(var C=new Vt,L=new Array;w>2;){for(L[0]=0;L[0]==0;)C.nextBytes(L);m[--w]=L[0]}return m[--w]=2,m[--w]=0,new H(m)}(t,this.n.bitLength()+7>>3);if(r==null)return null;var n=this.doPublic(r);if(n==null)return null;var i=n.toString(16);return(1&i.length)==0?i:"0"+i},lt.prototype.encryptOAEP=function(t,r,n){var i=function(m,S,E,C){var L=y.crypto.MessageDigest,K=y.crypto.Util,z=null;if(E||(E="sha1"),typeof E=="string"&&(z=L.getCanonicalAlgName(E),C=L.getHashLength(z),E=function(rt){return re(K.hashHex(ce(rt),z))}),m.length+2*C+2>S)throw"Message too long for RSA";var G,X="";for(G=0;G<S-m.length-2*C-2;G+=1)X+="\0";var g=E("")+X+""+m,P=new Array(C);new Vt().nextBytes(P);var D=oe(P,g.length,E),N=[];for(G=0;G<g.length;G+=1)N[G]=g.charCodeAt(G)^D.charCodeAt(G);var Y=oe(N,P.length,E),Q=[0];for(G=0;G<P.length;G+=1)Q[G+1]=P[G]^Y.charCodeAt(G);return new H(Q.concat(N))}(t,this.n.bitLength()+7>>3,r,n);if(i==null)return null;var s=this.doPublic(i);if(s==null)return null;var f=s.toString(16);return(1&f.length)==0?f:"0"+f},lt.prototype.type="RSA",Ct.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.x.equals(t.x)},Ct.prototype.toBigInteger=function(){return this.x},Ct.prototype.negate=function(){return new Ct(this.q,this.x.negate().mod(this.q))},Ct.prototype.add=function(t){return new Ct(this.q,this.x.add(t.toBigInteger()).mod(this.q))},Ct.prototype.subtract=function(t){return new Ct(this.q,this.x.subtract(t.toBigInteger()).mod(this.q))},Ct.prototype.multiply=function(t){return new Ct(this.q,this.x.multiply(t.toBigInteger()).mod(this.q))},Ct.prototype.square=function(){return new Ct(this.q,this.x.square().mod(this.q))},Ct.prototype.divide=function(t){return new Ct(this.q,this.x.multiply(t.toBigInteger().modInverse(this.q)).mod(this.q))},yt.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},yt.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},yt.prototype.equals=function(t){return t==this||(this.isInfinity()?t.isInfinity():t.isInfinity()?this.isInfinity():!!t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(H.ZERO)&&t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(H.ZERO))},yt.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(H.ZERO)&&!this.y.toBigInteger().equals(H.ZERO)},yt.prototype.negate=function(){return new yt(this.curve,this.x,this.y.negate(),this.z)},yt.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var r=t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q),n=t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q);if(H.ZERO.equals(n))return H.ZERO.equals(r)?this.twice():this.curve.getInfinity();var i=new H("3"),s=this.x.toBigInteger(),f=this.y.toBigInteger(),w=(t.x.toBigInteger(),t.y.toBigInteger(),n.square()),m=w.multiply(n),S=s.multiply(w),E=r.square().multiply(this.z),C=E.subtract(S.shiftLeft(1)).multiply(t.z).subtract(m).multiply(n).mod(this.curve.q),L=S.multiply(i).multiply(r).subtract(f.multiply(m)).subtract(E.multiply(r)).multiply(t.z).add(r.multiply(m)).mod(this.curve.q),K=m.multiply(this.z).multiply(t.z).mod(this.curve.q);return new yt(this.curve,this.curve.fromBigInteger(C),this.curve.fromBigInteger(L),K)},yt.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=new H("3"),r=this.x.toBigInteger(),n=this.y.toBigInteger(),i=n.multiply(this.z),s=i.multiply(n).mod(this.curve.q),f=this.curve.a.toBigInteger(),w=r.square().multiply(t);H.ZERO.equals(f)||(w=w.add(this.z.square().multiply(f)));var m=(w=w.mod(this.curve.q)).square().subtract(r.shiftLeft(3).multiply(s)).shiftLeft(1).multiply(i).mod(this.curve.q),S=w.multiply(t).multiply(r).subtract(s.shiftLeft(1)).shiftLeft(2).multiply(s).subtract(w.square().multiply(w)).mod(this.curve.q),E=i.square().multiply(i).shiftLeft(3).mod(this.curve.q);return new yt(this.curve,this.curve.fromBigInteger(m),this.curve.fromBigInteger(S),E)},yt.prototype.multiply=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var r,n=t,i=n.multiply(new H("3")),s=this.negate(),f=this,w=this.curve.q.subtract(t),m=w.multiply(new H("3")),S=new yt(this.curve,this.x,this.y),E=S.negate();for(r=i.bitLength()-2;r>0;--r){f=f.twice();var C=i.testBit(r);C!=n.testBit(r)&&(f=f.add(C?this:s))}for(r=m.bitLength()-2;r>0;--r){S=S.twice();var L=m.testBit(r);L!=w.testBit(r)&&(S=S.add(L?S:E))}return f},yt.prototype.multiplyTwo=function(t,r,n){var i;i=t.bitLength()>n.bitLength()?t.bitLength()-1:n.bitLength()-1;for(var s=this.curve.getInfinity(),f=this.add(r);i>=0;)s=s.twice(),t.testBit(i)?s=n.testBit(i)?s.add(f):s.add(this):n.testBit(i)&&(s=s.add(r)),--i;return s},pe.prototype.getQ=function(){return this.q},pe.prototype.getA=function(){return this.a},pe.prototype.getB=function(){return this.b},pe.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)},pe.prototype.getInfinity=function(){return this.infinity},pe.prototype.fromBigInteger=function(t){return new Ct(this.q,t)},pe.prototype.decodePointHex=function(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var r=(t.length-2)/2,n=t.substr(2,r),i=t.substr(r+2,r);return new yt(this,this.fromBigInteger(new H(n,16)),this.fromBigInteger(new H(i,16)));default:return null}},Ct.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},yt.prototype.getEncoded=function(e){var t=function(f,w){var m=f.toByteArrayUnsigned();if(w<m.length)m=m.slice(m.length-w);else for(;w>m.length;)m.unshift(0);return m},r=this.getX().toBigInteger(),n=this.getY().toBigInteger(),i=t(r,32);return e?n.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(t(n,32))),i},yt.decodeFrom=function(e,t){t[0];var r=t.length-1,n=t.slice(1,1+r/2),i=t.slice(1+r/2,1+r);n.unshift(0),i.unshift(0);var s=new H(n),f=new H(i);return new yt(e,e.fromBigInteger(s),e.fromBigInteger(f))},yt.decodeFromHex=function(e,t){t.substr(0,2);var r=t.length-2,n=t.substr(2,r/2),i=t.substr(2+r/2,r/2),s=new H(n,16),f=new H(i,16);return new yt(e,e.fromBigInteger(s),e.fromBigInteger(f))},yt.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),r=e.y.subtract(this.y).divide(t),n=r.square().subtract(this.x).subtract(e.x),i=r.multiply(this.x.subtract(n)).subtract(this.y);return new yt(this.curve,n,i)},yt.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var e=this.curve.fromBigInteger(H.valueOf(2)),t=this.curve.fromBigInteger(H.valueOf(3)),r=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),n=r.square().subtract(this.x.multiply(e)),i=r.multiply(this.x.subtract(n)).subtract(this.y);return new yt(this.curve,n,i)},yt.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(e.signum()==0)return this.curve.getInfinity();var t,r=e,n=r.multiply(new H("3")),i=this.negate(),s=this;for(t=n.bitLength()-2;t>0;--t){s=s.twice();var f=n.testBit(t);f!=r.testBit(t)&&(s=s.add2D(f?this:i))}return s},yt.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),r=this.curve.getA().toBigInteger(),n=this.curve.getB().toBigInteger(),i=this.curve.getQ(),s=t.multiply(t).mod(i),f=e.multiply(e).multiply(e).add(r.multiply(e)).add(n).mod(i);return s.equals(f)},yt.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},yt.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),r=this.getY().toBigInteger();if(t.compareTo(H.ONE)<0||t.compareTo(e.subtract(H.ONE))>0)throw new Error("x coordinate out of bounds");if(r.compareTo(H.ONE)<0||r.compareTo(e.subtract(H.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var Xe=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),r={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function n(f,w,m){return w?r[w]:String.fromCharCode(parseInt(m,16))}var i=new String(""),s=Object.hasOwnProperty;return function(f,w){var m,S,E=f.match(e),C=E[0],L=!1;C==="{"?m={}:C==="["?m=[]:(m=[],L=!0);for(var K=[m],z=1-L,G=E.length;z<G;++z){var X;switch((C=E[z]).charCodeAt(0)){default:(X=K[0])[S||X.length]=+C,S=void 0;break;case 34:if((C=C.substring(1,C.length-1)).indexOf("\\")!==-1&&(C=C.replace(t,n)),X=K[0],!S){if(!(X instanceof Array)){S=C||i;break}S=X.length}X[S]=C,S=void 0;break;case 91:X=K[0],K.unshift(X[S||X.length]=[]),S=void 0;break;case 93:K.shift();break;case 102:(X=K[0])[S||X.length]=!1,S=void 0;break;case 110:(X=K[0])[S||X.length]=null,S=void 0;break;case 116:(X=K[0])[S||X.length]=!0,S=void 0;break;case 123:X=K[0],K.unshift(X[S||X.length]={}),S=void 0;break;case 125:K.shift()}}if(L){if(K.length!==1)throw new Error;m=m[0]}else if(K.length)throw new Error;return w&&(m=function g(P,D){var N=P[D];if(N&&(N===void 0?"undefined":l(N))==="object"){var Y=null;for(var Q in N)if(s.call(N,Q)&&N!==P){var ct=g(N,Q);ct!==void 0?N[Q]=ct:(Y||(Y=[]),Y.push(Q))}if(Y)for(var rt=Y.length;--rt>=0;)delete N[Y[rt]]}return w.call(P,D,N)}({"":m},"")),m}}();y!==void 0&&y||(v.KJUR=y={}),y.asn1!==void 0&&y.asn1||(y.asn1={}),y.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if(t.substr(0,1)!="-")t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var r=t.substr(1).length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);for(var n="",i=0;i<r;i++)n+="f";t=new H(n,16).xor(e).add(H.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return Zt(e,t)},this.newObject=function(e){var t=y.asn1,r=t.ASN1Object,n=t.DERBoolean,i=t.DERInteger,s=t.DERBitString,f=t.DEROctetString,w=t.DERNull,m=t.DERObjectIdentifier,S=t.DEREnumerated,E=t.DERUTF8String,C=t.DERNumericString,L=t.DERPrintableString,K=t.DERTeletexString,z=t.DERIA5String,G=t.DERUTCTime,X=t.DERGeneralizedTime,g=t.DERVisibleString,P=t.DERBMPString,D=t.DERSequence,N=t.DERSet,Y=t.DERTaggedObject,Q=t.ASN1Util.newObject;if(e instanceof t.ASN1Object)return e;var ct=Object.keys(e);if(ct.length!=1)throw new Error("key of param shall be only one.");var rt=ct[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+rt+":")==-1)throw new Error("undefined key: "+rt);if(rt=="bool")return new n(e[rt]);if(rt=="int")return new i(e[rt]);if(rt=="bitstr")return new s(e[rt]);if(rt=="octstr")return new f(e[rt]);if(rt=="null")return new w(e[rt]);if(rt=="oid")return new m(e[rt]);if(rt=="enum")return new S(e[rt]);if(rt=="utf8str")return new E(e[rt]);if(rt=="numstr")return new C(e[rt]);if(rt=="prnstr")return new L(e[rt]);if(rt=="telstr")return new K(e[rt]);if(rt=="ia5str")return new z(e[rt]);if(rt=="utctime")return new G(e[rt]);if(rt=="gentime")return new X(e[rt]);if(rt=="visstr")return new g(e[rt]);if(rt=="bmpstr")return new P(e[rt]);if(rt=="asn1")return new r(e[rt]);if(rt=="seq"){for(var gt=e[rt],ot=[],ht=0;ht<gt.length;ht++){var wt=Q(gt[ht]);ot.push(wt)}return new D({array:ot})}if(rt=="set"){for(gt=e[rt],ot=[],ht=0;ht<gt.length;ht++)wt=Q(gt[ht]),ot.push(wt);return new N({array:ot})}if(rt=="tag"){var xt=e[rt];if(Object.prototype.toString.call(xt)==="[object Array]"&&xt.length==3){var Et=Q(xt[2]);return new Y({tag:xt[0],explicit:xt[1],obj:Et})}return new Y(xt)}},this.jsonToASN1HEX=function(e){return this.newObject(e).getEncodedHex()}},y.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",r=parseInt(e.substr(0,2),16),n=(t=Math.floor(r/40)+"."+r%40,""),i=2;i<e.length;i+=2){var s=("00000000"+parseInt(e.substr(i,2),16).toString(2)).slice(-8);n+=s.substr(1,7),s.substr(0,1)=="0"&&(t=t+"."+new H(n,2).toString(10),n="")}return t},y.asn1.ASN1Util.oidIntToHex=function(e){var t=function(m){var S=m.toString(16);return S.length==1&&(S="0"+S),S},r=function(m){var S="",E=new H(m,10).toString(2),C=7-E.length%7;C==7&&(C=0);for(var L="",K=0;K<C;K++)L+="0";for(E=L+E,K=0;K<E.length-1;K+=7){var z=E.substr(K,7);K!=E.length-7&&(z="1"+z),S+=t(parseInt(z,2))}return S};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var n="",i=e.split("."),s=40*parseInt(i[0])+parseInt(i[1]);n+=t(s),i.splice(0,2);for(var f=0;f<i.length;f++)n+=r(i[f]);return n},y.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+0+",v="+this.hV);var t=this.hV.length/2,r=t.toString(16);if(r.length%2==1&&(r="0"+r),t<128)return r;var n=r.length/2;if(n>15)throw"ASN.1 length too long to represent by 8x: n = "+t.toString(16);return(128+n).toString(16)+r},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(t){this.params=t},e!=null&&e.tlv!=null&&(this.hTLV=e.tlv,this.isModified=!1)},y.asn1.DERAbstractString=function(e){y.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=Be(this.s).toLowerCase()},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(typeof e=="string"?this.setString(e):e.str!==void 0?this.setString(e.str):e.hex!==void 0&&this.setStringHex(e.hex))},a.lang.extend(y.asn1.DERAbstractString,y.asn1.ASN1Object),y.asn1.DERAbstractTime=function(e){y.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(t){var r=t.getTime()+6e4*t.getTimezoneOffset();return new Date(r)},this.formatDate=function(t,r,n){var i=this.zeroPadding,s=this.localDateToUTC(t),f=String(s.getFullYear());r=="utc"&&(f=f.substr(2,2));var w=f+i(String(s.getMonth()+1),2)+i(String(s.getDate()),2)+i(String(s.getHours()),2)+i(String(s.getMinutes()),2)+i(String(s.getSeconds()),2);if(n===!0){var m=s.getMilliseconds();if(m!=0){var S=i(String(m),3);w=w+"."+(S=S.replace(/[0]+$/,""))}}return w+"Z"},this.zeroPadding=function(t,r){return t.length>=r?t:new Array(r-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=fe(t)},this.setByDateValue=function(t,r,n,i,s,f){var w=new Date(Date.UTC(t,r-1,n,i,s,f,0));this.setByDate(w)},this.getFreshValueHex=function(){return this.hV}},a.lang.extend(y.asn1.DERAbstractTime,y.asn1.ASN1Object),y.asn1.DERAbstractStructured=function(e){y.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,e!==void 0&&e.array!==void 0&&(this.asn1Array=e.array)},a.lang.extend(y.asn1.DERAbstractStructured,y.asn1.ASN1Object),y.asn1.DERBoolean=function(e){y.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=e==0?"010100":"0101ff"},a.lang.extend(y.asn1.DERBoolean,y.asn1.ASN1Object),y.asn1.DERInteger=function(e){y.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=y.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var r=new H(String(t),10);this.setByBigInteger(r)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(e.bigint!==void 0?this.setByBigInteger(e.bigint):e.int!==void 0?this.setByInteger(e.int):typeof e=="number"?this.setByInteger(e):e.hex!==void 0&&this.setValueHex(e.hex))},a.lang.extend(y.asn1.DERInteger,y.asn1.ASN1Object),y.asn1.DERBitString=function(e){if(e!==void 0&&e.obj!==void 0){var t=y.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.getEncodedHex()}y.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(r){this.hTLV=null,this.isModified=!0,this.hV=r},this.setUnusedBitsAndHexValue=function(r,n){if(r<0||7<r)throw"unused bits shall be from 0 to 7: u = "+r;var i="0"+r;this.hTLV=null,this.isModified=!0,this.hV=i+n},this.setByBinaryString=function(r){var n=8-(r=r.replace(/0+$/,"")).length%8;n==8&&(n=0);for(var i=0;i<=n;i++)r+="0";var s="";for(i=0;i<r.length-1;i+=8){var f=r.substr(i,8),w=parseInt(f,2).toString(16);w.length==1&&(w="0"+w),s+=w}this.hTLV=null,this.isModified=!0,this.hV="0"+n+s},this.setByBooleanArray=function(r){for(var n="",i=0;i<r.length;i++)r[i]==1?n+="1":n+="0";this.setByBinaryString(n)},this.newFalseArray=function(r){for(var n=new Array(r),i=0;i<r;i++)n[i]=!1;return n},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(typeof e=="string"&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):e.hex!==void 0?this.setHexValueIncludingUnusedBits(e.hex):e.bin!==void 0?this.setByBinaryString(e.bin):e.array!==void 0&&this.setByBooleanArray(e.array))},a.lang.extend(y.asn1.DERBitString,y.asn1.ASN1Object),y.asn1.DEROctetString=function(e){if(e!==void 0&&e.obj!==void 0){var t=y.asn1.ASN1Util.newObject(e.obj);e.hex=t.getEncodedHex()}y.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},a.lang.extend(y.asn1.DEROctetString,y.asn1.DERAbstractString),y.asn1.DERNull=function(){y.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},a.lang.extend(y.asn1.DERNull,y.asn1.ASN1Object),y.asn1.DERObjectIdentifier=function(e){y.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){var r=function(i){var s=function(L){var K=L.toString(16);return K.length==1&&(K="0"+K),K},f=function(L){var K="",z=parseInt(L,10).toString(2),G=7-z.length%7;G==7&&(G=0);for(var X="",g=0;g<G;g++)X+="0";for(z=X+z,g=0;g<z.length-1;g+=7){var P=z.substr(g,7);g!=z.length-7&&(P="1"+P),K+=s(parseInt(P,2))}return K};try{if(!i.match(/^[0-9.]+$/))return null;var w="",m=i.split("."),S=40*parseInt(m[0],10)+parseInt(m[1],10);w+=s(S),m.splice(0,2);for(var E=0;E<m.length;E++)w+=f(m[E]);return w}catch{return null}}(t);if(r==null)throw new Error("malformed oid string: "+t);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(t){var r=y.asn1.x509.OID.name2oid(t);if(r==="")throw new Error("DERObjectIdentifier oidName undefined: "+t);this.setValueOidString(r)},this.setValueNameOrOid=function(t){t.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(t):this.setValueName(t)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(t){typeof t=="string"?this.setValueNameOrOid(t):t.oid!==void 0?this.setValueNameOrOid(t.oid):t.name!==void 0?this.setValueNameOrOid(t.name):t.hex!==void 0&&this.setValueHex(t.hex)},e!==void 0&&this.setByParam(e)},a.lang.extend(y.asn1.DERObjectIdentifier,y.asn1.ASN1Object),y.asn1.DEREnumerated=function(e){y.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=y.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var r=new H(String(t),10);this.setByBigInteger(r)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(e.int!==void 0?this.setByInteger(e.int):typeof e=="number"?this.setByInteger(e):e.hex!==void 0&&this.setValueHex(e.hex))},a.lang.extend(y.asn1.DEREnumerated,y.asn1.ASN1Object),y.asn1.DERUTF8String=function(e){y.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},a.lang.extend(y.asn1.DERUTF8String,y.asn1.DERAbstractString),y.asn1.DERNumericString=function(e){y.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},a.lang.extend(y.asn1.DERNumericString,y.asn1.DERAbstractString),y.asn1.DERPrintableString=function(e){y.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},a.lang.extend(y.asn1.DERPrintableString,y.asn1.DERAbstractString),y.asn1.DERTeletexString=function(e){y.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},a.lang.extend(y.asn1.DERTeletexString,y.asn1.DERAbstractString),y.asn1.DERIA5String=function(e){y.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},a.lang.extend(y.asn1.DERIA5String,y.asn1.DERAbstractString),y.asn1.DERVisibleString=function(e){y.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},a.lang.extend(y.asn1.DERVisibleString,y.asn1.DERAbstractString),y.asn1.DERBMPString=function(e){y.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},a.lang.extend(y.asn1.DERBMPString,y.asn1.DERAbstractString),y.asn1.DERUTCTime=function(e){y.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=fe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=fe(this.s)),this.hV},e!==void 0&&(e.str!==void 0?this.setString(e.str):typeof e=="string"&&e.match(/^[0-9]{12}Z$/)?this.setString(e):e.hex!==void 0?this.setStringHex(e.hex):e.date!==void 0&&this.setByDate(e.date))},a.lang.extend(y.asn1.DERUTCTime,y.asn1.DERAbstractTime),y.asn1.DERGeneralizedTime=function(e){y.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.withMillis=!1,this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=fe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=fe(this.s)),this.hV},e!==void 0&&(e.str!==void 0?this.setString(e.str):typeof e=="string"&&e.match(/^[0-9]{14}Z$/)?this.setString(e):e.hex!==void 0?this.setStringHex(e.hex):e.date!==void 0&&this.setByDate(e.date),e.millis===!0&&(this.withMillis=!0))},a.lang.extend(y.asn1.DERGeneralizedTime,y.asn1.DERAbstractTime),y.asn1.DERSequence=function(e){y.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var t="",r=0;r<this.asn1Array.length;r++)t+=this.asn1Array[r].getEncodedHex();return this.hV=t,this.hV}},a.lang.extend(y.asn1.DERSequence,y.asn1.DERAbstractStructured),y.asn1.DERSet=function(e){y.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var t=new Array,r=0;r<this.asn1Array.length;r++){var n=this.asn1Array[r];t.push(n.getEncodedHex())}return this.sortFlag==1&&t.sort(),this.hV=t.join(""),this.hV},e!==void 0&&e.sortflag!==void 0&&e.sortflag==0&&(this.sortFlag=!1)},a.lang.extend(y.asn1.DERSet,y.asn1.DERAbstractStructured),y.asn1.DERTaggedObject=function(e){y.asn1.DERTaggedObject.superclass.constructor.call(this);var t=y.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(r,n,i){this.hT=n,this.isExplicit=r,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,n),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(r){r.tag!=null&&(this.hT=r.tag),r.explicit!=null&&(this.isExplicit=r.explicit),r.tage!=null&&(this.hT=r.tage,this.isExplicit=!0),r.tagi!=null&&(this.hT=r.tagi,this.isExplicit=!1),r.obj!=null&&(r.obj instanceof t.ASN1Object?(this.asn1Object=r.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):l(r.obj)=="object"&&(this.asn1Object=t.ASN1Util.newObject(r.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},e!=null&&this.setByParam(e)},a.lang.extend(y.asn1.DERTaggedObject,y.asn1.ASN1Object);var y,Fe,se,it=new function(){};function Qe(e){for(var t=new Array,r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function Ze(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function Re(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);n.length==1&&(n="0"+n),t+=n}return t}function fe(e){return Re(Qe(e))}function Ie(e){return e=(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function Ee(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),e=(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function Ut(e){return e.length%2==1&&(e="0"+e),Ie(Z(e))}function Ft(e){return tt(Ee(e))}function Be(e){return Oe(Ue(e))}function jt(e){return decodeURIComponent(De(e))}function re(e){for(var t="",r=0;r<e.length-1;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t}function ce(e){for(var t="",r=0;r<e.length;r++)t+=("0"+e.charCodeAt(r).toString(16)).slice(-2);return t}function $e(e){return Z(e)}function tr(e){var t=$e(e).replace(/(.{64})/g,`$1\r
`);return t=t.replace(/\r\n$/,"")}function er(e){return tt(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Zt(e,t){return"-----BEGIN "+t+`-----\r
`+tr(e)+`\r
-----END `+t+`-----\r
`}function he(e,t){if(e.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+t;return er(e=t!==void 0?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function je(e){var t,r,n,i,s,f,w,m,S,E,C;if(C=e.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return m=C[1],t=parseInt(m),m.length===2&&(50<=t&&t<100?t=1900+t:0<=t&&t<50&&(t=2e3+t)),r=parseInt(C[2])-1,n=parseInt(C[3]),i=parseInt(C[4]),s=parseInt(C[5]),f=parseInt(C[6]),w=0,(S=C[7])!==""&&(E=(S.substr(1)+"00").substr(0,3),w=parseInt(E)),Date.UTC(t,r,n,i,s,f,w);throw"unsupported zulu format: "+e}function rr(e){return~~(je(e)/1e3)}function Oe(e){return e.replace(/%/g,"")}function De(e){return e.replace(/(..)/g,"%$1")}function nr(e){var t="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw t;var r=(e=e.toLowerCase()).split(":").length-1;if(r<2)throw t;var n=":".repeat(7-r+2),i=(e=e.replace("::",n)).split(":");if(i.length!=8)throw t;for(var s=0;s<8;s++)i[s]=("0000"+i[s]).slice(-4);return i.join("")}function ir(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var t=(e=e.toLowerCase()).match(/.{1,4}/g),r=0;r<8;r++)t[r]=t[r].replace(/^0+/,""),t[r]==""&&(t[r]="0");var n=(e=":"+t.join(":")+":").match(/:(0:){2,}/g);if(n===null)return e.slice(1,-1);var i="";for(r=0;r<n.length;r++)n[r].length>i.length&&(i=n[r]);return(e=e.replace(i,"::")).slice(1,-1)}function Me(e){var t="malformed hex value";if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(e.length!=8)return e.length==32?ir(e):e;try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch{throw t}}function Ue(e){for(var t=encodeURIComponent(e),r="",n=0;n<t.length;n++)t[n]=="%"?(r+=t.substr(n,3),n+=2):r=r+"%"+fe(t[n]);return r}function or(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function He(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}it.getLblen=function(e,t){if(e.substr(t+2,1)!="8")return 1;var r=parseInt(e.substr(t+3,1));return r==0?-1:0<r&&r<10?r+1:-2},it.getL=function(e,t){var r=it.getLblen(e,t);return r<1?"":e.substr(t+2,2*r)},it.getVblen=function(e,t){var r;return(r=it.getL(e,t))==""?-1:(r.substr(0,1)==="8"?new H(r.substr(2),16):new H(r,16)).intValue()},it.getVidx=function(e,t){var r=it.getLblen(e,t);return r<0?r:t+2*(r+1)},it.getV=function(e,t){var r=it.getVidx(e,t),n=it.getVblen(e,t);return e.substr(r,2*n)},it.getTLV=function(e,t){return e.substr(t,2)+it.getL(e,t)+it.getV(e,t)},it.getTLVblen=function(e,t){return 2+2*it.getLblen(e,t)+2*it.getVblen(e,t)},it.getNextSiblingIdx=function(e,t){return it.getVidx(e,t)+2*it.getVblen(e,t)},it.getChildIdx=function(e,t){var r,n,i,s=it,f=[];r=s.getVidx(e,t),n=2*s.getVblen(e,t),e.substr(t,2)=="03"&&(r+=2,n-=2),i=0;for(var w=r;i<=n;){var m=s.getTLVblen(e,w);if((i+=m)<=n&&f.push(w),w+=m,i>=n)break}return f},it.getNthChildIdx=function(e,t,r){return it.getChildIdx(e,t)[r]},it.getIdxbyList=function(e,t,r,n){var i,s,f=it;return r.length==0?n!==void 0&&e.substr(t,2)!==n?-1:t:(i=r.shift())>=(s=f.getChildIdx(e,t)).length?-1:f.getIdxbyList(e,s[i],r,n)},it.getIdxbyListEx=function(e,t,r,n){var i,s,f=it;if(r.length==0)return n!==void 0&&e.substr(t,2)!==n?-1:t;i=r.shift(),s=f.getChildIdx(e,t);for(var w=0,m=0;m<s.length;m++){var S=e.substr(s[m],2);if(typeof i=="number"&&!f.isContextTag(S)&&w==i||typeof i=="string"&&f.isContextTag(S,i))return f.getIdxbyListEx(e,s[m],r,n);f.isContextTag(S)||w++}return-1},it.getTLVbyList=function(e,t,r,n){var i=it,s=i.getIdxbyList(e,t,r,n);return s==-1||s>=e.length?null:i.getTLV(e,s)},it.getTLVbyListEx=function(e,t,r,n){var i=it,s=i.getIdxbyListEx(e,t,r,n);return s==-1?null:i.getTLV(e,s)},it.getVbyList=function(e,t,r,n,i){var s,f,w=it;return(s=w.getIdxbyList(e,t,r,n))==-1||s>=e.length?null:(f=w.getV(e,s),i===!0&&(f=f.substr(2)),f)},it.getVbyListEx=function(e,t,r,n,i){var s,f,w=it;return(s=w.getIdxbyListEx(e,t,r,n))==-1?null:(f=w.getV(e,s),e.substr(s,2)=="03"&&i!==!1&&(f=f.substr(2)),f)},it.getInt=function(e,t,r){r==null&&(r=-1);try{var n=e.substr(t,2);if(n!="02"&&n!="03")return r;var i=it.getV(e,t);return n=="02"?parseInt(i,16):function(f){try{var w=f.substr(0,2);if(w=="00")return parseInt(f.substr(2),16);var m=parseInt(w,16),S=f.substr(2),E=parseInt(S,16).toString(2);return E=="0"&&(E="00000000"),E=E.slice(0,0-m),parseInt(E,2)}catch{return-1}}(i)}catch{return r}},it.getOID=function(e,t,r){r==null&&(r=null);try{return e.substr(t,2)!="06"?r:function(i){if(!or(i))return null;try{var s=[],f=i.substr(0,2),w=parseInt(f,16);s[0]=new String(Math.floor(w/40)),s[1]=new String(w%40);for(var m=i.substr(2),S=[],E=0;E<m.length/2;E++)S.push(parseInt(m.substr(2*E,2),16));var C=[],L="";for(E=0;E<S.length;E++)128&S[E]?L+=sr((127&S[E]).toString(2),7):(L+=sr((127&S[E]).toString(2),7),C.push(new String(parseInt(L,2))),L="");var K=s.join(".");return C.length>0&&(K=K+"."+C.join(".")),K}catch{return null}}(it.getV(e,t))}catch{return r}},it.getOIDName=function(e,t,r){r==null&&(r=null);try{var n=it.getOID(e,t,r);if(n==r)return r;var i=y.asn1.x509.OID.oid2name(n);return i==""?n:i}catch{return r}},it.getString=function(e,t,r){r==null&&(r=null);try{return re(it.getV(e,t))}catch{return r}},it.hextooidstr=function(e){var t=function(L,K){return L.length>=K?L:new Array(K-L.length+1).join("0")+L},r=[],n=e.substr(0,2),i=parseInt(n,16);r[0]=new String(Math.floor(i/40)),r[1]=new String(i%40);for(var s=e.substr(2),f=[],w=0;w<s.length/2;w++)f.push(parseInt(s.substr(2*w,2),16));var m=[],S="";for(w=0;w<f.length;w++)128&f[w]?S+=t((127&f[w]).toString(2),7):(S+=t((127&f[w]).toString(2),7),m.push(new String(parseInt(S,2))),S="");var E=r.join(".");return m.length>0&&(E=E+"."+m.join(".")),E},it.dump=function(e,t,r,n){var i=it,s=i.getV,f=i.dump,w=i.getChildIdx,m=e;e instanceof y.asn1.ASN1Object&&(m=e.getEncodedHex());var S=function(rt,gt){return rt.length<=2*gt?rt:rt.substr(0,gt)+"..(total "+rt.length/2+"bytes).."+rt.substr(rt.length-gt,gt)};t===void 0&&(t={ommit_long_octet:32}),r===void 0&&(r=0),n===void 0&&(n="");var E,C=t.ommit_long_octet;if((E=m.substr(r,2))=="01")return(L=s(m,r))=="00"?n+`BOOLEAN FALSE
`:n+`BOOLEAN TRUE
`;if(E=="02")return n+"INTEGER "+S(L=s(m,r),C)+`
`;if(E=="03"){var L=s(m,r);if(i.isASN1HEX(L.substr(2))){var K=n+`BITSTRING, encapsulates
`;return K+=f(L.substr(2),t,0,n+"  ")}return n+"BITSTRING "+S(L,C)+`
`}if(E=="04")return L=s(m,r),i.isASN1HEX(L)?(K=n+`OCTETSTRING, encapsulates
`,K+=f(L,t,0,n+"  ")):n+"OCTETSTRING "+S(L,C)+`
`;if(E=="05")return n+`NULL
`;if(E=="06"){var z=s(m,r),G=y.asn1.ASN1Util.oidHexToInt(z),X=y.asn1.x509.OID.oid2name(G),g=G.replace(/\./g," ");return X!=""?n+"ObjectIdentifier "+X+" ("+g+`)
`:n+"ObjectIdentifier ("+g+`)
`}if(E=="0a")return n+"ENUMERATED "+parseInt(s(m,r))+`
`;if(E=="0c")return n+"UTF8String '"+jt(s(m,r))+`'
`;if(E=="13")return n+"PrintableString '"+jt(s(m,r))+`'
`;if(E=="14")return n+"TeletexString '"+jt(s(m,r))+`'
`;if(E=="16")return n+"IA5String '"+jt(s(m,r))+`'
`;if(E=="17")return n+"UTCTime "+jt(s(m,r))+`
`;if(E=="18")return n+"GeneralizedTime "+jt(s(m,r))+`
`;if(E=="1a")return n+"VisualString '"+jt(s(m,r))+`'
`;if(E=="1e")return n+"BMPString '"+jt(s(m,r))+`'
`;if(E=="30"){if(m.substr(r,4)=="3000")return n+`SEQUENCE {}
`;K=n+`SEQUENCE
`;var P=t;if(((Y=w(m,r)).length==2||Y.length==3)&&m.substr(Y[0],2)=="06"&&m.substr(Y[Y.length-1],2)=="04"){X=i.oidname(s(m,Y[0]));var D=JSON.parse(JSON.stringify(t));D.x509ExtName=X,P=D}for(var N=0;N<Y.length;N++)K+=f(m,P,Y[N],n+"  ");return K}if(E=="31"){K=n+`SET
`;var Y=w(m,r);for(N=0;N<Y.length;N++)K+=f(m,t,Y[N],n+"  ");return K}if((128&(E=parseInt(E,16)))!=0){var Q=31&E;if((32&E)!=0){for(K=n+"["+Q+`]
`,Y=w(m,r),N=0;N<Y.length;N++)K+=f(m,t,Y[N],n+"  ");return K}if(L=s(m,r),it.isASN1HEX(L)){var K=n+"["+Q+`]
`;return K+=f(L,t,0,n+"  ")}return(L.substr(0,8)=="68747470"||t.x509ExtName==="subjectAltName"&&Q==2)&&(L=jt(L)),K=n+"["+Q+"] "+L+`
`}return n+"UNKNOWN("+E+") "+s(m,r)+`
`},it.isContextTag=function(e,t){var r,n;e=e.toLowerCase();try{r=parseInt(e,16)}catch{return-1}if(t===void 0)return(192&r)==128;try{return t.match(/^\[[0-9]+\]$/)!=null&&!((n=parseInt(t.substr(1,t.length-1),10))>31)&&(192&r)==128&&(31&r)==n}catch{return!1}},it.isASN1HEX=function(e){var t=it;if(e.length%2==1)return!1;var r=t.getVblen(e,0),n=e.substr(0,2),i=t.getL(e,0);return e.length-n.length-i.length==2*r},it.checkStrictDER=function(e,t,r,n,i){var s=it;if(r===void 0){if(typeof e!="string")throw new Error("not hex string");if(e=e.toLowerCase(),!y.lang.String.isHex(e))throw new Error("not hex string");r=e.length,i=(n=e.length/2)<128?1:Math.ceil(n.toString(16))+1}if(s.getL(e,t).length>2*i)throw new Error("L of TLV too long: idx="+t);var f=s.getVblen(e,t);if(f>n)throw new Error("value of L too long than hex: idx="+t);var w=s.getTLV(e,t),m=w.length-2-s.getL(e,t).length;if(m!==2*f)throw new Error("V string length and L's value not the same:"+m+"/"+2*f);if(t===0&&e.length!=w.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+w.length);var S=e.substr(t,2);if(S==="02"){var E=s.getVidx(e,t);if(e.substr(E,2)=="00"&&e.charCodeAt(E+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(S,16)){for(var C=s.getVblen(e,t),L=0,K=s.getChildIdx(e,t),z=0;z<K.length;z++)L+=s.getTLV(e,K[z]).length,s.checkStrictDER(e,K[z],r,n,i);if(2*C!=L)throw new Error("sum of children's TLV length and L unmatch: "+2*C+"!="+L)}},it.oidname=function(e){var t=y.asn1;y.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var r=t.x509.OID.oid2name(e);return r===""&&(r=e),r},y!==void 0&&y||(v.KJUR=y={}),y.lang!==void 0&&y.lang||(y.lang={}),y.lang.String=function(){},typeof T=="function"?(v.utf8tob64u=Fe=function(t){return Ie(T.from(t,"utf8").toString("base64"))},v.b64utoutf8=se=function(t){return T.from(Ee(t),"base64").toString("utf8")}):(v.utf8tob64u=Fe=function(t){return Ut(Oe(Ue(t)))},v.b64utoutf8=se=function(t){return decodeURIComponent(De(Ft(t)))}),y.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},y.lang.String.isHex=function(e){return or(e)},y.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},y.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=Ee(e),y.lang.String.isBase64(e))},y.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},y.lang.String.isPrintable=function(e){return e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},y.lang.String.isIA5=function(e){return e.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},y.lang.String.isMail=function(e){return e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var sr=function(t,r,n){return n==null&&(n="0"),t.length>=r?t:new Array(r-t.length+1).join(n)+t};y!==void 0&&y||(v.KJUR=y={}),y.crypto!==void 0&&y.crypto||(y.crypto={}),y.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:d.algo.MD5,sha1:d.algo.SHA1,sha224:d.algo.SHA224,sha256:d.algo.SHA256,sha384:d.algo.SHA384,sha512:d.algo.SHA512,ripemd160:d.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if(this.DIGESTINFOHEAD[t]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,r){var n=this.getDigestInfoHex(e,t),i=r/4;if(n.length+22>i)throw"key is too short for SigAlg: keylen="+r+","+t;for(var s="0001",f="00"+n,w="",m=i-s.length-f.length,S=0;S<m;S+=2)w+="ff";return s+w+f},this.hashString=function(e,t){return new y.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new y.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof lt||e instanceof y.crypto.DSA||e instanceof y.crypto.ECDSA}},y.crypto.Util.md5=function(e){return new y.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},y.crypto.Util.ripemd160=function(e){return new y.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},y.crypto.Util.SECURERANDOMGEN=new Vt,y.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return y.crypto.Util.SECURERANDOMGEN.nextBytes(t),Re(t)},y.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new H(y.crypto.Util.getRandomHexOfNbytes(e),16)},y.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,r=new Array((e-t)/8+1);return y.crypto.Util.SECURERANDOMGEN.nextBytes(r),r[0]=(255<<t&255^255)&r[0],Re(r)},y.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new H(y.crypto.Util.getRandomHexOfNbits(e),16)},y.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var r=y.crypto.Util.getRandomBigIntegerOfNbits(t);if(e.compareTo(r)!=-1)return r}},y.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var r=e.compareTo(t);if(r==1)throw"biMin is greater than biMax";if(r==0)return e;var n=t.subtract(e);return y.crypto.Util.getRandomBigIntegerZeroToMax(n).add(e)},y.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(t,r){if((t=y.crypto.MessageDigest.getCanonicalAlgName(t))!==null&&r===void 0&&(r=y.crypto.Util.DEFAULTPROVIDER[t]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(t)!=-1&&r=="cryptojs"){try{this.md=y.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[t].create()}catch(n){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var i=d.enc.Hex.parse(n);this.md.update(i)},this.digest=function(){return this.md.finalize().toString(d.enc.Hex)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}if(":sha256:".indexOf(t)!=-1&&r=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(n){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var i=sjcl.codec.hex.toBits(n);this.md.update(i)},this.digest=function(){var n=this.md.finalize();return sjcl.codec.hex.fromBits(n)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},e!==void 0&&e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0&&(this.provName=y.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},y.crypto.MessageDigest.getCanonicalAlgName=function(e){return typeof e=="string"&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},y.crypto.MessageDigest.getHashLength=function(e){var t=y.crypto.MessageDigest,r=t.getCanonicalAlgName(e);if(t.HASHLENGTH[r]===void 0)throw"not supported algorithm: "+e;return t.HASHLENGTH[r]},y.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},y.crypto.Mac=function(e){this.setAlgAndProvider=function(t,r){if((t=t.toLowerCase())==null&&(t="hmacsha1"),(t=t.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+t;r===void 0&&(r=y.crypto.Util.DEFAULTPROVIDER[t]),this.algProv=t+"/"+r;var n=t.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)!=-1&&r=="cryptojs"){try{var i=y.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=d.algo.HMAC.create(i,this.pass)}catch(s){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+s}this.updateString=function(s){this.mac.update(s)},this.updateHex=function(s){var f=d.enc.Hex.parse(s);this.mac.update(f)},this.doFinal=function(){return this.mac.finalize().toString(d.enc.Hex)},this.doFinalString=function(s){return this.updateString(s),this.doFinal()},this.doFinalHex=function(s){return this.updateHex(s),this.doFinal()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(t){if(typeof t=="string"){var r=t;return t.length%2!=1&&t.match(/^[0-9A-Fa-f]+$/)||(r=ce(t)),void(this.pass=d.enc.Hex.parse(r))}if((t===void 0?"undefined":l(t))!="object")throw"KJUR.crypto.Mac unsupported password type: "+t;if(r=null,t.hex!==void 0){if(t.hex.length%2!=0||!t.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+t.hex;r=t.hex}if(t.utf8!==void 0&&(r=Be(t.utf8)),t.rstr!==void 0&&(r=ce(t.rstr)),t.b64!==void 0&&(r=tt(t.b64)),t.b64u!==void 0&&(r=Ft(t.b64u)),r==null)throw"KJUR.crypto.Mac unsupported password type: "+t;this.pass=d.enc.Hex.parse(r)},e!==void 0&&(e.pass!==void 0&&this.setPassword(e.pass),e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0&&(this.provName=y.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},y.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var r=this.algName.match(/^(.+)with(.+)$/);r&&(this.mdAlgName=r[1].toLowerCase(),this.pubkeyAlgName=r[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(r,n){for(var i="",s=n/4-r.length,f=0;f<s;f++)i+="0";return i+r},this.setAlgAndProvider=function(r,n){if(this._setAlgNames(),n!="cryptojs/jsrsa")throw new Error("provider not supported: "+n);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new y.crypto.MessageDigest({alg:this.mdAlgName})}catch(i){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+i)}this.init=function(i,s){var f=null;try{f=s===void 0?Ot.getKey(i):Ot.getKey(i,s)}catch(w){throw"init failed:"+w}if(f.isPrivate===!0)this.prvKey=f,this.state="SIGN";else{if(f.isPublic!==!0)throw"init failed.:"+f;this.pubKey=f,this.state="VERIFY"}},this.updateString=function(i){this.md.updateString(i)},this.updateHex=function(i){this.md.updateHex(i)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&y.crypto.ECDSA!==void 0&&(this.prvKey=new y.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof lt&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof lt&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof y.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof y.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(i){return this.updateString(i),this.sign()},this.signHex=function(i){return this.updateHex(i),this.sign()},this.verify=function(i){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&y.crypto.ECDSA!==void 0&&(this.pubKey=new y.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof lt&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,i,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof lt&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,i);if(y.crypto.ECDSA!==void 0&&this.pubKey instanceof y.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,i);if(y.crypto.DSA!==void 0&&this.pubKey instanceof y.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,i);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(r,n){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(r){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(r){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(r){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(r){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(r){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,e!==void 0&&(e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0?this.provName=y.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),e.psssaltlen!==void 0&&(this.pssSaltLen=e.psssaltlen),e.prvkeypem!==void 0)){if(e.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{t=Ot.getKey(e.prvkeypem),this.init(t)}catch(r){throw"fatal error to load pem private key: "+r}}},y.crypto.Cipher=function(e){},y.crypto.Cipher.encrypt=function(e,t,r){if(t instanceof lt&&t.isPublic){var n=y.crypto.Cipher.getAlgByKeyAndName(t,r);if(n==="RSA")return t.encrypt(e);if(n==="RSAOAEP")return t.encryptOAEP(e,"sha1");var i=n.match(/^RSAOAEP(\d+)$/);if(i!==null)return t.encryptOAEP(e,"sha"+i[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.encrypt: unsupported key or algorithm"},y.crypto.Cipher.decrypt=function(e,t,r){if(t instanceof lt&&t.isPrivate){var n=y.crypto.Cipher.getAlgByKeyAndName(t,r);if(n==="RSA")return t.decrypt(e);if(n==="RSAOAEP")return t.decryptOAEP(e,"sha1");var i=n.match(/^RSAOAEP(\d+)$/);if(i!==null)return t.decryptOAEP(e,"sha"+i[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.decrypt: unsupported key or algorithm"},y.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof lt){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t)!=-1)return t;if(t==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},y.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},y!==void 0&&y||(v.KJUR=y={}),y.crypto!==void 0&&y.crypto||(y.crypto={}),y.crypto.ECDSA=function(e){var t=Error,r=H,n=yt,i=y.crypto.ECDSA,s=y.crypto.ECParameterDB,f=i.getName,w=it,m=w.getVbyListEx,S=w.isASN1HEX,E=new Vt;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(C){return new r(C.bitLength(),E).mod(C.subtract(r.ONE)).add(r.ONE)},this.setNamedCurve=function(C){this.ecparams=s.getByName(C),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=C},this.setPrivateKeyHex=function(C){this.isPrivate=!0,this.prvKeyHex=C},this.setPublicKeyHex=function(C){this.isPublic=!0,this.pubKeyHex=C},this.getPublicKeyXYHex=function(){var C=this.pubKeyHex;if(C.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var L=this.ecparams.keylen/4;if(C.length!==2+2*L)throw"malformed public key hex length";var K={};return K.x=C.substr(2,L),K.y=C.substr(2+L),K},this.getShortNISTPCurveName=function(){var C=this.curveName;return C==="secp256r1"||C==="NIST P-256"||C==="P-256"||C==="prime256v1"?"P-256":C==="secp384r1"||C==="NIST P-384"||C==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var C=this.ecparams.n,L=this.getBigRandom(C),K=this.ecparams.G.multiply(L),z=K.getX().toBigInteger(),G=K.getY().toBigInteger(),X=this.ecparams.keylen/4,g=("0000000000"+L.toString(16)).slice(-X),P="04"+("0000000000"+z.toString(16)).slice(-X)+("0000000000"+G.toString(16)).slice(-X);return this.setPrivateKeyHex(g),this.setPublicKeyHex(P),{ecprvhex:g,ecpubhex:P}},this.signWithMessageHash=function(C){return this.signHex(C,this.prvKeyHex)},this.signHex=function(C,L){var K=new r(L,16),z=this.ecparams.n,G=new r(C.substring(0,this.ecparams.keylen/4),16);do var X=this.getBigRandom(z),g=this.ecparams.G.multiply(X).getX().toBigInteger().mod(z);while(g.compareTo(r.ZERO)<=0);var P=X.modInverse(z).multiply(G.add(K.multiply(g))).mod(z);return i.biRSSigToASN1Sig(g,P)},this.sign=function(C,L){var K=L,z=this.ecparams.n,G=r.fromByteArrayUnsigned(C);do var X=this.getBigRandom(z),g=this.ecparams.G.multiply(X).getX().toBigInteger().mod(z);while(g.compareTo(H.ZERO)<=0);var P=X.modInverse(z).multiply(G.add(K.multiply(g))).mod(z);return this.serializeSig(g,P)},this.verifyWithMessageHash=function(C,L){return this.verifyHex(C,L,this.pubKeyHex)},this.verifyHex=function(C,L,K){try{var z,G,X=i.parseSigHex(L);z=X.r,G=X.s;var g=n.decodeFromHex(this.ecparams.curve,K),P=new r(C.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(P,z,G,g)}catch{return!1}},this.verify=function(C,L,K){var z,G,X;if(Bitcoin.Util.isArray(L)){var g=this.parseSig(L);z=g.r,G=g.s}else{if((L===void 0?"undefined":l(L))!=="object"||!L.r||!L.s)throw"Invalid value for signature";z=L.r,G=L.s}if(K instanceof yt)X=K;else{if(!Bitcoin.Util.isArray(K))throw"Invalid format for pubkey value, must be byte array or ECPointFp";X=n.decodeFrom(this.ecparams.curve,K)}var P=r.fromByteArrayUnsigned(C);return this.verifyRaw(P,z,G,X)},this.verifyRaw=function(C,L,K,z){var G=this.ecparams.n,X=this.ecparams.G;if(L.compareTo(r.ONE)<0||L.compareTo(G)>=0||K.compareTo(r.ONE)<0||K.compareTo(G)>=0)return!1;var g=K.modInverse(G),P=C.multiply(g).mod(G),D=L.multiply(g).mod(G);return X.multiply(P).add(z.multiply(D)).getX().toBigInteger().mod(G).equals(L)},this.serializeSig=function(C,L){var K=C.toByteArraySigned(),z=L.toByteArraySigned(),G=[];return G.push(2),G.push(K.length),(G=G.concat(K)).push(2),G.push(z.length),(G=G.concat(z)).unshift(G.length),G.unshift(48),G},this.parseSig=function(C){var L;if(C[0]!=48)throw new Error("Signature not a valid DERSequence");if(C[L=2]!=2)throw new Error("First element in signature must be a DERInteger");var K=C.slice(L+2,L+2+C[L+1]);if(C[L+=2+C[L+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var z=C.slice(L+2,L+2+C[L+1]);return L+=2+C[L+1],{r:r.fromByteArrayUnsigned(K),s:r.fromByteArrayUnsigned(z)}},this.parseSigCompact=function(C){if(C.length!==65)throw"Signature has the wrong length";var L=C[0]-27;if(L<0||L>7)throw"Invalid signature type";var K=this.ecparams.n;return{r:r.fromByteArrayUnsigned(C.slice(1,33)).mod(K),s:r.fromByteArrayUnsigned(C.slice(33,65)).mod(K),i:L}},this.readPKCS5PrvKeyHex=function(C){if(S(C)===!1)throw new Error("not ASN.1 hex string");var L,K,z;try{L=m(C,0,["[0]",0],"06"),K=m(C,0,[1],"04");try{z=m(C,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=f(L),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex(K),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(C){if(S(C)===!1)throw new t("not ASN.1 hex string");var L,K,z;try{m(C,0,[1,0],"06"),L=m(C,0,[1,1],"06"),K=m(C,0,[2,0,1],"04");try{z=m(C,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=f(L),this.curveName===void 0)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex(K),this.isPublic=!1},this.readPKCS8PubKeyHex=function(C){if(S(C)===!1)throw new t("not ASN.1 hex string");var L,K;try{m(C,0,[0,0],"06"),L=m(C,0,[0,1],"06"),K=m(C,0,[1],"03")}catch{throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=f(L),this.curveName===null)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(K)},this.readCertPubKeyHex=function(C,L){if(S(C)===!1)throw new t("not ASN.1 hex string");var K,z;try{K=m(C,0,[0,5,0,1],"06"),z=m(C,0,[0,5,1],"03")}catch{throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=f(K),this.curveName===null)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},e!==void 0&&e.curve!==void 0&&(this.curveName=e.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),e!==void 0&&(e.prv!==void 0&&this.setPrivateKeyHex(e.prv),e.pub!==void 0&&this.setPublicKeyHex(e.pub))},y.crypto.ECDSA.parseSigHex=function(e){var t=y.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new H(t.r,16),s:new H(t.s,16)}},y.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=it,r=t.getChildIdx,n=t.getV;if(t.checkStrictDER(e,0),e.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var i=r(e,0);if(i.length!=2)throw new Error("signature shall have two elements");var s=i[0],f=i[1];if(e.substr(s,2)!="02")throw new Error("1st item not ASN.1 integer");if(e.substr(f,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:n(e,s),s:n(e,f)}},y.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=y.crypto.ECDSA.parseSigHexInHexRS(e),r=t.r,n=t.s;if(r.substr(0,2)=="00"&&r.length%32==2&&(r=r.substr(2)),n.substr(0,2)=="00"&&n.length%32==2&&(n=n.substr(2)),r.length%32==30&&(r="00"+r),n.length%32==30&&(n="00"+n),r.length%32!=0)throw"unknown ECDSA sig r length error";if(n.length%32!=0)throw"unknown ECDSA sig s length error";return r+n},y.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var t=e.substr(0,e.length/2),r=e.substr(e.length/2);return y.crypto.ECDSA.hexRSSigToASN1Sig(t,r)},y.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var r=new H(e,16),n=new H(t,16);return y.crypto.ECDSA.biRSSigToASN1Sig(r,n)},y.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var r=y.asn1,n=new r.DERInteger({bigint:e}),i=new r.DERInteger({bigint:t});return new r.DERSequence({array:[n,i]}).getEncodedHex()},y.crypto.ECDSA.getName=function(e){return e==="2b8104001f"?"secp192k1":e==="2a8648ce3d030107"?"secp256r1":e==="2b8104000a"?"secp256k1":e==="2b81040021"?"secp224r1":e==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)!==-1?"secp256r1":"|secp256k1|".indexOf(e)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(e)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(e)!==-1?"secp384r1":null},y!==void 0&&y||(v.KJUR=y={}),y.crypto!==void 0&&y.crypto||(y.crypto={}),y.crypto.ECParameterDB=new function(){var e={},t={};function r(n){return new H(n,16)}this.getByName=function(n){var i=n;if(t[i]!==void 0&&(i=t[n]),e[i]!==void 0)return e[i];throw"unregistered EC curve name: "+i},this.regist=function(n,i,s,f,w,m,S,E,C,L,K,z){e[n]={};var G=r(s),X=r(f),g=r(w),P=r(m),D=r(S),N=new pe(G,X,g),Y=N.decodePointHex("04"+E+C);e[n].name=n,e[n].keylen=i,e[n].curve=N,e[n].G=Y,e[n].n=P,e[n].h=D,e[n].oid=K,e[n].info=z;for(var Q=0;Q<L.length;Q++)t[L[Q]]=n}},y.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),y.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),y.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),y.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),y.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),y.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),y.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),y.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),y.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),y.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var Ot=function(){var e=function(S,E,C){return t(d.AES,S,E,C)},t=function(S,E,C,L){var K=d.enc.Hex.parse(E),z=d.enc.Hex.parse(C),G=d.enc.Hex.parse(L),X={};X.key=z,X.iv=G,X.ciphertext=K;var g=S.decrypt(X,z,{iv:G});return d.enc.Hex.stringify(g)},r=function(S,E,C){return n(d.AES,S,E,C)},n=function(S,E,C,L){var K=d.enc.Hex.parse(E),z=d.enc.Hex.parse(C),G=d.enc.Hex.parse(L),X=S.encrypt(K,z,{iv:G}),g=d.enc.Hex.parse(X.toString());return d.enc.Base64.stringify(g)},i={"AES-256-CBC":{proc:e,eproc:r,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:r,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:r,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(S,E,C){return t(d.TripleDES,S,E,C)},eproc:function(S,E,C){return n(d.TripleDES,S,E,C)},keylen:24,ivlen:8},"DES-CBC":{proc:function(S,E,C){return t(d.DES,S,E,C)},eproc:function(S,E,C){return n(d.DES,S,E,C)},keylen:8,ivlen:8}},s=function(S){var E={},C=S.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));C&&(E.cipher=C[1],E.ivsalt=C[2]);var L=S.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));L&&(E.type=L[1]);var K=-1,z=0;S.indexOf(`\r
\r
`)!=-1&&(K=S.indexOf(`\r
\r
`),z=2),S.indexOf(`

`)!=-1&&(K=S.indexOf(`

`),z=1);var G=S.indexOf("-----END");if(K!=-1&&G!=-1){var X=S.substring(K+2*z,G-z);X=X.replace(/\s+/g,""),E.data=X}return E},f=function(S,E,C){for(var L=C.substring(0,16),K=d.enc.Hex.parse(L),z=d.enc.Utf8.parse(E),G=i[S].keylen+i[S].ivlen,X="",g=null;;){var P=d.algo.MD5.create();if(g!=null&&P.update(g),P.update(z),P.update(K),g=P.finalize(),(X+=d.enc.Hex.stringify(g)).length>=2*G)break}var D={};return D.keyhex=X.substr(0,2*i[S].keylen),D.ivhex=X.substr(2*i[S].keylen,2*i[S].ivlen),D},w=function(S,E,C,L){var K=d.enc.Base64.parse(S),z=d.enc.Hex.stringify(K);return(0,i[E].proc)(z,C,L)};return{version:"1.0.0",parsePKCS5PEM:function(S){return s(S)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(S,E,C){return f(S,E,C)},decryptKeyB64:function(S,E,C,L){return w(S,E,C,L)},getDecryptedKeyHex:function(S,E){var C=s(S),L=C.cipher,K=C.ivsalt,z=C.data,G=f(L,E,K).keyhex;return w(z,L,G,K)},getEncryptedPKCS5PEMFromPrvKeyHex:function(S,E,C,L,K){var z="";if(L!==void 0&&L!=null||(L="AES-256-CBC"),i[L]===void 0)throw"KEYUTIL unsupported algorithm: "+L;K!==void 0&&K!=null||(K=function(g){var P=d.lib.WordArray.random(g);return d.enc.Hex.stringify(P)}(i[L].ivlen).toUpperCase());var G=function(g,P,D,N){return(0,i[P].eproc)(g,D,N)}(E,L,f(L,C,K).keyhex,K);return z="-----BEGIN "+S+` PRIVATE KEY-----\r
`,z+=`Proc-Type: 4,ENCRYPTED\r
`,z+="DEK-Info: "+L+","+K+`\r
`,z+=`\r
`,z+=G.replace(/(.{64})/g,`$1\r
`),z+=`\r
-----END `+S+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(S){var E=it,C=E.getChildIdx,L=E.getV,K={},z=C(S,0);if(z.length!=2)throw"malformed format: SEQUENCE(0).items != 2: "+z.length;K.ciphertext=L(S,z[1]);var G=C(S,z[0]);if(G.length!=2)throw"malformed format: SEQUENCE(0.0).items != 2: "+G.length;if(L(S,G[0])!="2a864886f70d01050d")throw"this only supports pkcs5PBES2";var X=C(S,G[1]);if(G.length!=2)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+X.length;var g=C(S,X[1]);if(g.length!=2)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+g.length;if(L(S,g[0])!="2a864886f70d0307")throw"this only supports TripleDES";K.encryptionSchemeAlg="TripleDES",K.encryptionSchemeIV=L(S,g[1]);var P=C(S,X[0]);if(P.length!=2)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+P.length;if(L(S,P[0])!="2a864886f70d01050c")throw"this only supports pkcs5PBKDF2";var D=C(S,P[1]);if(D.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+D.length;K.pbkdf2Salt=L(S,D[0]);var N=L(S,D[1]);try{K.pbkdf2Iter=parseInt(N,16)}catch{throw"malformed format pbkdf2Iter: "+N}return K},getPBKDF2KeyHexFromParam:function(S,E){var C=d.enc.Hex.parse(S.pbkdf2Salt),L=S.pbkdf2Iter,K=d.PBKDF2(E,C,{keySize:6,iterations:L});return d.enc.Hex.stringify(K)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(S,E){var C=he(S,"ENCRYPTED PRIVATE KEY"),L=this.parseHexOfEncryptedPKCS8(C),K=Ot.getPBKDF2KeyHexFromParam(L,E),z={};z.ciphertext=d.enc.Hex.parse(L.ciphertext);var G=d.enc.Hex.parse(K),X=d.enc.Hex.parse(L.encryptionSchemeIV),g=d.TripleDES.decrypt(z,G,{iv:X});return d.enc.Hex.stringify(g)},getKeyFromEncryptedPKCS8PEM:function(S,E){var C=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(S,E);return this.getKeyFromPlainPrivatePKCS8Hex(C)},parsePlainPrivatePKCS8Hex:function(S){var E=it,C=E.getChildIdx,L=E.getV,K={algparam:null};if(S.substr(0,2)!="30")throw"malformed plain PKCS8 private key(code:001)";var z=C(S,0);if(z.length!=3)throw"malformed plain PKCS8 private key(code:002)";if(S.substr(z[1],2)!="30")throw"malformed PKCS8 private key(code:003)";var G=C(S,z[1]);if(G.length!=2)throw"malformed PKCS8 private key(code:004)";if(S.substr(G[0],2)!="06")throw"malformed PKCS8 private key(code:005)";if(K.algoid=L(S,G[0]),S.substr(G[1],2)=="06"&&(K.algparam=L(S,G[1])),S.substr(z[2],2)!="04")throw"malformed PKCS8 private key(code:006)";return K.keyidx=E.getVidx(S,z[2]),K},getKeyFromPlainPrivatePKCS8PEM:function(S){var E=he(S,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(E)},getKeyFromPlainPrivatePKCS8Hex:function(S){var E,C=this.parsePlainPrivatePKCS8Hex(S);if(C.algoid=="2a864886f70d010101")E=new lt;else if(C.algoid=="2a8648ce380401")E=new y.crypto.DSA;else{if(C.algoid!="2a8648ce3d0201")throw"unsupported private key algorithm";E=new y.crypto.ECDSA}return E.readPKCS8PrvKeyHex(S),E},_getKeyFromPublicPKCS8Hex:function(S){var E,C=it.getVbyList(S,0,[0,0],"06");if(C==="2a864886f70d010101")E=new lt;else if(C==="2a8648ce380401")E=new y.crypto.DSA;else{if(C!=="2a8648ce3d0201")throw"unsupported PKCS#8 public key hex";E=new y.crypto.ECDSA}return E.readPKCS8PubKeyHex(S),E},parsePublicRawRSAKeyHex:function(S){var E=it,C=E.getChildIdx,L=E.getV,K={};if(S.substr(0,2)!="30")throw"malformed RSA key(code:001)";var z=C(S,0);if(z.length!=2)throw"malformed RSA key(code:002)";if(S.substr(z[0],2)!="02")throw"malformed RSA key(code:003)";if(K.n=L(S,z[0]),S.substr(z[1],2)!="02")throw"malformed RSA key(code:004)";return K.e=L(S,z[1]),K},parsePublicPKCS8Hex:function(S){var E=it,C=E.getChildIdx,L=E.getV,K={algparam:null},z=C(S,0);if(z.length!=2)throw"outer DERSequence shall have 2 elements: "+z.length;var G=z[0];if(S.substr(G,2)!="30")throw"malformed PKCS8 public key(code:001)";var X=C(S,G);if(X.length!=2)throw"malformed PKCS8 public key(code:002)";if(S.substr(X[0],2)!="06")throw"malformed PKCS8 public key(code:003)";if(K.algoid=L(S,X[0]),S.substr(X[1],2)=="06"?K.algparam=L(S,X[1]):S.substr(X[1],2)=="30"&&(K.algparam={},K.algparam.p=E.getVbyList(S,X[1],[0],"02"),K.algparam.q=E.getVbyList(S,X[1],[1],"02"),K.algparam.g=E.getVbyList(S,X[1],[2],"02")),S.substr(z[1],2)!="03")throw"malformed PKCS8 public key(code:004)";return K.key=L(S,z[1]).substr(2),K}}}();Ot.getKey=function(e,t,r){var n=(X=it).getChildIdx,i=(X.getV,X.getVbyList),s=y.crypto,f=s.ECDSA,w=s.DSA,m=lt,S=he,E=Ot;if(m!==void 0&&e instanceof m||f!==void 0&&e instanceof f||w!==void 0&&e instanceof w)return e;if(e.curve!==void 0&&e.xy!==void 0&&e.d===void 0)return new f({pub:e.xy,curve:e.curve});if(e.curve!==void 0&&e.d!==void 0)return new f({prv:e.d,curve:e.curve});if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d===void 0)return(ht=new m).setPublic(e.n,e.e),ht;if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p!==void 0&&e.q!==void 0&&e.dp!==void 0&&e.dq!==void 0&&e.co!==void 0&&e.qi===void 0)return(ht=new m).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),ht;if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p===void 0)return(ht=new m).setPrivate(e.n,e.e,e.d),ht;if(e.p!==void 0&&e.q!==void 0&&e.g!==void 0&&e.y!==void 0&&e.x===void 0)return(ht=new w).setPublic(e.p,e.q,e.g,e.y),ht;if(e.p!==void 0&&e.q!==void 0&&e.g!==void 0&&e.y!==void 0&&e.x!==void 0)return(ht=new w).setPrivate(e.p,e.q,e.g,e.y,e.x),ht;if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d===void 0)return(ht=new m).setPublic(Ft(e.n),Ft(e.e)),ht;if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p!==void 0&&e.q!==void 0&&e.dp!==void 0&&e.dq!==void 0&&e.qi!==void 0)return(ht=new m).setPrivateEx(Ft(e.n),Ft(e.e),Ft(e.d),Ft(e.p),Ft(e.q),Ft(e.dp),Ft(e.dq),Ft(e.qi)),ht;if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0)return(ht=new m).setPrivate(Ft(e.n),Ft(e.e),Ft(e.d)),ht;if(e.kty==="EC"&&e.crv!==void 0&&e.x!==void 0&&e.y!==void 0&&e.d===void 0){var C=(ot=new f({curve:e.crv})).ecparams.keylen/4,L="04"+("0000000000"+Ft(e.x)).slice(-C)+("0000000000"+Ft(e.y)).slice(-C);return ot.setPublicKeyHex(L),ot}if(e.kty==="EC"&&e.crv!==void 0&&e.x!==void 0&&e.y!==void 0&&e.d!==void 0){C=(ot=new f({curve:e.crv})).ecparams.keylen/4,L="04"+("0000000000"+Ft(e.x)).slice(-C)+("0000000000"+Ft(e.y)).slice(-C);var K=("0000000000"+Ft(e.d)).slice(-C);return ot.setPublicKeyHex(L),ot.setPrivateKeyHex(K),ot}if(r==="pkcs5prv"){var z,G=e,X=it;if((z=n(G,0)).length===9)(ht=new m).readPKCS5PrvKeyHex(G);else if(z.length===6)(ht=new w).readPKCS5PrvKeyHex(G);else{if(!(z.length>2&&G.substr(z[1],2)==="04"))throw"unsupported PKCS#1/5 hexadecimal key";(ht=new f).readPKCS5PrvKeyHex(G)}return ht}if(r==="pkcs8prv")return ht=E.getKeyFromPlainPrivatePKCS8Hex(e);if(r==="pkcs8pub")return E._getKeyFromPublicPKCS8Hex(e);if(r==="x509pub")return Dt.getPublicKeyFromCertHex(e);if(e.indexOf("-END CERTIFICATE-",0)!=-1||e.indexOf("-END X509 CERTIFICATE-",0)!=-1||e.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return Dt.getPublicKeyFromCertPEM(e);if(e.indexOf("-END PUBLIC KEY-")!=-1){var g=he(e,"PUBLIC KEY");return E._getKeyFromPublicPKCS8Hex(g)}if(e.indexOf("-END RSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var P=S(e,"RSA PRIVATE KEY");return E.getKey(P,null,"pkcs5prv")}if(e.indexOf("-END DSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var D=i(Et=S(e,"DSA PRIVATE KEY"),0,[1],"02"),N=i(Et,0,[2],"02"),Y=i(Et,0,[3],"02"),Q=i(Et,0,[4],"02"),ct=i(Et,0,[5],"02");return(ht=new w).setPrivate(new H(D,16),new H(N,16),new H(Y,16),new H(Q,16),new H(ct,16)),ht}if(e.indexOf("-END EC PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1)return P=S(e,"EC PRIVATE KEY"),E.getKey(P,null,"pkcs5prv");if(e.indexOf("-END PRIVATE KEY-")!=-1)return E.getKeyFromPlainPrivatePKCS8PEM(e);if(e.indexOf("-END RSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var rt=E.getDecryptedKeyHex(e,t),gt=new lt;return gt.readPKCS5PrvKeyHex(rt),gt}if(e.indexOf("-END EC PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var ot,ht=i(Et=E.getDecryptedKeyHex(e,t),0,[1],"04"),wt=i(Et,0,[2,0],"06"),xt=i(Et,0,[3,0],"03").substr(2);if(y.crypto.OID.oidhex2name[wt]===void 0)throw"undefined OID(hex) in KJUR.crypto.OID: "+wt;return(ot=new f({curve:y.crypto.OID.oidhex2name[wt]})).setPublicKeyHex(xt),ot.setPrivateKeyHex(ht),ot.isPublic=!1,ot}if(e.indexOf("-END DSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var Et;return D=i(Et=E.getDecryptedKeyHex(e,t),0,[1],"02"),N=i(Et,0,[2],"02"),Y=i(Et,0,[3],"02"),Q=i(Et,0,[4],"02"),ct=i(Et,0,[5],"02"),(ht=new w).setPrivate(new H(D,16),new H(N,16),new H(Y,16),new H(Q,16),new H(ct,16)),ht}if(e.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return E.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")},Ot.generateKeypair=function(e,t){if(e=="RSA"){var r=t;(f=new lt).generate(r,"10001"),f.isPrivate=!0,f.isPublic=!0;var n=new lt,i=f.n.toString(16),s=f.e.toString(16);return n.setPublic(i,s),n.isPrivate=!1,n.isPublic=!0,(w={}).prvKeyObj=f,w.pubKeyObj=n,w}if(e=="EC"){var f,w,m=t,S=new y.crypto.ECDSA({curve:m}).generateKeyPairHex();return(f=new y.crypto.ECDSA({curve:m})).setPublicKeyHex(S.ecpubhex),f.setPrivateKeyHex(S.ecprvhex),f.isPrivate=!0,f.isPublic=!1,(n=new y.crypto.ECDSA({curve:m})).setPublicKeyHex(S.ecpubhex),n.isPrivate=!1,n.isPublic=!0,(w={}).prvKeyObj=f,w.pubKeyObj=n,w}throw"unknown algorithm: "+e},Ot.getPEM=function(e,t,r,n,i,s){var f=y,w=f.asn1,m=w.DERObjectIdentifier,S=w.DERInteger,E=w.ASN1Util.newObject,C=w.x509.SubjectPublicKeyInfo,L=f.crypto,K=L.DSA,z=L.ECDSA,G=lt;function X(ot){return E({seq:[{int:0},{int:{bigint:ot.n}},{int:ot.e},{int:{bigint:ot.d}},{int:{bigint:ot.p}},{int:{bigint:ot.q}},{int:{bigint:ot.dmp1}},{int:{bigint:ot.dmq1}},{int:{bigint:ot.coeff}}]})}function g(ot){return E({seq:[{int:1},{octstr:{hex:ot.prvKeyHex}},{tag:["a0",!0,{oid:{name:ot.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ot.pubKeyHex}}]}]})}function P(ot){return E({seq:[{int:0},{int:{bigint:ot.p}},{int:{bigint:ot.q}},{int:{bigint:ot.g}},{int:{bigint:ot.y}},{int:{bigint:ot.x}}]})}if((G!==void 0&&e instanceof G||K!==void 0&&e instanceof K||z!==void 0&&e instanceof z)&&e.isPublic==1&&(t===void 0||t=="PKCS8PUB"))return Zt(Q=new C(e).getEncodedHex(),"PUBLIC KEY");if(t=="PKCS1PRV"&&G!==void 0&&e instanceof G&&(r===void 0||r==null)&&e.isPrivate==1)return Zt(Q=X(e).getEncodedHex(),"RSA PRIVATE KEY");if(t=="PKCS1PRV"&&z!==void 0&&e instanceof z&&(r===void 0||r==null)&&e.isPrivate==1){var D=new m({name:e.curveName}).getEncodedHex(),N=g(e).getEncodedHex(),Y="";return Y+=Zt(D,"EC PARAMETERS"),Y+=Zt(N,"EC PRIVATE KEY")}if(t=="PKCS1PRV"&&K!==void 0&&e instanceof K&&(r===void 0||r==null)&&e.isPrivate==1)return Zt(Q=P(e).getEncodedHex(),"DSA PRIVATE KEY");if(t=="PKCS5PRV"&&G!==void 0&&e instanceof G&&r!==void 0&&r!=null&&e.isPrivate==1){var Q=X(e).getEncodedHex();return n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",Q,r,n,s)}if(t=="PKCS5PRV"&&z!==void 0&&e instanceof z&&r!==void 0&&r!=null&&e.isPrivate==1)return Q=g(e).getEncodedHex(),n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",Q,r,n,s);if(t=="PKCS5PRV"&&K!==void 0&&e instanceof K&&r!==void 0&&r!=null&&e.isPrivate==1)return Q=P(e).getEncodedHex(),n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",Q,r,n,s);var ct=function(ht,wt){var xt=rt(ht,wt);return new E({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:xt.pbkdf2Salt}},{int:xt.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:xt.encryptionSchemeIV}}]}]}]},{octstr:{hex:xt.ciphertext}}]}).getEncodedHex()},rt=function(ht,wt){var xt=d.lib.WordArray.random(8),Et=d.lib.WordArray.random(8),$t=d.PBKDF2(wt,xt,{keySize:6,iterations:100}),Kt=d.enc.Hex.parse(ht),Wt=d.TripleDES.encrypt(Kt,$t,{iv:Et})+"",Rt={};return Rt.ciphertext=Wt,Rt.pbkdf2Salt=d.enc.Hex.stringify(xt),Rt.pbkdf2Iter=100,Rt.encryptionSchemeAlg="DES-EDE3-CBC",Rt.encryptionSchemeIV=d.enc.Hex.stringify(Et),Rt};if(t=="PKCS8PRV"&&G!=null&&e instanceof G&&e.isPrivate==1){var gt=X(e).getEncodedHex();return Q=E({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:gt}}]}).getEncodedHex(),r===void 0||r==null?Zt(Q,"PRIVATE KEY"):Zt(N=ct(Q,r),"ENCRYPTED PRIVATE KEY")}if(t=="PKCS8PRV"&&z!==void 0&&e instanceof z&&e.isPrivate==1)return gt=new E({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]}).getEncodedHex(),Q=E({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:gt}}]}).getEncodedHex(),r===void 0||r==null?Zt(Q,"PRIVATE KEY"):Zt(N=ct(Q,r),"ENCRYPTED PRIVATE KEY");if(t=="PKCS8PRV"&&K!==void 0&&e instanceof K&&e.isPrivate==1)return gt=new S({bigint:e.x}).getEncodedHex(),Q=E({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:gt}}]}).getEncodedHex(),r===void 0||r==null?Zt(Q,"PRIVATE KEY"):Zt(N=ct(Q,r),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},Ot.getKeyFromCSRPEM=function(e){var t=he(e,"CERTIFICATE REQUEST");return Ot.getKeyFromCSRHex(t)},Ot.getKeyFromCSRHex=function(e){var t=Ot.parseCSRHex(e);return Ot.getKey(t.p8pubkeyhex,null,"pkcs8pub")},Ot.parseCSRHex=function(e){var t=it,r=t.getChildIdx,n=t.getTLV,i={},s=e;if(s.substr(0,2)!="30")throw"malformed CSR(code:001)";var f=r(s,0);if(f.length<1)throw"malformed CSR(code:002)";if(s.substr(f[0],2)!="30")throw"malformed CSR(code:003)";var w=r(s,f[0]);if(w.length<3)throw"malformed CSR(code:004)";return i.p8pubkeyhex=n(s,w[2]),i},Ot.getKeyID=function(e){var t=Ot,r=it;typeof e=="string"&&e.indexOf("BEGIN ")!=-1&&(e=t.getKey(e));var n=he(t.getPEM(e)),i=r.getIdxbyList(n,0,[1]),s=r.getV(n,i).substring(2);return y.crypto.Util.hashHex(s,"sha1")},Ot.getJWKFromKey=function(e){var t={};if(e instanceof lt&&e.isPrivate)return t.kty="RSA",t.n=Ut(e.n.toString(16)),t.e=Ut(e.e.toString(16)),t.d=Ut(e.d.toString(16)),t.p=Ut(e.p.toString(16)),t.q=Ut(e.q.toString(16)),t.dp=Ut(e.dmp1.toString(16)),t.dq=Ut(e.dmq1.toString(16)),t.qi=Ut(e.coeff.toString(16)),t;if(e instanceof lt&&e.isPublic)return t.kty="RSA",t.n=Ut(e.n.toString(16)),t.e=Ut(e.e.toString(16)),t;if(e instanceof y.crypto.ECDSA&&e.isPrivate){if((n=e.getShortNISTPCurveName())!=="P-256"&&n!=="P-384")throw"unsupported curve name for JWT: "+n;var r=e.getPublicKeyXYHex();return t.kty="EC",t.crv=n,t.x=Ut(r.x),t.y=Ut(r.y),t.d=Ut(e.prvKeyHex),t}if(e instanceof y.crypto.ECDSA&&e.isPublic){var n;if((n=e.getShortNISTPCurveName())!=="P-256"&&n!=="P-384")throw"unsupported curve name for JWT: "+n;return r=e.getPublicKeyXYHex(),t.kty="EC",t.crv=n,t.x=Ut(r.x),t.y=Ut(r.y),t}throw"not supported key object"},lt.getPosArrayOfChildrenFromHex=function(e){return it.getChildIdx(e,0)},lt.getHexValueArrayOfChildrenFromHex=function(e){var t,r=it.getV,n=r(e,(t=lt.getPosArrayOfChildrenFromHex(e))[0]),i=r(e,t[1]),s=r(e,t[2]),f=r(e,t[3]),w=r(e,t[4]),m=r(e,t[5]),S=r(e,t[6]),E=r(e,t[7]),C=r(e,t[8]);return(t=new Array).push(n,i,s,f,w,m,S,E,C),t},lt.prototype.readPrivateKeyFromPEMString=function(e){var t=he(e),r=lt.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},lt.prototype.readPKCS5PrvKeyHex=function(e){var t=lt.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},lt.prototype.readPKCS8PrvKeyHex=function(e){var t,r,n,i,s,f,w,m,S=it,E=S.getVbyListEx;if(S.isASN1HEX(e)===!1)throw new Error("not ASN.1 hex string");try{t=E(e,0,[2,0,1],"02"),r=E(e,0,[2,0,2],"02"),n=E(e,0,[2,0,3],"02"),i=E(e,0,[2,0,4],"02"),s=E(e,0,[2,0,5],"02"),f=E(e,0,[2,0,6],"02"),w=E(e,0,[2,0,7],"02"),m=E(e,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,r,n,i,s,f,w,m)},lt.prototype.readPKCS5PubKeyHex=function(e){var t=it,r=t.getV;if(t.isASN1HEX(e)===!1)throw new Error("keyHex is not ASN.1 hex string");var n=t.getChildIdx(e,0);if(n.length!==2||e.substr(n[0],2)!=="02"||e.substr(n[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var i=r(e,n[0]),s=r(e,n[1]);this.setPublic(i,s)},lt.prototype.readPKCS8PubKeyHex=function(e){var t=it;if(t.isASN1HEX(e)===!1)throw new Error("not ASN.1 hex string");if(t.getTLVbyListEx(e,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var r=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(r)},lt.prototype.readCertPubKeyHex=function(e,t){var r,n;(r=new Dt).readCertHex(e),n=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(n)};var pr=new RegExp("[^0-9a-f]","gi");function ar(e,t){for(var r="",n=t/4-e.length,i=0;i<n;i++)r+="0";return r+e}function ur(e,t,r){for(var n="",i=0;n.length<t;)n+=re(r(ce(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])))),i+=1;return n}function cr(e){for(var t in y.crypto.Util.DIGESTINFOHEAD){var r=y.crypto.Util.DIGESTINFOHEAD[t],n=r.length;if(e.substring(0,n)==r)return[t,e.substring(n)]}return[]}function Dt(e){var t,r=it,n=r.getChildIdx,i=r.getV,s=r.getTLV,f=r.getVbyList,w=r.getVbyListEx,m=r.getTLVbyList,S=r.getTLVbyListEx,E=r.getIdxbyList,C=r.getIdxbyListEx,L=r.getVidx,K=r.oidname,z=r.hextooidstr,G=Dt,X=he;try{t=y.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){return this.hex===null||this.version!==0?this.version:m(this.hex,0,[0,0])!=="a003020102"?(this.version=1,this.foffset=-1,1):(this.version=3,3)},this.getSerialNumberHex=function(){return w(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var g=S(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(g)},this.getAlgorithmIdentifierName=function(g){for(var P in t)if(g===t[P])return P;return K(w(g,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return m(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return G.hex2dn(this.getIssuerHex())},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return m(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return G.hex2dn(this.getSubjectHex())},this.getNotBefore=function(){var g=f(this.hex,0,[0,4+this.foffset,0]);return g=g.replace(/(..)/g,"%$1"),g=decodeURIComponent(g)},this.getNotAfter=function(){var g=f(this.hex,0,[0,4+this.foffset,1]);return g=g.replace(/(..)/g,"%$1"),g=decodeURIComponent(g)},this.getPublicKeyHex=function(){return r.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return E(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var g=this.getPublicKeyIdx();return E(this.hex,g,[1,0],"30")},this.getPublicKey=function(){return Ot.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var g=m(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(g)},this.getSignatureValueHex=function(){return f(this.hex,0,[2],"03",!0)},this.verifySignature=function(g){var P=this.getSignatureAlgorithmField(),D=this.getSignatureValueHex(),N=m(this.hex,0,[0],"30"),Y=new y.crypto.Signature({alg:P});return Y.init(g),Y.updateHex(N),Y.verify(D)},this.parseExt=function(g){var P,D,N;if(g===void 0){if(N=this.hex,this.version!==3)return-1;P=E(N,0,[0,7,0],"30"),D=n(N,P)}else{N=he(g);var Y=E(N,0,[0,3,0,0],"06");if(i(N,Y)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);P=E(N,0,[0,3,0,1,0],"30"),D=n(N,P),this.hex=N}this.aExtInfo=new Array;for(var Q=0;Q<D.length;Q++){var ct={critical:!1},rt=0;n(N,D[Q]).length===3&&(ct.critical=!0,rt=1),ct.oid=r.hextooidstr(f(N,D[Q],[0],"06"));var gt=E(N,D[Q],[1+rt]);ct.vidx=L(N,gt),this.aExtInfo.push(ct)}},this.getExtInfo=function(g){var P=this.aExtInfo,D=g;if(g.match(/^[0-9.]+$/)||(D=y.asn1.x509.OID.name2oid(g)),D!==""){for(var N=0;N<P.length;N++)if(P[N].oid===D)return P[N]}},this.getExtBasicConstraints=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("basicConstraints");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"basicConstraints"};if(P&&(N.critical=!0),g==="3000")return N;if(g==="30030101ff")return N.cA=!0,N;if(g.substr(0,12)==="30060101ff02"){var Y=i(g,10),Q=parseInt(Y,16);return N.cA=!0,N.pathLen=Q,N}throw new Error("hExtV parse error: "+g)},this.getExtKeyUsage=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("keyUsage");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"keyUsage"};return P&&(N.critical=!0),N.names=this.getExtKeyUsageString(g).split(","),N},this.getExtKeyUsageBin=function(g){if(g===void 0){var P=this.getExtInfo("keyUsage");if(P===void 0)return"";g=s(this.hex,P.vidx)}if(g.length!=8&&g.length!=10)throw new Error("malformed key usage value: "+g);var D="000000000000000"+parseInt(g.substr(6),16).toString(2);return g.length==8&&(D=D.slice(-8)),g.length==10&&(D=D.slice(-16)),(D=D.replace(/0+$/,""))==""&&(D="0"),D},this.getExtKeyUsageString=function(g){for(var P=this.getExtKeyUsageBin(g),D=new Array,N=0;N<P.length;N++)P.substr(N,1)=="1"&&D.push(Dt.KEYUSAGE_NAME[N]);return D.join(",")},this.getExtSubjectKeyIdentifier=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("subjectKeyIdentifier");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"subjectKeyIdentifier"};P&&(N.critical=!0);var Y=i(g,0);return N.kid={hex:Y},N},this.getExtAuthorityKeyIdentifier=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("authorityKeyIdentifier");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"authorityKeyIdentifier"};P&&(N.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var ct=g.substr(Y[Q],2);if(ct==="80"&&(N.kid={hex:i(g,Y[Q])}),ct==="a1"){var rt=s(g,Y[Q]),gt=this.getGeneralNames(rt);N.issuer=gt[0].dn}ct==="82"&&(N.sn={hex:i(g,Y[Q])})}return N},this.getExtExtKeyUsage=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("extKeyUsage");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"extKeyUsage",array:[]};P&&(N.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++)N.array.push(K(i(g,Y[Q])));return N},this.getExtExtKeyUsageName=function(){var g=this.getExtInfo("extKeyUsage");if(g===void 0)return g;var P=new Array,D=s(this.hex,g.vidx);if(D==="")return P;for(var N=n(D,0),Y=0;Y<N.length;Y++)P.push(K(i(D,N[Y])));return P},this.getExtSubjectAltName=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("subjectAltName");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"subjectAltName",array:[]};return P&&(N.critical=!0),N.array=this.getGeneralNames(g),N},this.getExtIssuerAltName=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("issuerAltName");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"issuerAltName",array:[]};return P&&(N.critical=!0),N.array=this.getGeneralNames(g),N},this.getGeneralNames=function(g){for(var P=n(g,0),D=[],N=0;N<P.length;N++){var Y=this.getGeneralName(s(g,P[N]));Y!==void 0&&D.push(Y)}return D},this.getGeneralName=function(g){var P=g.substr(0,2),D=i(g,0),N=re(D);return P=="81"?{rfc822:N}:P=="82"?{dns:N}:P=="86"?{uri:N}:P=="87"?{ip:Me(D)}:P=="a4"?{dn:this.getX500Name(D)}:void 0},this.getExtSubjectAltName2=function(){var g,P,D,N=this.getExtInfo("subjectAltName");if(N===void 0)return N;for(var Y=new Array,Q=s(this.hex,N.vidx),ct=n(Q,0),rt=0;rt<ct.length;rt++)D=Q.substr(ct[rt],2),g=i(Q,ct[rt]),D==="81"&&(P=jt(g),Y.push(["MAIL",P])),D==="82"&&(P=jt(g),Y.push(["DNS",P])),D==="84"&&(P=Dt.hex2dn(g,0),Y.push(["DN",P])),D==="86"&&(P=jt(g),Y.push(["URI",P])),D==="87"&&(P=Me(g),Y.push(["IP",P]));return Y},this.getExtCRLDistributionPoints=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("cRLDistributionPoints");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"cRLDistributionPoints",array:[]};P&&(N.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var ct=s(g,Y[Q]);N.array.push(this.getDistributionPoint(ct))}return N},this.getDistributionPoint=function(g){for(var P={},D=n(g,0),N=0;N<D.length;N++){var Y=g.substr(D[N],2),Q=s(g,D[N]);Y=="a0"&&(P.dpname=this.getDistributionPointName(Q))}return P},this.getDistributionPointName=function(g){for(var P={},D=n(g,0),N=0;N<D.length;N++){var Y=g.substr(D[N],2),Q=s(g,D[N]);Y=="a0"&&(P.full=this.getGeneralNames(Q))}return P},this.getExtCRLDistributionPointsURI=function(){var g=this.getExtInfo("cRLDistributionPoints");if(g===void 0)return g;for(var P=new Array,D=n(this.hex,g.vidx),N=0;N<D.length;N++)try{var Y=jt(f(this.hex,D[N],[0,0,0],"86"));P.push(Y)}catch{}return P},this.getExtAIAInfo=function(){var g=this.getExtInfo("authorityInfoAccess");if(g===void 0)return g;for(var P={ocsp:[],caissuer:[]},D=n(this.hex,g.vidx),N=0;N<D.length;N++){var Y=f(this.hex,D[N],[0],"06"),Q=f(this.hex,D[N],[1],"86");Y==="2b06010505073001"&&P.ocsp.push(jt(Q)),Y==="2b06010505073002"&&P.caissuer.push(jt(Q))}return P},this.getExtAuthorityInfoAccess=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("authorityInfoAccess");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"authorityInfoAccess",array:[]};P&&(N.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var ct=w(g,Y[Q],[0],"06"),rt=jt(f(g,Y[Q],[1],"86"));if(ct=="2b06010505073001")N.array.push({ocsp:rt});else{if(ct!="2b06010505073002")throw new Error("unknown method: "+ct);N.array.push({caissuer:rt})}}return N},this.getExtCertificatePolicies=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("certificatePolicies");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"certificatePolicies",array:[]};P&&(N.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var ct=s(g,Y[Q]),rt=this.getPolicyInformation(ct);N.array.push(rt)}return N},this.getPolicyInformation=function(g){var P={},D=f(g,0,[0],"06");P.policyoid=K(D);var N=C(g,0,[1],"30");if(N!=-1){P.array=[];for(var Y=n(g,N),Q=0;Q<Y.length;Q++){var ct=s(g,Y[Q]),rt=this.getPolicyQualifierInfo(ct);P.array.push(rt)}}return P},this.getPolicyQualifierInfo=function(g){var P={},D=f(g,0,[0],"06");if(D==="2b06010505070201"){var N=w(g,0,[1],"16");P.cps=re(N)}else if(D==="2b06010505070202"){var Y=m(g,0,[1],"30");P.unotice=this.getUserNotice(Y)}return P},this.getUserNotice=function(g){for(var P={},D=n(g,0),N=0;N<D.length;N++){var Y=s(g,D[N]);Y.substr(0,2)!="30"&&(P.exptext=this.getDisplayText(Y))}return P},this.getDisplayText=function(g){var P={};return P.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[g.substr(0,2)],P.str=re(i(g,0)),P},this.getExtCRLNumber=function(g,P){var D={extname:"cRLNumber"};if(P&&(D.critical=!0),g.substr(0,2)=="02")return D.num={hex:i(g,0)},D;throw new Error("hExtV parse error: "+g)},this.getExtCRLReason=function(g,P){var D={extname:"cRLReason"};if(P&&(D.critical=!0),g.substr(0,2)=="0a")return D.code=parseInt(i(g,0),16),D;throw new Error("hExtV parse error: "+g)},this.getExtOcspNonce=function(g,P){var D={extname:"ocspNonce"};P&&(D.critical=!0);var N=i(g,0);return D.hex=N,D},this.getExtOcspNoCheck=function(g,P){var D={extname:"ocspNoCheck"};return P&&(D.critical=!0),D},this.getExtAdobeTimeStamp=function(g,P){if(g===void 0&&P===void 0){var D=this.getExtInfo("adobeTimeStamp");if(D===void 0)return;g=s(this.hex,D.vidx),P=D.critical}var N={extname:"adobeTimeStamp"};P&&(N.critical=!0);var Y=n(g,0);if(Y.length>1){var Q=s(g,Y[1]),ct=this.getGeneralName(Q);ct.uri!=null&&(N.uri=ct.uri)}if(Y.length>2){var rt=s(g,Y[2]);rt=="0101ff"&&(N.reqauth=!0),rt=="010100"&&(N.reqauth=!1)}return N},this.getX500NameRule=function(g){for(var P=null,D=[],N=0;N<g.length;N++)for(var Y=g[N],Q=0;Q<Y.length;Q++)D.push(Y[Q]);for(N=0;N<D.length;N++){var ct=D[N],rt=ct.ds,gt=ct.value,ot=ct.type;if(rt!="prn"&&rt!="utf8"&&rt!="ia5")return"mixed";if(rt=="ia5"){if(ot!="CN")return"mixed";if(y.lang.String.isMail(gt))continue;return"mixed"}if(ot=="C"){if(rt=="prn")continue;return"mixed"}if(P==null)P=rt;else if(P!==rt)return"mixed"}return P==null?"prn":P},this.getX500Name=function(g){var P=this.getX500NameArray(g);return{array:P,str:this.dnarraytostr(P)}},this.getX500NameArray=function(g){for(var P=[],D=n(g,0),N=0;N<D.length;N++)P.push(this.getRDN(s(g,D[N])));return P},this.getRDN=function(g){for(var P=[],D=n(g,0),N=0;N<D.length;N++)P.push(this.getAttrTypeAndValue(s(g,D[N])));return P},this.getAttrTypeAndValue=function(g){var P={type:null,value:null,ds:null},D=n(g,0),N=f(g,D[0],[],"06"),Y=f(g,D[1],[]),Q=y.asn1.ASN1Util.oidHexToInt(N);return P.type=y.asn1.x509.OID.oid2atype(Q),P.value=re(Y),P.ds=this.HEX2STAG[g.substr(D[1],2)],P},this.readCertPEM=function(g){this.readCertHex(X(g))},this.readCertHex=function(g){this.hex=g,this.getVersion();try{E(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var g={};return g.version=this.getVersion(),g.serial={hex:this.getSerialNumberHex()},g.sigalg=this.getSignatureAlgorithmField(),g.issuer=this.getIssuer(),g.notbefore=this.getNotBefore(),g.notafter=this.getNotAfter(),g.subject=this.getSubject(),g.sbjpubkey=Zt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(g.ext=this.getExtParamArray()),g.sighex=this.getSignatureValueHex(),g},this.getExtParamArray=function(g){g==null&&C(this.hex,0,[0,"[3]"])!=-1&&(g=S(this.hex,0,[0,"[3]",0],"30"));for(var P=[],D=n(g,0),N=0;N<D.length;N++){var Y=s(g,D[N]),Q=this.getExtParam(Y);Q!=null&&P.push(Q)}return P},this.getExtParam=function(g){var P=n(g,0).length;if(P!=2&&P!=3)throw new Error("wrong number elements in Extension: "+P+" "+g);var D=z(f(g,0,[0],"06")),N=!1;P==3&&m(g,0,[1])=="0101ff"&&(N=!0);var Y=m(g,0,[P-1,0]),Q=void 0;if(D=="2.5.29.14"?Q=this.getExtSubjectKeyIdentifier(Y,N):D=="2.5.29.15"?Q=this.getExtKeyUsage(Y,N):D=="2.5.29.17"?Q=this.getExtSubjectAltName(Y,N):D=="2.5.29.18"?Q=this.getExtIssuerAltName(Y,N):D=="2.5.29.19"?Q=this.getExtBasicConstraints(Y,N):D=="2.5.29.31"?Q=this.getExtCRLDistributionPoints(Y,N):D=="2.5.29.32"?Q=this.getExtCertificatePolicies(Y,N):D=="2.5.29.35"?Q=this.getExtAuthorityKeyIdentifier(Y,N):D=="2.5.29.37"?Q=this.getExtExtKeyUsage(Y,N):D=="1.3.6.1.5.5.7.1.1"?Q=this.getExtAuthorityInfoAccess(Y,N):D=="2.5.29.20"?Q=this.getExtCRLNumber(Y,N):D=="2.5.29.21"?Q=this.getExtCRLReason(Y,N):D=="1.3.6.1.5.5.7.48.1.2"?Q=this.getExtOcspNonce(Y,N):D=="1.3.6.1.5.5.7.48.1.5"?Q=this.getExtOcspNoCheck(Y,N):D=="1.2.840.113583.1.1.9.1"&&(Q=this.getExtAdobeTimeStamp(Y,N)),Q!=null)return Q;var ct={extname:D,extn:Y};return N&&(ct.critical=!0),ct},this.findExt=function(g,P){for(var D=0;D<g.length;D++)if(g[D].extname==P)return g[D];return null},this.updateExtCDPFullURI=function(g,P){var D=this.findExt(g,"cRLDistributionPoints");if(D!=null&&D.array!=null){for(var N=D.array,Y=0;Y<N.length;Y++)if(N[Y].dpname!=null&&N[Y].dpname.full!=null)for(var Q=N[Y].dpname.full,ct=0;ct<Q.length;ct++){var rt=Q[Y];rt.uri!=null&&(rt.uri=P)}}},this.updateExtAIAOCSP=function(g,P){var D=this.findExt(g,"authorityInfoAccess");if(D!=null&&D.array!=null)for(var N=D.array,Y=0;Y<N.length;Y++)N[Y].ocsp!=null&&(N[Y].ocsp=P)},this.updateExtAIACAIssuer=function(g,P){var D=this.findExt(g,"authorityInfoAccess");if(D!=null&&D.array!=null)for(var N=D.array,Y=0;Y<N.length;Y++)N[Y].caissuer!=null&&(N[Y].caissuer=P)},this.dnarraytostr=function(g){return"/"+g.map(function(P){return function(N){return N.map(function(Y){return function(ct){return ct.type+"="+ct.value}(Y)}).join("+")}(P)}).join("/")},this.getInfo=function(){var g,P,D,N=function($t){return JSON.stringify($t.array).replace(/[\[\]\{\}\"]/g,"")},Y=function($t){for(var Kt="",Wt=$t.array,Rt=0;Rt<Wt.length;Rt++){var Lt=Wt[Rt];if(Kt+="    policy oid: "+Lt.policyoid+`
`,Lt.array!==void 0)for(var Mt=0;Mt<Lt.array.length;Mt++){var zt=Lt.array[Mt];zt.cps!==void 0&&(Kt+="    cps: "+zt.cps+`
`)}}return Kt},Q=function($t){for(var Kt="",Wt=$t.array,Rt=0;Rt<Wt.length;Rt++){var Lt=Wt[Rt];try{Lt.dpname.full[0].uri!==void 0&&(Kt+="    "+Lt.dpname.full[0].uri+`
`)}catch{}try{Lt.dname.full[0].dn.hex!==void 0&&(Kt+="    "+Dt.hex2dn(Lt.dpname.full[0].dn.hex)+`
`)}catch{}}return Kt},ct=function($t){for(var Kt="",Wt=$t.array,Rt=0;Rt<Wt.length;Rt++){var Lt=Wt[Rt];Lt.caissuer!==void 0&&(Kt+="    caissuer: "+Lt.caissuer+`
`),Lt.ocsp!==void 0&&(Kt+="    ocsp: "+Lt.ocsp+`
`)}return Kt};if(g=`Basic Fields
`,g+="  serial number: "+this.getSerialNumberHex()+`
`,g+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,g+="  issuer: "+this.getIssuerString()+`
`,g+="  notBefore: "+this.getNotBefore()+`
`,g+="  notAfter: "+this.getNotAfter()+`
`,g+="  subject: "+this.getSubjectString()+`
`,g+=`  subject public key info: 
`,g+="    key algorithm: "+(P=this.getPublicKey()).type+`
`,P.type==="RSA"&&(g+="    n="+He(P.n.toString(16)).substr(0,16)+`...
`,g+="    e="+He(P.e.toString(16))+`
`),(D=this.aExtInfo)!=null){g+=`X509v3 Extensions:
`;for(var rt=0;rt<D.length;rt++){var gt=D[rt],ot=y.asn1.x509.OID.oid2name(gt.oid);ot===""&&(ot=gt.oid);var ht="";if(gt.critical===!0&&(ht="CRITICAL"),g+="  "+ot+" "+ht+`:
`,ot==="basicConstraints"){var wt=this.getExtBasicConstraints();wt.cA===void 0?g+=`    {}
`:(g+="    cA=true",wt.pathLen!==void 0&&(g+=", pathLen="+wt.pathLen),g+=`
`)}else if(ot==="keyUsage")g+="    "+this.getExtKeyUsageString()+`
`;else if(ot==="subjectKeyIdentifier")g+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ot==="authorityKeyIdentifier"){var xt=this.getExtAuthorityKeyIdentifier();xt.kid!==void 0&&(g+="    kid="+xt.kid.hex+`
`)}else ot==="extKeyUsage"?g+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ot==="subjectAltName"?g+="    "+N(this.getExtSubjectAltName())+`
`:ot==="cRLDistributionPoints"?g+=Q(this.getExtCRLDistributionPoints()):ot==="authorityInfoAccess"?g+=ct(this.getExtAuthorityInfoAccess()):ot==="certificatePolicies"&&(g+=Y(this.getExtCertificatePolicies()))}}return g+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,g+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof e=="string"&&(e.indexOf("-----BEGIN")!=-1?this.readCertPEM(e):y.lang.String.isHex(e)&&this.readCertHex(e))}lt.prototype.sign=function(e,t){var r=function(i){return y.crypto.Util.hashString(i,t)}(e);return this.signWithMessageHash(r,t)},lt.prototype.signWithMessageHash=function(e,t){var r=Qt(y.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return ar(this.doPrivate(r).toString(16),this.n.bitLength())},lt.prototype.signPSS=function(e,t,r){var n=function(s){return y.crypto.Util.hashHex(s,t)}(ce(e));return r===void 0&&(r=-1),this.signWithMessageHashPSS(n,t,r)},lt.prototype.signWithMessageHashPSS=function(e,t,r){var n,i=re(e),s=i.length,f=this.n.bitLength()-1,w=Math.ceil(f/8),m=function(g){return y.crypto.Util.hashHex(g,t)};if(r===-1||r===void 0)r=s;else if(r===-2)r=w-s-2;else if(r<-2)throw new Error("invalid salt length");if(w<s+r+2)throw new Error("data too long");var S="";r>0&&(S=new Array(r),new Vt().nextBytes(S),S=String.fromCharCode.apply(String,S));var E=re(m(ce("\0\0\0\0\0\0\0\0"+i+S))),C=[];for(n=0;n<w-r-s-2;n+=1)C[n]=0;var L=String.fromCharCode.apply(String,C)+""+S,K=ur(E,L.length,m),z=[];for(n=0;n<L.length;n+=1)z[n]=L.charCodeAt(n)^K.charCodeAt(n);var G=65280>>8*w-f&255;for(z[0]&=~G,n=0;n<s;n++)z.push(E.charCodeAt(n));return z.push(188),ar(this.doPrivate(new H(z)).toString(16),this.n.bitLength())},lt.prototype.verify=function(e,t){var r=Qt(t=(t=t.replace(pr,"")).replace(/[ \n]+/g,""),16);if(r.bitLength()>this.n.bitLength())return 0;var n=cr(this.doPublic(r).toString(16).replace(/^1f+00/,""));if(n.length==0)return!1;var i=n[0];return n[1]==function(f){return y.crypto.Util.hashString(f,i)}(e)},lt.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var r=Qt(t,16);if(r.bitLength()>this.n.bitLength())return 0;var n=cr(this.doPublic(r).toString(16).replace(/^1f+00/,""));return n.length==0?!1:(n[0],n[1]==e)},lt.prototype.verifyPSS=function(e,t,r,n){var i=function(f){return y.crypto.Util.hashHex(f,r)}(ce(e));return n===void 0&&(n=-1),this.verifyWithMessageHashPSS(i,t,r,n)},lt.prototype.verifyWithMessageHashPSS=function(e,t,r,n){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var i,s=new H(t,16),f=function(D){return y.crypto.Util.hashHex(D,r)},w=re(e),m=w.length,S=this.n.bitLength()-1,E=Math.ceil(S/8);if(n===-1||n===void 0)n=m;else if(n===-2)n=E-m-2;else if(n<-2)throw new Error("invalid salt length");if(E<m+n+2)throw new Error("data too long");var C=this.doPublic(s).toByteArray();for(i=0;i<C.length;i+=1)C[i]&=255;for(;C.length<E;)C.unshift(0);if(C[E-1]!==188)throw new Error("encoded message does not end in 0xbc");var L=(C=String.fromCharCode.apply(String,C)).substr(0,E-m-1),K=C.substr(L.length,m),z=65280>>8*E-S&255;if((L.charCodeAt(0)&z)!=0)throw new Error("bits beyond keysize not zero");var G=ur(K,L.length,f),X=[];for(i=0;i<L.length;i+=1)X[i]=L.charCodeAt(i)^G.charCodeAt(i);X[0]&=~z;var g=E-m-n-2;for(i=0;i<g;i+=1)if(X[i]!==0)throw new Error("leftmost octets not zero");if(X[g]!==1)throw new Error("0x01 marker not found");return K===re(f(ce("\0\0\0\0\0\0\0\0"+w+String.fromCharCode.apply(String,X.slice(-n)))))},lt.SALT_LEN_HLEN=-1,lt.SALT_LEN_MAX=-2,lt.SALT_LEN_RECOVER=-2,Dt.hex2dn=function(e,t){if(t===void 0&&(t=0),e.substr(t,2)!=="30")throw new Error("malformed DN");for(var r=new Array,n=it.getChildIdx(e,t),i=0;i<n.length;i++)r.push(Dt.hex2rdn(e,n[i]));return"/"+(r=r.map(function(s){return s.replace("/","\\/")})).join("/")},Dt.hex2rdn=function(e,t){if(t===void 0&&(t=0),e.substr(t,2)!=="31")throw new Error("malformed RDN");for(var r=new Array,n=it.getChildIdx(e,t),i=0;i<n.length;i++)r.push(Dt.hex2attrTypeValue(e,n[i]));return(r=r.map(function(s){return s.replace("+","\\+")})).join("+")},Dt.hex2attrTypeValue=function(e,t){var r=it,n=r.getV;if(t===void 0&&(t=0),e.substr(t,2)!=="30")throw new Error("malformed attribute type and value");var i=r.getChildIdx(e,t);i.length!==2||e.substr(i[0],2);var s=n(e,i[0]),f=y.asn1.ASN1Util.oidHexToInt(s);return y.asn1.x509.OID.oid2atype(f)+"="+re(n(e,i[1]))},Dt.getPublicKeyFromCertHex=function(e){var t=new Dt;return t.readCertHex(e),t.getPublicKey()},Dt.getPublicKeyFromCertPEM=function(e){var t=new Dt;return t.readCertPEM(e),t.getPublicKey()},Dt.getPublicKeyInfoPropOfCertPEM=function(e){var t,r,n=it.getVbyList,i={};return i.algparam=null,(t=new Dt).readCertPEM(e),r=t.getPublicKeyHex(),i.keyhex=n(r,0,[1],"03").substr(2),i.algoid=n(r,0,[0,0],"06"),i.algoid==="2a8648ce3d0201"&&(i.algparam=n(r,0,[0,1],"06")),i},Dt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],y!==void 0&&y||(v.KJUR=y={}),y.jws!==void 0&&y.jws||(y.jws={}),y.jws.JWS=function(){var e=y.jws.JWS.isSafeJSONString;this.parseJWS=function(t,r){if(this.parsedJWS===void 0||!r&&this.parsedJWS.sigvalH===void 0){var n=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(n==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var i=n[1],s=n[2],f=n[3],w=i+"."+s;if(this.parsedJWS={},this.parsedJWS.headB64U=i,this.parsedJWS.payloadB64U=s,this.parsedJWS.sigvalB64U=f,this.parsedJWS.si=w,!r){var m=Ft(f),S=Qt(m,16);this.parsedJWS.sigvalH=m,this.parsedJWS.sigvalBI=S}var E=se(i),C=se(s);if(this.parsedJWS.headS=E,this.parsedJWS.payloadS=C,!e(E,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+E}}},y.jws.JWS.sign=function(e,t,r,n,i){var s,f,w,m=y,S=m.jws.JWS,E=S.readSafeJSONString,C=S.isSafeJSONString,L=m.crypto,K=(L.ECDSA,L.Mac),z=L.Signature,G=JSON;if(typeof t!="string"&&(t===void 0?"undefined":l(t))!="object")throw"spHeader must be JSON string or object: "+t;if((t===void 0?"undefined":l(t))=="object"&&(f=t,s=G.stringify(f)),typeof t=="string"){if(!C(s=t))throw"JWS Head is not safe JSON string: "+s;f=E(s)}if(w=r,(r===void 0?"undefined":l(r))=="object"&&(w=G.stringify(r)),e!=""&&e!=null||f.alg===void 0||(e=f.alg),e!=""&&e!=null&&f.alg===void 0&&(f.alg=e,s=G.stringify(f)),e!==f.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+f.alg;var X=null;if(S.jwsalg2sigalg[e]===void 0)throw"unsupported alg name: "+e;X=S.jwsalg2sigalg[e];var g=Fe(s)+"."+Fe(w),P="";if(X.substr(0,4)=="Hmac"){if(n===void 0)throw"mac key shall be specified for HS* alg";var D=new K({alg:X,prov:"cryptojs",pass:n});D.updateString(g),P=D.doFinal()}else if(X.indexOf("withECDSA")!=-1){(Y=new z({alg:X})).init(n,i),Y.updateString(g);var N=Y.sign();P=y.crypto.ECDSA.asn1SigToConcatSig(N)}else{var Y;X!="none"&&((Y=new z({alg:X})).init(n,i),Y.updateString(g),P=Y.sign())}return g+"."+Ut(P)},y.jws.JWS.verify=function(e,t,r){var n,i=y,s=i.jws.JWS,f=s.readSafeJSONString,w=i.crypto,m=w.ECDSA,S=w.Mac,E=w.Signature;l(lt)!==void 0&&(n=lt);var C=e.split(".");if(C.length!==3)return!1;var L=C[0]+"."+C[1],K=Ft(C[2]),z=f(se(C[0])),G=null,X=null;if(z.alg===void 0)throw"algorithm not specified in header";if(X=(G=z.alg).substr(0,2),r!=null&&Object.prototype.toString.call(r)==="[object Array]"&&r.length>0&&(":"+r.join(":")+":").indexOf(":"+G+":")==-1)throw"algorithm '"+G+"' not accepted in the list";if(G!="none"&&t===null)throw"key shall be specified to verify.";if(typeof t=="string"&&t.indexOf("-----BEGIN ")!=-1&&(t=Ot.getKey(t)),!(X!="RS"&&X!="PS"||t instanceof n))throw"key shall be a RSAKey obj for RS* and PS* algs";if(X=="ES"&&!(t instanceof m))throw"key shall be a ECDSA obj for ES* algs";var g=null;if(s.jwsalg2sigalg[z.alg]===void 0)throw"unsupported alg name: "+G;if((g=s.jwsalg2sigalg[G])=="none")throw"not supported";if(g.substr(0,4)=="Hmac"){if(t===void 0)throw"hexadecimal key shall be specified for HMAC";var P=new S({alg:g,pass:t});return P.updateString(L),K==P.doFinal()}if(g.indexOf("withECDSA")!=-1){var D,N=null;try{N=m.concatSigToASN1Sig(K)}catch{return!1}return(D=new E({alg:g})).init(t),D.updateString(L),D.verify(N)}return(D=new E({alg:g})).init(t),D.updateString(L),D.verify(K)},y.jws.JWS.parse=function(e){var t,r,n,i=e.split("."),s={};if(i.length!=2&&i.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return t=i[0],r=i[1],i.length==3&&(n=i[2]),s.headerObj=y.jws.JWS.readSafeJSONString(se(t)),s.payloadObj=y.jws.JWS.readSafeJSONString(se(r)),s.headerPP=JSON.stringify(s.headerObj,null,"  "),s.payloadObj==null?s.payloadPP=se(r):s.payloadPP=JSON.stringify(s.payloadObj,null,"  "),n!==void 0&&(s.sigHex=Ft(n)),s},y.jws.JWS.verifyJWT=function(e,t,r){var n=y.jws,i=n.JWS,s=i.readSafeJSONString,f=i.inArray,w=i.includedArray,m=e.split("."),S=m[0],E=m[1],C=(Ft(m[2]),s(se(S))),L=s(se(E));if(C.alg===void 0)return!1;if(r.alg===void 0)throw"acceptField.alg shall be specified";if(!f(C.alg,r.alg)||L.iss!==void 0&&l(r.iss)==="object"&&!f(L.iss,r.iss)||L.sub!==void 0&&l(r.sub)==="object"&&!f(L.sub,r.sub))return!1;if(L.aud!==void 0&&l(r.aud)==="object"){if(typeof L.aud=="string"){if(!f(L.aud,r.aud))return!1}else if(l(L.aud)=="object"&&!w(L.aud,r.aud))return!1}var K=n.IntDate.getNow();return r.verifyAt!==void 0&&typeof r.verifyAt=="number"&&(K=r.verifyAt),r.gracePeriod!==void 0&&typeof r.gracePeriod=="number"||(r.gracePeriod=0),!(L.exp!==void 0&&typeof L.exp=="number"&&L.exp+r.gracePeriod<K)&&!(L.nbf!==void 0&&typeof L.nbf=="number"&&K<L.nbf-r.gracePeriod)&&!(L.iat!==void 0&&typeof L.iat=="number"&&K<L.iat-r.gracePeriod)&&(L.jti===void 0||r.jti===void 0||L.jti===r.jti)&&!!i.verify(e,t,r.alg)},y.jws.JWS.includedArray=function(e,t){var r=y.jws.JWS.inArray;if(e===null||(e===void 0?"undefined":l(e))!=="object"||typeof e.length!="number")return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t))return!1;return!0},y.jws.JWS.inArray=function(e,t){if(t===null||(t===void 0?"undefined":l(t))!=="object"||typeof t.length!="number")return!1;for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},y.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},y.jws.JWS.isSafeJSONString=function(e,t,r){var n=null;try{return((n=Xe(e))===void 0?"undefined":l(n))!="object"||n.constructor===Array?0:(t&&(t[r]=n),1)}catch{return 0}},y.jws.JWS.readSafeJSONString=function(e){var t=null;try{return((t=Xe(e))===void 0?"undefined":l(t))!="object"||t.constructor===Array?null:t}catch{return null}},y.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(t==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},y.jws.JWS.getJWKthumbprint=function(e){if(e.kty!=="RSA"&&e.kty!=="EC"&&e.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var t="{";if(e.kty==="RSA"){if(typeof e.n!="string"||typeof e.e!="string")throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if(e.kty==="EC"){if(typeof e.crv!="string"||typeof e.x!="string"||typeof e.y!="string")throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if(e.kty==="oct"){if(typeof e.k!="string")throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var r=ce(t);return Ut(y.crypto.Util.hashHex(r,"sha256"))},y.jws.IntDate={},y.jws.IntDate.get=function(e){var t=y.jws.IntDate,r=t.getNow,n=t.getZulu;if(e=="now")return r();if(e=="now + 1hour")return r()+3600;if(e=="now + 1day")return r()+86400;if(e=="now + 1month")return r()+2592e3;if(e=="now + 1year")return r()+31536e3;if(e.match(/Z$/))return n(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},y.jws.IntDate.getZulu=function(e){return rr(e)},y.jws.IntDate.getNow=function(){return~~(new Date/1e3)},y.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},y.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},v.SecureRandom=Vt,v.rng_seed_time=$,v.BigInteger=H,v.RSAKey=lt;var vr=y.crypto.EDSA;v.EDSA=vr;var yr=y.crypto.DSA;v.DSA=yr;var mr=y.crypto.Signature;v.Signature=mr;var _r=y.crypto.MessageDigest;v.MessageDigest=_r;var Sr=y.crypto.Mac;v.Mac=Sr;var br=y.crypto.Cipher;v.Cipher=br,v.KEYUTIL=Ot,v.ASN1HEX=it,v.X509=Dt,v.CryptoJS=d,v.b64tohex=tt,v.b64toBA=nt,v.stoBA=Qe,v.BAtos=Ze,v.BAtohex=Re,v.stohex=fe,v.stob64=function(t){return Z(fe(t))},v.stob64u=function(t){return Ie(Z(fe(t)))},v.b64utos=function(t){return Ze(nt(Ee(t)))},v.b64tob64u=Ie,v.b64utob64=Ee,v.hex2b64=Z,v.hextob64u=Ut,v.b64utohex=Ft,v.utf8tob64u=Fe,v.b64utoutf8=se,v.utf8tob64=function(t){return Z(Oe(Ue(t)))},v.b64toutf8=function(t){return decodeURIComponent(De(tt(t)))},v.utf8tohex=Be,v.hextoutf8=jt,v.hextorstr=re,v.rstrtohex=ce,v.hextob64=$e,v.hextob64nl=tr,v.b64nltohex=er,v.hextopem=Zt,v.pemtohex=he,v.hextoArrayBuffer=function(t){if(t.length%2!=0)throw"input is not even length";if(t.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var r=new ArrayBuffer(t.length/2),n=new DataView(r),i=0;i<t.length/2;i++)n.setUint8(i,parseInt(t.substr(2*i,2),16));return r},v.ArrayBuffertohex=function(t){for(var r="",n=new DataView(t),i=0;i<t.byteLength;i++)r+=("00"+n.getUint8(i).toString(16)).slice(-2);return r},v.zulutomsec=je,v.zulutosec=rr,v.zulutodate=function(t){return new Date(je(t))},v.datetozulu=function(t,r,n){var i,s=t.getUTCFullYear();if(r){if(s<1950||2049<s)throw"not proper year for UTCTime: "+s;i=(""+s).slice(-2)}else i=("000"+s).slice(-4);if(i+=("0"+(t.getUTCMonth()+1)).slice(-2),i+=("0"+t.getUTCDate()).slice(-2),i+=("0"+t.getUTCHours()).slice(-2),i+=("0"+t.getUTCMinutes()).slice(-2),i+=("0"+t.getUTCSeconds()).slice(-2),n){var f=t.getUTCMilliseconds();f!==0&&(i+="."+(f=(f=("00"+f).slice(-3)).replace(/0+$/g,"")))}return i+="Z"},v.uricmptohex=Oe,v.hextouricmp=De,v.ipv6tohex=nr,v.hextoipv6=ir,v.hextoip=Me,v.iptohex=function(t){var r="malformed IP address";if(!(t=t.toLowerCase(t)).match(/^[0-9.]+$/)){if(t.match(/^[0-9a-f:]+$/)&&t.indexOf(":")!==-1)return nr(t);throw r}var n=t.split(".");if(n.length!==4)throw r;var i="";try{for(var s=0;s<4;s++)i+=("0"+parseInt(n[s]).toString(16)).slice(-2);return i}catch{throw r}},v.encodeURIComponentAll=Ue,v.newline_toUnix=function(t){return t=t.replace(/\r\n/gm,`
`)},v.newline_toDos=function(t){return t=(t=t.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},v.hextoposhex=He,v.intarystrtohex=function(t){t=(t=(t=t.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return t.split(/,/).map(function(r,n,i){var s=parseInt(r);if(s<0||255<s)throw"integer not in range 0-255";return("00"+s.toString(16)).slice(-2)}).join("")}catch(r){throw"malformed integer array string: "+r}},v.strdiffidx=function(t,r){var n=t.length;t.length>r.length&&(n=r.length);for(var i=0;i<n;i++)if(t.charCodeAt(i)!=r.charCodeAt(i))return i;return t.length!=r.length?n:-1},v.KJUR=y;var wr=y.crypto;v.crypto=wr;var Fr=y.asn1;v.asn1=Fr;var Er=y.jws;v.jws=Er;var xr=y.lang;v.lang=xr}).call(this,F(28).Buffer)},function(et,v,F){(function(T){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var l=F(30),U=F(31),_=F(32);function a(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(j,c){if(a()<c)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(j=new Uint8Array(c)).__proto__=o.prototype:(j===null&&(j=new o(c)),j.length=c),j}function o(j,c,h){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(j,c,h);if(typeof j=="number"){if(typeof c=="string")throw new Error("If encoding is specified then the first argument must be a string");return x(this,j)}return p(this,j,c,h)}function p(j,c,h,B){if(typeof c=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer!="undefined"&&c instanceof ArrayBuffer?function(W,$,ut,ft){if($.byteLength,ut<0||$.byteLength<ut)throw new RangeError("'offset' is out of bounds");if($.byteLength<ut+(ft||0))throw new RangeError("'length' is out of bounds");return $=ut===void 0&&ft===void 0?new Uint8Array($):ft===void 0?new Uint8Array($,ut):new Uint8Array($,ut,ft),o.TYPED_ARRAY_SUPPORT?(W=$).__proto__=o.prototype:W=V(W,$),W}(j,c,h,B):typeof c=="string"?function(W,$,ut){if(typeof ut=="string"&&ut!==""||(ut="utf8"),!o.isEncoding(ut))throw new TypeError('"encoding" must be a valid string encoding');var ft=0|A($,ut),St=(W=u(W,ft)).write($,ut);return St!==ft&&(W=W.slice(0,St)),W}(j,c,h):function(W,$){if(o.isBuffer($)){var ut=0|O($.length);return(W=u(W,ut)).length===0||$.copy(W,0,0,ut),W}if($){if(typeof ArrayBuffer!="undefined"&&$.buffer instanceof ArrayBuffer||"length"in $)return typeof $.length!="number"||function(St){return St!=St}($.length)?u(W,0):V(W,$);if($.type==="Buffer"&&_($.data))return V(W,$.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(j,c)}function I(j){if(typeof j!="number")throw new TypeError('"size" argument must be a number');if(j<0)throw new RangeError('"size" argument must not be negative')}function x(j,c){if(I(c),j=u(j,c<0?0:0|O(c)),!o.TYPED_ARRAY_SUPPORT)for(var h=0;h<c;++h)j[h]=0;return j}function V(j,c){var h=c.length<0?0:0|O(c.length);j=u(j,h);for(var B=0;B<h;B+=1)j[B]=255&c[B];return j}function O(j){if(j>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|j}function A(j,c){if(o.isBuffer(j))return j.length;if(typeof ArrayBuffer!="undefined"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(j)||j instanceof ArrayBuffer))return j.byteLength;typeof j!="string"&&(j=""+j);var h=j.length;if(h===0)return 0;for(var B=!1;;)switch(c){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":case void 0:return Bt(j).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*h;case"hex":return h>>>1;case"base64":return Xt(j).length;default:if(B)return Bt(j).length;c=(""+c).toLowerCase(),B=!0}}function k(j,c,h){var B=!1;if((c===void 0||c<0)&&(c=0),c>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0)<=(c>>>=0))return"";for(j||(j="utf8");;)switch(j){case"hex":return te(this,c,h);case"utf8":case"utf-8":return _t(this,c,h);case"ascii":return Ht(this,c,h);case"latin1":case"binary":return At(this,c,h);case"base64":return at(this,c,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return It(this,c,h);default:if(B)throw new TypeError("Unknown encoding: "+j);j=(j+"").toLowerCase(),B=!0}}function M(j,c,h){var B=j[c];j[c]=j[h],j[h]=B}function q(j,c,h,B,J){if(j.length===0)return-1;if(typeof h=="string"?(B=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,isNaN(h)&&(h=J?0:j.length-1),h<0&&(h=j.length+h),h>=j.length){if(J)return-1;h=j.length-1}else if(h<0){if(!J)return-1;h=0}if(typeof c=="string"&&(c=o.from(c,B)),o.isBuffer(c))return c.length===0?-1:d(j,c,h,B,J);if(typeof c=="number")return c&=255,o.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?J?Uint8Array.prototype.indexOf.call(j,c,h):Uint8Array.prototype.lastIndexOf.call(j,c,h):d(j,[c],h,B,J);throw new TypeError("val must be string, number or Buffer")}function d(j,c,h,B,J){var W,$=1,ut=j.length,ft=c.length;if(B!==void 0&&((B=String(B).toLowerCase())==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(j.length<2||c.length<2)return-1;$=2,ut/=2,ft/=2,h/=2}function St(Qt,oe){return $===1?Qt[oe]:Qt.readUInt16BE(oe*$)}if(J){var vt=-1;for(W=h;W<ut;W++)if(St(j,W)===St(c,vt===-1?0:W-vt)){if(vt===-1&&(vt=W),W-vt+1===ft)return vt*$}else vt!==-1&&(W-=W-vt),vt=-1}else for(h+ft>ut&&(h=ut-ft),W=h;W>=0;W--){for(var Tt=!0,Vt=0;Vt<ft;Vt++)if(St(j,W+Vt)!==St(c,Vt)){Tt=!1;break}if(Tt)return W}return-1}function b(j,c,h,B){h=Number(h)||0;var J=j.length-h;B?(B=Number(B))>J&&(B=J):B=J;var W=c.length;if(W%2!=0)throw new TypeError("Invalid hex string");B>W/2&&(B=W/2);for(var $=0;$<B;++$){var ut=parseInt(c.substr(2*$,2),16);if(isNaN(ut))return $;j[h+$]=ut}return $}function R(j,c,h,B){return Jt(Bt(c,j.length-h),j,h,B)}function Z(j,c,h,B){return Jt(function(W){for(var $=[],ut=0;ut<W.length;++ut)$.push(255&W.charCodeAt(ut));return $}(c),j,h,B)}function tt(j,c,h,B){return Z(j,c,h,B)}function nt(j,c,h,B){return Jt(Xt(c),j,h,B)}function H(j,c,h,B){return Jt(function(W,$){for(var ut,ft,St,vt=[],Tt=0;Tt<W.length&&!(($-=2)<0);++Tt)ft=(ut=W.charCodeAt(Tt))>>8,St=ut%256,vt.push(St),vt.push(ft);return vt}(c,j.length-h),j,h,B)}function at(j,c,h){return c===0&&h===j.length?l.fromByteArray(j):l.fromByteArray(j.slice(c,h))}function _t(j,c,h){h=Math.min(j.length,h);for(var B=[],J=c;J<h;){var W,$,ut,ft,St=j[J],vt=null,Tt=St>239?4:St>223?3:St>191?2:1;if(J+Tt<=h)switch(Tt){case 1:St<128&&(vt=St);break;case 2:(192&(W=j[J+1]))==128&&(ft=(31&St)<<6|63&W)>127&&(vt=ft);break;case 3:W=j[J+1],$=j[J+2],(192&W)==128&&(192&$)==128&&(ft=(15&St)<<12|(63&W)<<6|63&$)>2047&&(ft<55296||ft>57343)&&(vt=ft);break;case 4:W=j[J+1],$=j[J+2],ut=j[J+3],(192&W)==128&&(192&$)==128&&(192&ut)==128&&(ft=(15&St)<<18|(63&W)<<12|(63&$)<<6|63&ut)>65535&&ft<1114112&&(vt=ft)}vt===null?(vt=65533,Tt=1):vt>65535&&(vt-=65536,B.push(vt>>>10&1023|55296),vt=56320|1023&vt),B.push(vt),J+=Tt}return function(Qt){var oe=Qt.length;if(oe<=bt)return String.fromCharCode.apply(String,Qt);for(var lt="",Ct=0;Ct<oe;)lt+=String.fromCharCode.apply(String,Qt.slice(Ct,Ct+=bt));return lt}(B)}v.Buffer=o,v.SlowBuffer=function(c){return+c!=c&&(c=0),o.alloc(+c)},v.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=T.TYPED_ARRAY_SUPPORT!==void 0?T.TYPED_ARRAY_SUPPORT:function(){try{var c=new Uint8Array(1);return c.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},c.foo()===42&&typeof c.subarray=="function"&&c.subarray(1,1).byteLength===0}catch{return!1}}(),v.kMaxLength=a(),o.poolSize=8192,o._augment=function(j){return j.__proto__=o.prototype,j},o.from=function(j,c,h){return p(null,j,c,h)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,typeof Symbol!="undefined"&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(j,c,h){return function(J,W,$,ut){return I(W),W<=0?u(J,W):$!==void 0?typeof ut=="string"?u(J,W).fill($,ut):u(J,W).fill($):u(J,W)}(null,j,c,h)},o.allocUnsafe=function(j){return x(null,j)},o.allocUnsafeSlow=function(j){return x(null,j)},o.isBuffer=function(c){return!(c==null||!c._isBuffer)},o.compare=function(c,h){if(!o.isBuffer(c)||!o.isBuffer(h))throw new TypeError("Arguments must be Buffers");if(c===h)return 0;for(var B=c.length,J=h.length,W=0,$=Math.min(B,J);W<$;++W)if(c[W]!==h[W]){B=c[W],J=h[W];break}return B<J?-1:J<B?1:0},o.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(c,h){if(!_(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return o.alloc(0);var B;if(h===void 0)for(h=0,B=0;B<c.length;++B)h+=c[B].length;var J=o.allocUnsafe(h),W=0;for(B=0;B<c.length;++B){var $=c[B];if(!o.isBuffer($))throw new TypeError('"list" argument must be an Array of Buffers');$.copy(J,W),W+=$.length}return J},o.byteLength=A,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var c=this.length;if(c%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var h=0;h<c;h+=2)M(this,h,h+1);return this},o.prototype.swap32=function(){var c=this.length;if(c%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var h=0;h<c;h+=4)M(this,h,h+3),M(this,h+1,h+2);return this},o.prototype.swap64=function(){var c=this.length;if(c%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var h=0;h<c;h+=8)M(this,h,h+7),M(this,h+1,h+6),M(this,h+2,h+5),M(this,h+3,h+4);return this},o.prototype.toString=function(){var c=0|this.length;return c===0?"":arguments.length===0?_t(this,0,c):k.apply(this,arguments)},o.prototype.equals=function(c){if(!o.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c||o.compare(this,c)===0},o.prototype.inspect=function(){var c="",h=v.INSPECT_MAX_BYTES;return this.length>0&&(c=this.toString("hex",0,h).match(/.{2}/g).join(" "),this.length>h&&(c+=" ... ")),"<Buffer "+c+">"},o.prototype.compare=function(c,h,B,J,W){if(!o.isBuffer(c))throw new TypeError("Argument must be a Buffer");if(h===void 0&&(h=0),B===void 0&&(B=c?c.length:0),J===void 0&&(J=0),W===void 0&&(W=this.length),h<0||B>c.length||J<0||W>this.length)throw new RangeError("out of range index");if(J>=W&&h>=B)return 0;if(J>=W)return-1;if(h>=B)return 1;if(this===c)return 0;for(var $=(W>>>=0)-(J>>>=0),ut=(B>>>=0)-(h>>>=0),ft=Math.min($,ut),St=this.slice(J,W),vt=c.slice(h,B),Tt=0;Tt<ft;++Tt)if(St[Tt]!==vt[Tt]){$=St[Tt],ut=vt[Tt];break}return $<ut?-1:ut<$?1:0},o.prototype.includes=function(c,h,B){return this.indexOf(c,h,B)!==-1},o.prototype.indexOf=function(c,h,B){return q(this,c,h,B,!0)},o.prototype.lastIndexOf=function(c,h,B){return q(this,c,h,B,!1)},o.prototype.write=function(c,h,B,J){if(h===void 0)J="utf8",B=this.length,h=0;else if(B===void 0&&typeof h=="string")J=h,B=this.length,h=0;else{if(!isFinite(h))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");h|=0,isFinite(B)?(B|=0,J===void 0&&(J="utf8")):(J=B,B=void 0)}var W=this.length-h;if((B===void 0||B>W)&&(B=W),c.length>0&&(B<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");J||(J="utf8");for(var $=!1;;)switch(J){case"hex":return b(this,c,h,B);case"utf8":case"utf-8":return R(this,c,h,B);case"ascii":return Z(this,c,h,B);case"latin1":case"binary":return tt(this,c,h,B);case"base64":return nt(this,c,h,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,c,h,B);default:if($)throw new TypeError("Unknown encoding: "+J);J=(""+J).toLowerCase(),$=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var bt=4096;function Ht(j,c,h){var B="";h=Math.min(j.length,h);for(var J=c;J<h;++J)B+=String.fromCharCode(127&j[J]);return B}function At(j,c,h){var B="";h=Math.min(j.length,h);for(var J=c;J<h;++J)B+=String.fromCharCode(j[J]);return B}function te(j,c,h){var B=j.length;(!c||c<0)&&(c=0),(!h||h<0||h>B)&&(h=B);for(var J="",W=c;W<h;++W)J+=ne(j[W]);return J}function It(j,c,h){for(var B=j.slice(c,h),J="",W=0;W<B.length;W+=2)J+=String.fromCharCode(B[W]+256*B[W+1]);return J}function dt(j,c,h){if(j%1!=0||j<0)throw new RangeError("offset is not uint");if(j+c>h)throw new RangeError("Trying to access beyond buffer length")}function pt(j,c,h,B,J,W){if(!o.isBuffer(j))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>J||c<W)throw new RangeError('"value" argument is out of bounds');if(h+B>j.length)throw new RangeError("Index out of range")}function Pt(j,c,h,B){c<0&&(c=65535+c+1);for(var J=0,W=Math.min(j.length-h,2);J<W;++J)j[h+J]=(c&255<<8*(B?J:1-J))>>>8*(B?J:1-J)}function Yt(j,c,h,B){c<0&&(c=4294967295+c+1);for(var J=0,W=Math.min(j.length-h,4);J<W;++J)j[h+J]=c>>>8*(B?J:3-J)&255}function qt(j,c,h,B,J,W){if(h+B>j.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function Gt(j,c,h,B,J){return J||qt(j,0,h,4),U.write(j,c,h,B,23,4),h+4}function ee(j,c,h,B,J){return J||qt(j,0,h,8),U.write(j,c,h,B,52,8),h+8}o.prototype.slice=function(c,h){var B,J=this.length;if((c=~~c)<0?(c+=J)<0&&(c=0):c>J&&(c=J),(h=h===void 0?J:~~h)<0?(h+=J)<0&&(h=0):h>J&&(h=J),h<c&&(h=c),o.TYPED_ARRAY_SUPPORT)(B=this.subarray(c,h)).__proto__=o.prototype;else{var W=h-c;B=new o(W,void 0);for(var $=0;$<W;++$)B[$]=this[$+c]}return B},o.prototype.readUIntLE=function(c,h,B){c|=0,h|=0,B||dt(c,h,this.length);for(var J=this[c],W=1,$=0;++$<h&&(W*=256);)J+=this[c+$]*W;return J},o.prototype.readUIntBE=function(c,h,B){c|=0,h|=0,B||dt(c,h,this.length);for(var J=this[c+--h],W=1;h>0&&(W*=256);)J+=this[c+--h]*W;return J},o.prototype.readUInt8=function(c,h){return h||dt(c,1,this.length),this[c]},o.prototype.readUInt16LE=function(c,h){return h||dt(c,2,this.length),this[c]|this[c+1]<<8},o.prototype.readUInt16BE=function(c,h){return h||dt(c,2,this.length),this[c]<<8|this[c+1]},o.prototype.readUInt32LE=function(c,h){return h||dt(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+16777216*this[c+3]},o.prototype.readUInt32BE=function(c,h){return h||dt(c,4,this.length),16777216*this[c]+(this[c+1]<<16|this[c+2]<<8|this[c+3])},o.prototype.readIntLE=function(c,h,B){c|=0,h|=0,B||dt(c,h,this.length);for(var J=this[c],W=1,$=0;++$<h&&(W*=256);)J+=this[c+$]*W;return J>=(W*=128)&&(J-=Math.pow(2,8*h)),J},o.prototype.readIntBE=function(c,h,B){c|=0,h|=0,B||dt(c,h,this.length);for(var J=h,W=1,$=this[c+--J];J>0&&(W*=256);)$+=this[c+--J]*W;return $>=(W*=128)&&($-=Math.pow(2,8*h)),$},o.prototype.readInt8=function(c,h){return h||dt(c,1,this.length),128&this[c]?-1*(255-this[c]+1):this[c]},o.prototype.readInt16LE=function(c,h){h||dt(c,2,this.length);var B=this[c]|this[c+1]<<8;return 32768&B?4294901760|B:B},o.prototype.readInt16BE=function(c,h){h||dt(c,2,this.length);var B=this[c+1]|this[c]<<8;return 32768&B?4294901760|B:B},o.prototype.readInt32LE=function(c,h){return h||dt(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},o.prototype.readInt32BE=function(c,h){return h||dt(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},o.prototype.readFloatLE=function(c,h){return h||dt(c,4,this.length),U.read(this,c,!0,23,4)},o.prototype.readFloatBE=function(c,h){return h||dt(c,4,this.length),U.read(this,c,!1,23,4)},o.prototype.readDoubleLE=function(c,h){return h||dt(c,8,this.length),U.read(this,c,!0,52,8)},o.prototype.readDoubleBE=function(c,h){return h||dt(c,8,this.length),U.read(this,c,!1,52,8)},o.prototype.writeUIntLE=function(c,h,B,J){c=+c,h|=0,B|=0,J||pt(this,c,h,B,Math.pow(2,8*B)-1,0);var W=1,$=0;for(this[h]=255&c;++$<B&&(W*=256);)this[h+$]=c/W&255;return h+B},o.prototype.writeUIntBE=function(c,h,B,J){c=+c,h|=0,B|=0,J||pt(this,c,h,B,Math.pow(2,8*B)-1,0);var W=B-1,$=1;for(this[h+W]=255&c;--W>=0&&($*=256);)this[h+W]=c/$&255;return h+B},o.prototype.writeUInt8=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,1,255,0),o.TYPED_ARRAY_SUPPORT||(c=Math.floor(c)),this[h]=255&c,h+1},o.prototype.writeUInt16LE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[h]=255&c,this[h+1]=c>>>8):Pt(this,c,h,!0),h+2},o.prototype.writeUInt16BE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>8,this[h+1]=255&c):Pt(this,c,h,!1),h+2},o.prototype.writeUInt32LE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[h+3]=c>>>24,this[h+2]=c>>>16,this[h+1]=c>>>8,this[h]=255&c):Yt(this,c,h,!0),h+4},o.prototype.writeUInt32BE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>24,this[h+1]=c>>>16,this[h+2]=c>>>8,this[h+3]=255&c):Yt(this,c,h,!1),h+4},o.prototype.writeIntLE=function(c,h,B,J){if(c=+c,h|=0,!J){var W=Math.pow(2,8*B-1);pt(this,c,h,B,W-1,-W)}var $=0,ut=1,ft=0;for(this[h]=255&c;++$<B&&(ut*=256);)c<0&&ft===0&&this[h+$-1]!==0&&(ft=1),this[h+$]=(c/ut>>0)-ft&255;return h+B},o.prototype.writeIntBE=function(c,h,B,J){if(c=+c,h|=0,!J){var W=Math.pow(2,8*B-1);pt(this,c,h,B,W-1,-W)}var $=B-1,ut=1,ft=0;for(this[h+$]=255&c;--$>=0&&(ut*=256);)c<0&&ft===0&&this[h+$+1]!==0&&(ft=1),this[h+$]=(c/ut>>0)-ft&255;return h+B},o.prototype.writeInt8=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,1,127,-128),o.TYPED_ARRAY_SUPPORT||(c=Math.floor(c)),c<0&&(c=255+c+1),this[h]=255&c,h+1},o.prototype.writeInt16LE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[h]=255&c,this[h+1]=c>>>8):Pt(this,c,h,!0),h+2},o.prototype.writeInt16BE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>8,this[h+1]=255&c):Pt(this,c,h,!1),h+2},o.prototype.writeInt32LE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[h]=255&c,this[h+1]=c>>>8,this[h+2]=c>>>16,this[h+3]=c>>>24):Yt(this,c,h,!0),h+4},o.prototype.writeInt32BE=function(c,h,B){return c=+c,h|=0,B||pt(this,c,h,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>24,this[h+1]=c>>>16,this[h+2]=c>>>8,this[h+3]=255&c):Yt(this,c,h,!1),h+4},o.prototype.writeFloatLE=function(c,h,B){return Gt(this,c,h,!0,B)},o.prototype.writeFloatBE=function(c,h,B){return Gt(this,c,h,!1,B)},o.prototype.writeDoubleLE=function(c,h,B){return ee(this,c,h,!0,B)},o.prototype.writeDoubleBE=function(c,h,B){return ee(this,c,h,!1,B)},o.prototype.copy=function(c,h,B,J){if(B||(B=0),J||J===0||(J=this.length),h>=c.length&&(h=c.length),h||(h=0),J>0&&J<B&&(J=B),J===B||c.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("sourceStart out of bounds");if(J<0)throw new RangeError("sourceEnd out of bounds");J>this.length&&(J=this.length),c.length-h<J-B&&(J=c.length-h+B);var W,$=J-B;if(this===c&&B<h&&h<J)for(W=$-1;W>=0;--W)c[W+h]=this[W+B];else if($<1e3||!o.TYPED_ARRAY_SUPPORT)for(W=0;W<$;++W)c[W+h]=this[W+B];else Uint8Array.prototype.set.call(c,this.subarray(B,B+$),h);return $},o.prototype.fill=function(c,h,B,J){if(typeof c=="string"){if(typeof h=="string"?(J=h,h=0,B=this.length):typeof B=="string"&&(J=B,B=this.length),c.length===1){var W=c.charCodeAt(0);W<256&&(c=W)}if(J!==void 0&&typeof J!="string")throw new TypeError("encoding must be a string");if(typeof J=="string"&&!o.isEncoding(J))throw new TypeError("Unknown encoding: "+J)}else typeof c=="number"&&(c&=255);if(h<0||this.length<h||this.length<B)throw new RangeError("Out of range index");if(B<=h)return this;var $;if(h>>>=0,B=B===void 0?this.length:B>>>0,c||(c=0),typeof c=="number")for($=h;$<B;++$)this[$]=c;else{var ut=o.isBuffer(c)?c:Bt(new o(c,J).toString()),ft=ut.length;for($=0;$<B-h;++$)this[$+h]=ut[$%ft]}return this};var le=/[^+\/0-9A-Za-z-_]/g;function ne(j){return j<16?"0"+j.toString(16):j.toString(16)}function Bt(j,c){var h;c=c||1/0;for(var B=j.length,J=null,W=[],$=0;$<B;++$){if((h=j.charCodeAt($))>55295&&h<57344){if(!J){if(h>56319){(c-=3)>-1&&W.push(239,191,189);continue}if($+1===B){(c-=3)>-1&&W.push(239,191,189);continue}J=h;continue}if(h<56320){(c-=3)>-1&&W.push(239,191,189),J=h;continue}h=65536+(J-55296<<10|h-56320)}else J&&(c-=3)>-1&&W.push(239,191,189);if(J=null,h<128){if((c-=1)<0)break;W.push(h)}else if(h<2048){if((c-=2)<0)break;W.push(h>>6|192,63&h|128)}else if(h<65536){if((c-=3)<0)break;W.push(h>>12|224,h>>6&63|128,63&h|128)}else{if(!(h<1114112))throw new Error("Invalid code point");if((c-=4)<0)break;W.push(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}}return W}function Xt(j){return l.toByteArray(function(h){if((h=function(J){return J.trim?J.trim():J.replace(/^\s+|\s+$/g,"")}(h).replace(le,"")).length<2)return"";for(;h.length%4!=0;)h+="=";return h}(j))}function Jt(j,c,h,B){for(var J=0;J<B&&!(J+h>=c.length||J>=j.length);++J)c[J+h]=j[J];return J}}).call(this,F(29))},function(et,v){var F;F=function(){return this}();try{F=F||new Function("return this")()}catch{typeof window=="object"&&(F=window)}et.exports=F},function(et,v,F){v.byteLength=function(x){var V=o(x),O=V[0],A=V[1];return 3*(O+A)/4-A},v.toByteArray=function(x){var V,O,A=o(x),k=A[0],M=A[1],q=new U(function(Z,tt,nt){return 3*(tt+nt)/4-nt}(0,k,M)),d=0,b=M>0?k-4:k;for(O=0;O<b;O+=4)V=l[x.charCodeAt(O)]<<18|l[x.charCodeAt(O+1)]<<12|l[x.charCodeAt(O+2)]<<6|l[x.charCodeAt(O+3)],q[d++]=V>>16&255,q[d++]=V>>8&255,q[d++]=255&V;return M===2&&(V=l[x.charCodeAt(O)]<<2|l[x.charCodeAt(O+1)]>>4,q[d++]=255&V),M===1&&(V=l[x.charCodeAt(O)]<<10|l[x.charCodeAt(O+1)]<<4|l[x.charCodeAt(O+2)]>>2,q[d++]=V>>8&255,q[d++]=255&V),q},v.fromByteArray=function(x){for(var V,O=x.length,A=O%3,k=[],M=16383,q=0,d=O-A;q<d;q+=M)k.push(p(x,q,q+M>d?d:q+M));return A===1?(V=x[O-1],k.push(T[V>>2]+T[V<<4&63]+"==")):A===2&&(V=(x[O-2]<<8)+x[O-1],k.push(T[V>>10]+T[V>>4&63]+T[V<<2&63]+"=")),k.join("")};for(var T=[],l=[],U=typeof Uint8Array!="undefined"?Uint8Array:Array,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=_.length;a<u;++a)T[a]=_[a],l[_.charCodeAt(a)]=a;function o(I){var x=I.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var V=I.indexOf("=");return V===-1&&(V=x),[V,V===x?0:4-V%4]}function p(I,x,V){for(var O,A,k=[],M=x;M<V;M+=3)O=(I[M]<<16&16711680)+(I[M+1]<<8&65280)+(255&I[M+2]),k.push(T[(A=O)>>18&63]+T[A>>12&63]+T[A>>6&63]+T[63&A]);return k.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(et,v){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */v.read=function(F,T,l,U,_){var a,u,o=8*_-U-1,p=(1<<o)-1,I=p>>1,x=-7,V=l?_-1:0,O=l?-1:1,A=F[T+V];for(V+=O,a=A&(1<<-x)-1,A>>=-x,x+=o;x>0;a=256*a+F[T+V],V+=O,x-=8);for(u=a&(1<<-x)-1,a>>=-x,x+=U;x>0;u=256*u+F[T+V],V+=O,x-=8);if(a===0)a=1-I;else{if(a===p)return u?NaN:1/0*(A?-1:1);u+=Math.pow(2,U),a-=I}return(A?-1:1)*u*Math.pow(2,a-U)},v.write=function(F,T,l,U,_,a){var u,o,p,I=8*a-_-1,x=(1<<I)-1,V=x>>1,O=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=U?0:a-1,k=U?1:-1,M=T<0||T===0&&1/T<0?1:0;for(T=Math.abs(T),isNaN(T)||T===1/0?(o=isNaN(T)?1:0,u=x):(u=Math.floor(Math.log(T)/Math.LN2),T*(p=Math.pow(2,-u))<1&&(u--,p*=2),(T+=u+V>=1?O/p:O*Math.pow(2,1-V))*p>=2&&(u++,p/=2),u+V>=x?(o=0,u=x):u+V>=1?(o=(T*p-1)*Math.pow(2,_),u+=V):(o=T*Math.pow(2,V-1)*Math.pow(2,_),u=0));_>=8;F[l+A]=255&o,A+=k,o/=256,_-=8);for(u=u<<_|o,I+=_;I>0;F[l+A]=255&u,A+=k,u/=256,I-=8);F[l+A-k]|=128*M}},function(et,v){var F={}.toString;et.exports=Array.isArray||function(T){return F.call(T)=="[object Array]"}},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.default=function(U){var _=U.jws,a=U.KeyUtil,u=U.X509,o=U.crypto,p=U.hextob64u,I=U.b64tohex,x=U.AllowedSigningAlgs;return function(){function V(){(function(A,k){if(!(A instanceof k))throw new TypeError("Cannot call a class as a function")})(this,V)}return V.parseJwt=function(A){T.Log.debug("JoseUtil.parseJwt");try{var k=_.JWS.parse(A);return{header:k.headerObj,payload:k.payloadObj}}catch(M){T.Log.error(M)}},V.validateJwt=function(A,k,M,q,d,b,R){T.Log.debug("JoseUtil.validateJwt");try{if(k.kty==="RSA")if(k.e&&k.n)k=a.getKey(k);else{if(!k.x5c||!k.x5c.length)return T.Log.error("JoseUtil.validateJwt: RSA key missing key material",k),Promise.reject(new Error("RSA key missing key material"));var Z=I(k.x5c[0]);k=u.getPublicKeyFromCertHex(Z)}else{if(k.kty!=="EC")return T.Log.error("JoseUtil.validateJwt: Unsupported key type",k&&k.kty),Promise.reject(new Error(k.kty));if(!(k.crv&&k.x&&k.y))return T.Log.error("JoseUtil.validateJwt: EC key missing key material",k),Promise.reject(new Error("EC key missing key material"));k=a.getKey(k)}return V._validateJwt(A,k,M,q,d,b,R)}catch(tt){return T.Log.error(tt&&tt.message||tt),Promise.reject("JWT validation failed")}},V.validateJwtAttributes=function(A,k,M,q,d,b){q||(q=0),d||(d=parseInt(Date.now()/1e3));var R=V.parseJwt(A).payload;if(!R.iss)return T.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(R.iss!==k)return T.Log.error("JoseUtil._validateJwt: Invalid issuer in token",R.iss),Promise.reject(new Error("Invalid issuer in token: "+R.iss));if(!R.aud)return T.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(R.aud===M||Array.isArray(R.aud)&&R.aud.indexOf(M)>=0))return T.Log.error("JoseUtil._validateJwt: Invalid audience in token",R.aud),Promise.reject(new Error("Invalid audience in token: "+R.aud));if(R.azp&&R.azp!==M)return T.Log.error("JoseUtil._validateJwt: Invalid azp in token",R.azp),Promise.reject(new Error("Invalid azp in token: "+R.azp));if(!b){var Z=d+q,tt=d-q;if(!R.iat)return T.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(Z<R.iat)return T.Log.error("JoseUtil._validateJwt: iat is in the future",R.iat),Promise.reject(new Error("iat is in the future: "+R.iat));if(R.nbf&&Z<R.nbf)return T.Log.error("JoseUtil._validateJwt: nbf is in the future",R.nbf),Promise.reject(new Error("nbf is in the future: "+R.nbf));if(!R.exp)return T.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(R.exp<tt)return T.Log.error("JoseUtil._validateJwt: exp is in the past",R.exp),Promise.reject(new Error("exp is in the past:"+R.exp))}return Promise.resolve(R)},V._validateJwt=function(A,k,M,q,d,b,R){return V.validateJwtAttributes(A,M,q,d,b,R).then(function(Z){try{return _.JWS.verify(A,k,x)?Z:(T.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(tt){return T.Log.error(tt&&tt.message||tt),Promise.reject(new Error("signature validation failed"))}})},V.hashString=function(A,k){try{return o.Util.hashString(A,k)}catch(M){T.Log.error(M)}},V.hexToBase64Url=function(A){try{return p(A)}catch(k){T.Log.error(k)}},V}()};var T=F(0);et.exports=v.default},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SigninResponse=void 0;var T=function(){function _(a,u){for(var o=0;o<u.length;o++){var p=u[o];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(a,p.key,p)}}return function(a,u,o){return u&&_(a.prototype,u),o&&_(a,o),a}}(),l=F(3);function U(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")}v.SigninResponse=function(){function _(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";U(this,_);var o=l.UrlUtility.parseUrlFragment(a,u);this.error=o.error,this.error_description=o.error_description,this.error_uri=o.error_uri,this.code=o.code,this.state=o.state,this.id_token=o.id_token,this.session_state=o.session_state,this.access_token=o.access_token,this.token_type=o.token_type,this.scope=o.scope,this.profile=void 0,this.expires_in=o.expires_in}return T(_,[{key:"expires_in",get:function(){if(this.expires_at){var u=parseInt(Date.now()/1e3);return this.expires_at-u}},set:function(u){var o=parseInt(u);if(typeof o=="number"&&o>0){var p=parseInt(Date.now()/1e3);this.expires_at=p+o}}},{key:"expired",get:function(){var u=this.expires_in;if(u!==void 0)return u<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),_}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SignoutRequest=void 0;var T=F(0),l=F(3),U=F(9);v.SignoutRequest=function _(a){var u=a.url,o=a.id_token_hint,p=a.post_logout_redirect_uri,I=a.data,x=a.extraQueryParams,V=a.request_type;if(function(k,M){if(!(k instanceof M))throw new TypeError("Cannot call a class as a function")}(this,_),!u)throw T.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var O in o&&(u=l.UrlUtility.addQueryParam(u,"id_token_hint",o)),p&&(u=l.UrlUtility.addQueryParam(u,"post_logout_redirect_uri",p),I&&(this.state=new U.State({data:I,request_type:V}),u=l.UrlUtility.addQueryParam(u,"state",this.state.id))),x)u=l.UrlUtility.addQueryParam(u,O,x[O]);this.url=u}},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SignoutResponse=void 0;var T=F(3);v.SignoutResponse=function l(U){(function(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")})(this,l);var _=T.UrlUtility.parseUrlFragment(U,"?");this.error=_.error,this.error_description=_.error_description,this.error_uri=_.error_uri,this.state=_.state}},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.InMemoryWebStorage=void 0;var T=function(){function U(_,a){for(var u=0;u<a.length;u++){var o=a[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}return function(_,a,u){return a&&U(_.prototype,a),u&&U(_,u),_}}(),l=F(0);v.InMemoryWebStorage=function(){function U(){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,U),this._data={}}return U.prototype.getItem=function(a){return l.Log.debug("InMemoryWebStorage.getItem",a),this._data[a]},U.prototype.setItem=function(a,u){l.Log.debug("InMemoryWebStorage.setItem",a),this._data[a]=u},U.prototype.removeItem=function(a){l.Log.debug("InMemoryWebStorage.removeItem",a),delete this._data[a]},U.prototype.key=function(a){return Object.getOwnPropertyNames(this._data)[a]},T(U,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.UserManager=void 0;var T=function(){function M(q,d){for(var b=0;b<d.length;b++){var R=d[b];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(q,R.key,R)}}return function(q,d,b){return d&&M(q.prototype,d),b&&M(q,b),q}}(),l=F(0),U=F(10),_=F(39),a=F(15),u=F(45),o=F(47),p=F(18),I=F(8),x=F(20),V=F(11),O=F(4);function A(M,q){if(!(M instanceof q))throw new TypeError("Cannot call a class as a function")}function k(M,q){if(!M)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!q||typeof q!="object"&&typeof q!="function"?M:q}v.UserManager=function(M){function q(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:o.SilentRenewService,R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:p.SessionMonitor,Z=arguments.length>3&&arguments[3]!==void 0?arguments[3]:x.TokenRevocationClient,tt=arguments.length>4&&arguments[4]!==void 0?arguments[4]:V.TokenClient,nt=arguments.length>5&&arguments[5]!==void 0?arguments[5]:O.JoseUtil;A(this,q),d instanceof _.UserManagerSettings||(d=new _.UserManagerSettings(d));var H=k(this,M.call(this,d));return H._events=new u.UserManagerEvents(d),H._silentRenewService=new b(H),H.settings.automaticSilentRenew&&(l.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),H.startSilentRenew()),H.settings.monitorSession&&(l.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),H._sessionMonitor=new R(H)),H._tokenRevocationClient=new Z(H._settings),H._tokenClient=new tt(H._settings),H._joseUtil=nt,H}return function(b,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);b.prototype=Object.create(R&&R.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(b,R):b.__proto__=R)}(q,M),q.prototype.getUser=function(){var b=this;return this._loadUser().then(function(R){return R?(l.Log.info("UserManager.getUser: user loaded"),b._events.load(R,!1),R):(l.Log.info("UserManager.getUser: user not found in storage"),null)})},q.prototype.removeUser=function(){var b=this;return this.storeUser(null).then(function(){l.Log.info("UserManager.removeUser: user removed from storage"),b._events.unload()})},q.prototype.signinRedirect=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).request_type="si:r";var R={useReplaceToNavigate:b.useReplaceToNavigate};return this._signinStart(b,this._redirectNavigator,R).then(function(){l.Log.info("UserManager.signinRedirect: successful")})},q.prototype.signinRedirectCallback=function(b){return this._signinEnd(b||this._redirectNavigator.url).then(function(R){return R.profile&&R.profile.sub?l.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",R.profile.sub):l.Log.info("UserManager.signinRedirectCallback: no sub"),R})},q.prototype.signinPopup=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).request_type="si:p";var R=b.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return R?(b.redirect_uri=R,b.display="popup",this._signin(b,this._popupNavigator,{startUrl:R,popupWindowFeatures:b.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:b.popupWindowTarget||this.settings.popupWindowTarget}).then(function(Z){return Z&&(Z.profile&&Z.profile.sub?l.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",Z.profile.sub):l.Log.info("UserManager.signinPopup: no sub")),Z})):(l.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},q.prototype.signinPopupCallback=function(b){return this._signinCallback(b,this._popupNavigator).then(function(R){return R&&(R.profile&&R.profile.sub?l.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",R.profile.sub):l.Log.info("UserManager.signinPopupCallback: no sub")),R}).catch(function(R){l.Log.error(R.message)})},q.prototype.signinSilent=function(){var b=this,R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return R=Object.assign({},R),this._loadUser().then(function(Z){return Z&&Z.refresh_token?(R.refresh_token=Z.refresh_token,b._useRefreshToken(R)):(R.request_type="si:s",R.id_token_hint=R.id_token_hint||b.settings.includeIdTokenInSilentRenew&&Z&&Z.id_token,Z&&b._settings.validateSubOnSilentRenew&&(l.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",Z.profile.sub),R.current_sub=Z.profile.sub),b._signinSilentIframe(R))})},q.prototype._useRefreshToken=function(){var b=this,R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(R).then(function(Z){return Z?Z.access_token?b._loadUser().then(function(tt){if(tt){var nt=Promise.resolve();return Z.id_token&&(nt=b._validateIdTokenFromTokenRefreshToken(tt.profile,Z.id_token)),nt.then(function(){return l.Log.debug("UserManager._useRefreshToken: refresh token response success"),tt.id_token=Z.id_token||tt.id_token,tt.access_token=Z.access_token,tt.refresh_token=Z.refresh_token||tt.refresh_token,tt.expires_in=Z.expires_in,b.storeUser(tt).then(function(){return b._events.load(tt),tt})})}return null}):(l.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(l.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},q.prototype._validateIdTokenFromTokenRefreshToken=function(b,R){var Z=this;return this._metadataService.getIssuer().then(function(tt){return Z.settings.getEpochTime().then(function(nt){return Z._joseUtil.validateJwtAttributes(R,tt,Z._settings.client_id,Z._settings.clockSkew,nt).then(function(H){return H?H.sub!==b.sub?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):H.auth_time&&H.auth_time!==b.auth_time?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):H.azp&&H.azp!==b.azp?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!H.azp&&b.azp?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},q.prototype._signinSilentIframe=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=b.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return R?(b.redirect_uri=R,b.prompt=b.prompt||"none",this._signin(b,this._iframeNavigator,{startUrl:R,silentRequestTimeout:b.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(Z){return Z&&(Z.profile&&Z.profile.sub?l.Log.info("UserManager.signinSilent: successful, signed in sub: ",Z.profile.sub):l.Log.info("UserManager.signinSilent: no sub")),Z})):(l.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},q.prototype.signinSilentCallback=function(b){return this._signinCallback(b,this._iframeNavigator).then(function(R){return R&&(R.profile&&R.profile.sub?l.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",R.profile.sub):l.Log.info("UserManager.signinSilentCallback: no sub")),R})},q.prototype.signinCallback=function(b){var R=this;return this.readSigninResponseState(b).then(function(Z){var tt=Z.state;return Z.response,tt.request_type==="si:r"?R.signinRedirectCallback(b):tt.request_type==="si:p"?R.signinPopupCallback(b):tt.request_type==="si:s"?R.signinSilentCallback(b):Promise.reject(new Error("invalid response_type in state"))})},q.prototype.signoutCallback=function(b,R){var Z=this;return this.readSignoutResponseState(b).then(function(tt){var nt=tt.state,H=tt.response;return nt?nt.request_type==="so:r"?Z.signoutRedirectCallback(b):nt.request_type==="so:p"?Z.signoutPopupCallback(b,R):Promise.reject(new Error("invalid response_type in state")):H})},q.prototype.querySessionStatus=function(){var b=this,R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(R=Object.assign({},R)).request_type="si:s";var Z=R.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return Z?(R.redirect_uri=Z,R.prompt="none",R.response_type=R.response_type||this.settings.query_status_response_type,R.scope=R.scope||"openid",R.skipUserInfo=!0,this._signinStart(R,this._iframeNavigator,{startUrl:Z,silentRequestTimeout:R.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(tt){return b.processSigninResponse(tt.url).then(function(nt){if(l.Log.debug("UserManager.querySessionStatus: got signin response"),nt.session_state&&nt.profile.sub)return l.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",nt.profile.sub),{session_state:nt.session_state,sub:nt.profile.sub,sid:nt.profile.sid};l.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(nt){if(nt.session_state&&b.settings.monitorAnonymousSession&&(nt.message=="login_required"||nt.message=="consent_required"||nt.message=="interaction_required"||nt.message=="account_selection_required"))return l.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:nt.session_state};throw nt})})):(l.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},q.prototype._signin=function(b,R){var Z=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(b,R,tt).then(function(nt){return Z._signinEnd(nt.url,b)})},q.prototype._signinStart=function(b,R){var Z=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return R.prepare(tt).then(function(nt){return l.Log.debug("UserManager._signinStart: got navigator window handle"),Z.createSigninRequest(b).then(function(H){return l.Log.debug("UserManager._signinStart: got signin request"),tt.url=H.url,tt.id=H.state.id,nt.navigate(tt)}).catch(function(H){throw nt.close&&(l.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),nt.close()),H})})},q.prototype._signinEnd=function(b){var R=this,Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(b).then(function(tt){l.Log.debug("UserManager._signinEnd: got signin response");var nt=new a.User(tt);if(Z.current_sub){if(Z.current_sub!==nt.profile.sub)return l.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",nt.profile.sub),Promise.reject(new Error("login_required"));l.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return R.storeUser(nt).then(function(){return l.Log.debug("UserManager._signinEnd: user stored"),R._events.load(nt),nt})})},q.prototype._signinCallback=function(b,R){l.Log.debug("UserManager._signinCallback");var Z=this._settings.response_mode==="query"||!this._settings.response_mode&&I.SigninRequest.isCode(this._settings.response_type)?"?":"#";return R.callback(b,void 0,Z)},q.prototype.signoutRedirect=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).request_type="so:r";var R=b.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;R&&(b.post_logout_redirect_uri=R);var Z={useReplaceToNavigate:b.useReplaceToNavigate};return this._signoutStart(b,this._redirectNavigator,Z).then(function(){l.Log.info("UserManager.signoutRedirect: successful")})},q.prototype.signoutRedirectCallback=function(b){return this._signoutEnd(b||this._redirectNavigator.url).then(function(R){return l.Log.info("UserManager.signoutRedirectCallback: successful"),R})},q.prototype.signoutPopup=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).request_type="so:p";var R=b.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return b.post_logout_redirect_uri=R,b.display="popup",b.post_logout_redirect_uri&&(b.state=b.state||{}),this._signout(b,this._popupNavigator,{startUrl:R,popupWindowFeatures:b.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:b.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){l.Log.info("UserManager.signoutPopup: successful")})},q.prototype.signoutPopupCallback=function(b,R){return R===void 0&&typeof b=="boolean"&&(R=b,b=null),this._popupNavigator.callback(b,R,"?").then(function(){l.Log.info("UserManager.signoutPopupCallback: successful")})},q.prototype._signout=function(b,R){var Z=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(b,R,tt).then(function(nt){return Z._signoutEnd(nt.url)})},q.prototype._signoutStart=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=this,Z=arguments[1],tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Z.prepare(tt).then(function(nt){return l.Log.debug("UserManager._signoutStart: got navigator window handle"),R._loadUser().then(function(H){return l.Log.debug("UserManager._signoutStart: loaded current user from storage"),(R._settings.revokeAccessTokenOnSignout?R._revokeInternal(H):Promise.resolve()).then(function(){var at=b.id_token_hint||H&&H.id_token;return at&&(l.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),b.id_token_hint=at),R.removeUser().then(function(){return l.Log.debug("UserManager._signoutStart: user removed, creating signout request"),R.createSignoutRequest(b).then(function(_t){return l.Log.debug("UserManager._signoutStart: got signout request"),tt.url=_t.url,_t.state&&(tt.id=_t.state.id),nt.navigate(tt)})})})}).catch(function(H){throw nt.close&&(l.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),nt.close()),H})})},q.prototype._signoutEnd=function(b){return this.processSignoutResponse(b).then(function(R){return l.Log.debug("UserManager._signoutEnd: got signout response"),R})},q.prototype.revokeAccessToken=function(){var b=this;return this._loadUser().then(function(R){return b._revokeInternal(R,!0).then(function(Z){if(Z)return l.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),R.access_token=null,R.refresh_token=null,R.expires_at=null,R.token_type=null,b.storeUser(R).then(function(){l.Log.debug("UserManager.revokeAccessToken: user stored"),b._events.load(R)})})}).then(function(){l.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},q.prototype._revokeInternal=function(b,R){var Z=this;if(b){var tt=b.access_token,nt=b.refresh_token;return this._revokeAccessTokenInternal(tt,R).then(function(H){return Z._revokeRefreshTokenInternal(nt,R).then(function(at){return H||at||l.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),H||at})})}return Promise.resolve(!1)},q.prototype._revokeAccessTokenInternal=function(b,R){return!b||b.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(b,R).then(function(){return!0})},q.prototype._revokeRefreshTokenInternal=function(b,R){return b?this._tokenRevocationClient.revoke(b,R,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},q.prototype.startSilentRenew=function(){this._silentRenewService.start()},q.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},q.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(b){return b?(l.Log.debug("UserManager._loadUser: user storageString loaded"),a.User.fromStorageString(b)):(l.Log.debug("UserManager._loadUser: no user storageString"),null)})},q.prototype.storeUser=function(b){if(b){l.Log.debug("UserManager.storeUser: storing user");var R=b.toStorageString();return this._userStore.set(this._userStoreKey,R)}return l.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},T(q,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),q}(U.OidcClient)},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.UserManagerSettings=void 0;var T=function(){function V(O,A){for(var k=0;k<A.length;k++){var M=A[k];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(O,M.key,M)}}return function(O,A,k){return A&&V(O.prototype,A),k&&V(O,k),O}}(),l=(F(0),F(5)),U=F(40),_=F(41),a=F(43),u=F(6),o=F(1),p=F(8);function I(V,O){if(!(V instanceof O))throw new TypeError("Cannot call a class as a function")}function x(V,O){if(!V)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!O||typeof O!="object"&&typeof O!="function"?V:O}v.UserManagerSettings=function(V){function O(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=A.popup_redirect_uri,M=A.popup_post_logout_redirect_uri,q=A.popupWindowFeatures,d=A.popupWindowTarget,b=A.silent_redirect_uri,R=A.silentRequestTimeout,Z=A.automaticSilentRenew,tt=Z!==void 0&&Z,nt=A.validateSubOnSilentRenew,H=nt!==void 0&&nt,at=A.includeIdTokenInSilentRenew,_t=at===void 0||at,bt=A.monitorSession,Ht=bt===void 0||bt,At=A.monitorAnonymousSession,te=At!==void 0&&At,It=A.checkSessionInterval,dt=It===void 0?2e3:It,pt=A.stopCheckSessionOnError,Pt=pt===void 0||pt,Yt=A.query_status_response_type,qt=A.revokeAccessTokenOnSignout,Gt=qt!==void 0&&qt,ee=A.accessTokenExpiringNotificationTime,le=ee===void 0?60:ee,ne=A.redirectNavigator,Bt=ne===void 0?new U.RedirectNavigator:ne,Xt=A.popupNavigator,Jt=Xt===void 0?new _.PopupNavigator:Xt,j=A.iframeNavigator,c=j===void 0?new a.IFrameNavigator:j,h=A.userStore,B=h===void 0?new u.WebStorageStateStore({store:o.Global.sessionStorage}):h;I(this,O);var J=x(this,V.call(this,arguments[0]));return J._popup_redirect_uri=k,J._popup_post_logout_redirect_uri=M,J._popupWindowFeatures=q,J._popupWindowTarget=d,J._silent_redirect_uri=b,J._silentRequestTimeout=R,J._automaticSilentRenew=tt,J._validateSubOnSilentRenew=H,J._includeIdTokenInSilentRenew=_t,J._accessTokenExpiringNotificationTime=le,J._monitorSession=Ht,J._monitorAnonymousSession=te,J._checkSessionInterval=dt,J._stopCheckSessionOnError=Pt,Yt?J._query_status_response_type=Yt:arguments[0]&&arguments[0].response_type?J._query_status_response_type=p.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":J._query_status_response_type="id_token",J._revokeAccessTokenOnSignout=Gt,J._redirectNavigator=Bt,J._popupNavigator=Jt,J._iframeNavigator=c,J._userStore=B,J}return function(k,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);k.prototype=Object.create(M&&M.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(k,M):k.__proto__=M)}(O,V),T(O,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),O}(l.OidcClientSettings)},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.RedirectNavigator=void 0;var T=function(){function U(_,a){for(var u=0;u<a.length;u++){var o=a[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}return function(_,a,u){return a&&U(_.prototype,a),u&&U(_,u),_}}(),l=F(0);v.RedirectNavigator=function(){function U(){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,U)}return U.prototype.prepare=function(){return Promise.resolve(this)},U.prototype.navigate=function(a){return a&&a.url?(a.useReplaceToNavigate?window.location.replace(a.url):window.location=a.url,Promise.resolve()):(l.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},T(U,[{key:"url",get:function(){return window.location.href}}]),U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.PopupNavigator=void 0;var T=F(0),l=F(42);v.PopupNavigator=function(){function U(){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,U)}return U.prototype.prepare=function(a){var u=new l.PopupWindow(a);return Promise.resolve(u)},U.prototype.callback=function(a,u,o){T.Log.debug("PopupNavigator.callback");try{return l.PopupWindow.notifyOpener(a,u,o),Promise.resolve()}catch(p){return Promise.reject(p)}},U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.PopupWindow=void 0;var T=function(){function _(a,u){for(var o=0;o<u.length;o++){var p=u[o];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(a,p.key,p)}}return function(a,u,o){return u&&_(a.prototype,u),o&&_(a,o),a}}(),l=F(0),U=F(3);v.PopupWindow=function(){function _(a){var u=this;(function(x,V){if(!(x instanceof V))throw new TypeError("Cannot call a class as a function")})(this,_),this._promise=new Promise(function(I,x){u._resolve=I,u._reject=x});var o=a.popupWindowTarget||"_blank",p=a.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",o,p),this._popup&&(l.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return _.prototype.navigate=function(u){return this._popup?u&&u.url?(l.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=u.id,this._id&&(window["popupCallback_"+u.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=u.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},_.prototype._success=function(u){l.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(u)},_.prototype._error=function(u){l.Log.error("PopupWindow.error: ",u),this._cleanup(),this._reject(new Error(u))},_.prototype.close=function(){this._cleanup(!1)},_.prototype._cleanup=function(u){l.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!u&&this._popup.close(),this._popup=null},_.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},_.prototype._callback=function(u,o){this._cleanup(o),u?(l.Log.debug("PopupWindow.callback success"),this._success({url:u})):(l.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},_.notifyOpener=function(u,o,p){if(window.opener){if(u=u||window.location.href){var I=U.UrlUtility.parseUrlFragment(u,p);if(I.state){var x="popupCallback_"+I.state,V=window.opener[x];V?(l.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),V(u,o)):l.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else l.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else l.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},T(_,[{key:"promise",get:function(){return this._promise}}]),_}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.IFrameNavigator=void 0;var T=F(0),l=F(44);v.IFrameNavigator=function(){function U(){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,U)}return U.prototype.prepare=function(a){var u=new l.IFrameWindow(a);return Promise.resolve(u)},U.prototype.callback=function(a){T.Log.debug("IFrameNavigator.callback");try{return l.IFrameWindow.notifyParent(a),Promise.resolve()}catch(u){return Promise.reject(u)}},U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.IFrameWindow=void 0;var T=function(){function U(_,a){for(var u=0;u<a.length;u++){var o=a[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}return function(_,a,u){return a&&U(_.prototype,a),u&&U(_,u),_}}(),l=F(0);v.IFrameWindow=function(){function U(_){var a=this;(function(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")})(this,U),this._promise=new Promise(function(u,o){a._resolve=u,a._reject=o}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return U.prototype.navigate=function(a){if(a&&a.url){var u=a.silentRequestTimeout||1e4;l.Log.debug("IFrameWindow.navigate: Using timeout of:",u),this._timer=window.setTimeout(this._timeout.bind(this),u),this._frame.src=a.url}else this._error("No url provided");return this.promise},U.prototype._success=function(a){this._cleanup(),l.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(a)},U.prototype._error=function(a){this._cleanup(),l.Log.error(a),this._reject(new Error(a))},U.prototype.close=function(){this._cleanup()},U.prototype._cleanup=function(){this._frame&&(l.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},U.prototype._timeout=function(){l.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},U.prototype._message=function(a){if(l.Log.debug("IFrameWindow.message"),this._timer&&a.origin===this._origin&&a.source===this._frame.contentWindow&&typeof a.data=="string"&&(a.data.startsWith("http://")||a.data.startsWith("https://"))){var u=a.data;u?this._success({url:u}):this._error("Invalid response from frame")}},U.notifyParent=function(a){l.Log.debug("IFrameWindow.notifyParent"),(a=a||window.location.href)&&(l.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(a,location.protocol+"//"+location.host))},T(U,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),U}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.UserManagerEvents=void 0;var T=F(0),l=F(16),U=F(17);v.UserManagerEvents=function(_){function a(u){(function(I,x){if(!(I instanceof x))throw new TypeError("Cannot call a class as a function")})(this,a);var o=function(I,x){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!x||typeof x!="object"&&typeof x!="function"?I:x}(this,_.call(this,u));return o._userLoaded=new U.Event("User loaded"),o._userUnloaded=new U.Event("User unloaded"),o._silentRenewError=new U.Event("Silent renew error"),o._userSignedIn=new U.Event("User signed in"),o._userSignedOut=new U.Event("User signed out"),o._userSessionChanged=new U.Event("User session changed"),o}return function(o,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);o.prototype=Object.create(p&&p.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(o,p):o.__proto__=p)}(a,_),a.prototype.load=function(o){var p=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];T.Log.debug("UserManagerEvents.load"),_.prototype.load.call(this,o),p&&this._userLoaded.raise(o)},a.prototype.unload=function(){T.Log.debug("UserManagerEvents.unload"),_.prototype.unload.call(this),this._userUnloaded.raise()},a.prototype.addUserLoaded=function(o){this._userLoaded.addHandler(o)},a.prototype.removeUserLoaded=function(o){this._userLoaded.removeHandler(o)},a.prototype.addUserUnloaded=function(o){this._userUnloaded.addHandler(o)},a.prototype.removeUserUnloaded=function(o){this._userUnloaded.removeHandler(o)},a.prototype.addSilentRenewError=function(o){this._silentRenewError.addHandler(o)},a.prototype.removeSilentRenewError=function(o){this._silentRenewError.removeHandler(o)},a.prototype._raiseSilentRenewError=function(o){T.Log.debug("UserManagerEvents._raiseSilentRenewError",o.message),this._silentRenewError.raise(o)},a.prototype.addUserSignedIn=function(o){this._userSignedIn.addHandler(o)},a.prototype.removeUserSignedIn=function(o){this._userSignedIn.removeHandler(o)},a.prototype._raiseUserSignedIn=function(){T.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},a.prototype.addUserSignedOut=function(o){this._userSignedOut.addHandler(o)},a.prototype.removeUserSignedOut=function(o){this._userSignedOut.removeHandler(o)},a.prototype._raiseUserSignedOut=function(){T.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},a.prototype.addUserSessionChanged=function(o){this._userSessionChanged.addHandler(o)},a.prototype.removeUserSessionChanged=function(o){this._userSessionChanged.removeHandler(o)},a.prototype._raiseUserSessionChanged=function(){T.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},a}(l.AccessTokenEvents)},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.Timer=void 0;var T=function(){function o(p,I){for(var x=0;x<I.length;x++){var V=I[x];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(p,V.key,V)}}return function(p,I,x){return I&&o(p.prototype,I),x&&o(p,x),p}}(),l=F(0),U=F(1),_=F(17);function a(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")}function u(o,p){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!p||typeof p!="object"&&typeof p!="function"?o:p}v.Timer=function(o){function p(I){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.Global.timer,V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;a(this,p);var O=u(this,o.call(this,I));return O._timer=x,O._nowFunc=V||function(){return Date.now()/1e3},O}return function(x,V){if(typeof V!="function"&&V!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof V);x.prototype=Object.create(V&&V.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),V&&(Object.setPrototypeOf?Object.setPrototypeOf(x,V):x.__proto__=V)}(p,o),p.prototype.init=function(x){x<=0&&(x=1),x=parseInt(x);var V=this.now+x;if(this.expiration===V&&this._timerHandle)l.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),l.Log.debug("Timer.init timer "+this._name+" for duration:",x),this._expiration=V;var O=5;x<O&&(O=x),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*O)}},p.prototype.cancel=function(){this._timerHandle&&(l.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},p.prototype._callback=function(){var x=this._expiration-this.now;l.Log.debug("Timer.callback; "+this._name+" timer expires in:",x),this._expiration<=this.now&&(this.cancel(),o.prototype.raise.call(this))},T(p,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),p}(_.Event)},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.SilentRenewService=void 0;var T=F(0);v.SilentRenewService=function(){function l(U){(function(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")})(this,l),this._userManager=U}return l.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(_){}).catch(function(_){T.Log.error("SilentRenewService.start: Error from getUser:",_.message)}))},l.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},l.prototype._tokenExpiring=function(){var _=this;this._userManager.signinSilent().then(function(a){T.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(a){T.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",a.message),_._userManager.events._raiseSilentRenewError(a)})},l}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.CordovaPopupNavigator=void 0;var T=F(21);v.CordovaPopupNavigator=function(){function l(){(function(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(_){var a=new T.CordovaPopupWindow(_);return Promise.resolve(a)},l}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.CordovaIFrameNavigator=void 0;var T=F(21);v.CordovaIFrameNavigator=function(){function l(){(function(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(_){_.popupWindowFeatures="hidden=yes";var a=new T.CordovaPopupWindow(_);return Promise.resolve(a)},l}()},function(et,v,F){Object.defineProperty(v,"__esModule",{value:!0}),v.Version="1.11.5"}])})})(fr);var Ge=Tr(fr.exports),_e=function(st){return st.reduce(function(et,v){return Object.keys(v||{}).forEach(function(F){et[F]=v[F]}),et},{})},Rr=function(st){try{var et=st.split(".")[1],v=et.replace("-","+").replace("_","/");return JSON.parse(window.atob(v))}catch{return{}}},gr=function(st){return st&&st.length>0?st.charAt(0).toUpperCase()+st.slice(1):""},Ir=function(st){return st.split(/(?=[A-Z])/).join("_").toLowerCase()},Or={userStore:new Ge.WebStorageStateStore,loadUserInfo:!0,automaticSilentSignin:!0},Dr=["authority","client_id","redirect_uri","response_type","scope"],Ur=["clientId","redirectUri","responseType","maxAge","uiLocales","loginHint","acrValues","postLogoutRedirectUri","popupRedirectUri","silentRedirectUri"],Lr=function(st){return Ur.forEach(function(et){typeof st[et]!="undefined"&&(st[Ir(et)]=st[et])}),st},dr=function(st){return _e([Or,Lr(st),{automaticSilentRenew:!1}])},Je=function(st){var et=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"/";if(st){var v="://",F=st.substr(st.indexOf(v)+v.length);return F.substr(F.indexOf(et)+et.length-1).replace(/\/$/,"")}return null},Nr=function(st){var et=dr(st);return Dr.forEach(function(v){if(!et[v])throw new Error("Required oidc setting "+v+" missing for creating UserManager")}),new Ge.UserManager(et)},We=function(st,et,v){var F="add"+gr(et);typeof st.events[F]=="function"&&typeof v=="function"&&st.events[F](v)},Br=function(st,et,v){var F="remove"+gr(et);typeof st.events[F]=="function"&&typeof v=="function"&&st.events[F](v)},jr=function(){return new Ge.UserManager().signinSilentCallback()},ze=function(st){if(st){var et=Rr(st);return et.exp?et.exp*1e3:null}return null},lr=function(st){return st?st<new Date().getTime():!1};function Mr(mt,st,et){var v="vuexoidc:"+mt;if(typeof window.CustomEvent=="function")return et=_e([et,{detail:st}]),new window.CustomEvent(v,et);et=et||{bubbles:!1,cancelable:!1},et=_e([et,{detail:st}]);var F=document.createEvent("CustomEvent");return F.initCustomEvent(v,et.bubbles,et.cancelable,et.detail),F}function Ye(mt){var st=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},et=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(window){var v=Mr(mt,_e([{},st]),et);window.dispatchEvent(v)}}var Hr=function(st){return new Promise(function(et,v){typeof window=="undefined"&&v(new Error("gotoUrlWithIframe does not work when window is undefined"));var F=window.document.createElement("iframe");F.style.display="none",F.onload=function(){F.parentNode.removeChild(F),et(!0)},F.src=st,window.document.body.appendChild(F)})},Vr=function(mt){var st=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},et=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=dr(mt),F=Nr(mt);st=_e([{namespaced:!1,isAuthenticatedBy:"id_token",removeUserWhenTokensExpire:!0},st]);var T=Je(v.redirect_uri,st.routeBase||"/"),l=Je(v.popup_redirect_uri,st.routeBase||"/"),U=Je(v.silent_redirect_uri,st.routeBase||"/");if(Object.keys(et).forEach(function(q){We(F,q,et[q])}),st.dispatchEventsOnWindow){var _=["userLoaded","userUnloaded","accessTokenExpiring","accessTokenExpired","silentRenewError","userSignedOut"];_.forEach(function(q){We(F,q,function(d){Ye(q,d||{})})})}var a={access_token:null,id_token:null,refresh_token:null,user:null,expires_at:null,scopes:null,is_checked:!1,events_are_bound:!1,error:null},u=function(d){return!!d[st.isAuthenticatedBy]},o=function(d){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},R=b.options||st.defaultSigninSilentOptions||{};return new Promise(function(Z,tt){F.signinSilent(R).then(function(nt){d.dispatch("oidcWasAuthenticated",nt),Z(nt)}).catch(function(nt){d.commit("setOidcAuthIsChecked"),b.ignoreErrors?Z(null):(d.commit("setOidcError",A("authenticateOidcSilent",nt)),tt(nt))})})},p=function(d){return!!(d.meta&&d.meta.isOidcCallback||d.meta&&Array.isArray(d.meta)&&d.meta.reduce(function(b,R){return R.isOidcCallback||b},!1)||d.path&&d.path.replace(/\/$/,"")===T||d.path&&d.path.replace(/\/$/,"")===l||d.path&&d.path.replace(/\/$/,"")===U)},I=function(d){return d.meta&&d.meta.isPublic||d.meta&&Array.isArray(d.meta)&&d.meta.reduce(function(b,R){return R.isPublic||b},!1)||st.publicRoutePaths&&st.publicRoutePaths.map(function(b){return b.replace(/\/$/,"")}).indexOf(d.path.replace(/\/$/,""))>-1?!0:st.isPublicRoute&&typeof st.isPublicRoute=="function"?st.isPublicRoute(d):!1},x={oidcIsAuthenticated:function(d){return u(d)},oidcUser:function(d){return d.user},oidcAccessToken:function(d){return lr(d.expires_at)?null:d.access_token},oidcAccessTokenExp:function(d){return d.expires_at},oidcScopes:function(d){return d.scopes},oidcIdToken:function(d){return st.removeUserWhenTokensExpire&&ze(d.expires_at)?null:d.id_token},oidcIdTokenExp:function(d){return ze(d.id_token)},oidcRefreshToken:function(d){return lr(d.refresh_token)?null:d.refresh_token},oidcRefreshTokenExp:function(d){return ze(d.refresh_token)},oidcAuthenticationIsChecked:function(d){return d.is_checked},oidcError:function(d){return d.error},oidcIsRoutePublic:function(d){return function(b){return I(b)}}},V={oidcCheckAccess:function(d,b){return new Promise(function(R){if(p(b)){R(!0);return}var Z=!0,tt=new Promise(function(H){F.getUser().then(function(at){H(at)}).catch(function(){H(null)})}),nt=u(d.state);tt.then(function(H){if(!H||H.expired){var at=v.silent_redirect_uri&&v.automaticSilentSignin;if(I(b))nt&&d.commit("unsetOidcAuth"),at&&o(d,{ignoreErrors:!0}).catch(function(){});else{var _t=function(){nt&&d.commit("unsetOidcAuth"),d.dispatch("authenticateOidc",{redirectPath:b.fullPath})};if(at){o(d,{ignoreErrors:!0}).then(function(){F.getUser().then(function(bt){(!bt||bt.expired)&&_t(),R(!!bt)}).catch(function(){_t(),R(!1)})}).catch(function(){_t(),R(!1)});return}_t(),Z=!1}}else d.dispatch("oidcWasAuthenticated",H),nt||(et&&typeof et.userLoaded=="function"&&et.userLoaded(H),st.dispatchEventsOnWindow&&Ye("userLoaded",H));R(Z)})})},authenticateOidc:function(d){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof b=="string"&&(b={redirectPath:b}),b.redirectPath?sessionStorage.setItem("vuex_oidc_active_route",b.redirectPath):sessionStorage.removeItem("vuex_oidc_active_route");var R=b.options||st.defaultSigninRedirectOptions||{};return F.signinRedirect(R).catch(function(Z){d.commit("setOidcError",A("authenticateOidc",Z))})},oidcSignInCallback:function(d,b){return new Promise(function(R,Z){F.signinRedirectCallback(b).then(function(tt){d.dispatch("oidcWasAuthenticated",tt),R(sessionStorage.getItem("vuex_oidc_active_route")||"/")}).catch(function(tt){d.commit("setOidcError",A("oidcSignInCallback",tt)),d.commit("setOidcAuthIsChecked"),Z(tt)})})},authenticateOidcSilent:function(d){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o(d,b)},authenticateOidcPopup:function(d){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},R=b.options||st.defaultSigninPopupOptions||{};return F.signinPopup(R).then(function(Z){d.dispatch("oidcWasAuthenticated",Z)}).catch(function(Z){d.commit("setOidcError",A("authenticateOidcPopup",Z))})},oidcSignInPopupCallback:function(d,b){return new Promise(function(R,Z){F.signinPopupCallback(b).catch(function(tt){d.commit("setOidcError",A("oidcSignInPopupCallback",tt)),d.commit("setOidcAuthIsChecked"),Z(tt)})})},oidcWasAuthenticated:function(d,b){d.commit("setOidcAuth",b),d.state.events_are_bound||(F.events.addAccessTokenExpired(function(){st.removeUserWhenTokensExpire?d.commit("unsetOidcAuth"):d.commit("unsetOidcAccessToken")}),mt.automaticSilentRenew&&F.events.addAccessTokenExpiring(function(){o(d).catch(function(R){k("automaticSilentRenewError",A("authenticateOidcSilent",R))})}),d.commit("setOidcEventsAreBound")),d.commit("setOidcAuthIsChecked")},storeOidcUser:function(d,b){return F.storeUser(b).then(function(){return F.getUser()}).then(function(R){return d.dispatch("oidcWasAuthenticated",R)}).then(function(){}).catch(function(R){throw d.commit("setOidcError",A("storeOidcUser",R)),d.commit("setOidcAuthIsChecked"),R})},getOidcUser:function(d){return F.getUser().then(function(b){return d.commit("setOidcUser",b),b})},addOidcEventListener:function(d,b){We(F,b.eventName,b.eventListener)},removeOidcEventListener:function(d,b){Br(F,b.eventName,b.eventListener)},signOutOidc:function(d,b){return F.signoutRedirect(b).then(function(){d.commit("unsetOidcAuth")})},signOutOidcCallback:function(d){return F.signoutRedirectCallback()},signOutPopupOidc:function(d,b){return F.signoutPopup(b).then(function(){d.commit("unsetOidcAuth")})},signOutPopupOidcCallback:function(d){return F.signoutPopupCallback()},signOutOidcSilent:function(d,b){return new Promise(function(R,Z){try{F.getUser().then(function(tt){var nt=_e([b||{},{id_token_hint:tt?tt.id_token:null}]);b&&b.id_token_hint&&(nt.id_token_hint=b.id_token_hint),F.createSignoutRequest(nt).then(function(H){Hr(H.url).then(function(){d.dispatch("removeOidcUser"),R()}).catch(function(at){return Z(at)})}).catch(function(H){return Z(H)})}).catch(function(tt){return Z(tt)})}catch(tt){Z(tt)}})},removeUser:function(d){return d.dispatch("removeOidcUser")},removeOidcUser:function(d){return F.removeUser().then(function(){d.commit("unsetOidcAuth")})},clearStaleState:function(){return F.clearStaleState()},startSilentRenew:function(){return F.startSilentRenew()},stopSilentRenew:function(){return F.stopSilentRenew()}},O={setOidcAuth:function(d,b){d.id_token=b.id_token,d.access_token=b.access_token,d.refresh_token=b.refresh_token,d.expires_at=b.expires_at?b.expires_at*1e3:null,d.user=b.profile,d.scopes=b.scopes,d.error=null},setOidcUser:function(d,b){d.user=b?b.profile:null,d.expires_at=b&&b.expires_at?b.expires_at*1e3:null},unsetOidcAuth:function(d){d.id_token=null,d.access_token=null,d.refresh_token=null,d.user=null},unsetOidcAccessToken:function(d){d.access_token=null,d.refresh_token=null},setOidcAuthIsChecked:function(d){d.is_checked=!0},setOidcEventsAreBound:function(d){d.events_are_bound=!0},setOidcError:function(d,b){d.error=b.error,k("oidcError",b)}},A=function(d,b){return{context:d,error:b&&b.message?b.message:b}},k=function(d,b){typeof et[d]=="function"&&et[d](b),st.dispatchEventsOnWindow&&Ye(d,b)},M=_e([st,{state:a,getters:x,actions:V,mutations:O}]);return typeof M.dispatchEventsOnWindow!="undefined"&&delete M.dispatchEventsOnWindow,M},Kr=Vr,qr=jr;export{qr as a,Cr as c,Kr as v};
